<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<!-- This file was created with the aha Ansi HTML Adapter. http://ziz.delphigl.com/tool_aha.php -->
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="application/xml+xhtml; charset=UTF-8" />
<title>stdin</title>
</head>
<body>
<pre>
<span style="font-weight:bold;">────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
modified: sip-communicator/src/net/java/sip/communicator/SipCommunicator.java
────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
</span><span style="color:teal;font-weight:bold;">@ SipCommunicator.java:2 @</span><span style="font-weight:bold;text-decoration:blink;"></span>
/* ====================================================================
<span style="color:red;font-weight:bold;"> * </span><span style="color:red;font-weight:bold;text-decoration:blink;"></span><span style="color:red;font-weight:bold;">The Apache Software License, Version 1.1</span>
<span style="color:green;font-weight:bold;"> * </span><span style="color:green;font-weight:bold;text-decoration:blink;"> * </span><span style="color:green;font-weight:bold;">The Apache Software License, Version 1.1</span>
 *
 * Copyright (c) 2000 The Apache Software Foundation.  All rights
 * reserved.
<span style="color:teal;">@ SipCommunicator.java:65 @</span><span style="color:teal;font-weight:bold;"></span><span style="font-weight:bold;text-decoration:blink;"> import java.lang.reflect.*;</span>
import java.net.*;
import java.util.*;
import java.awt.*;
<span style="color:gray;background-color:black;"></span><span style="color:green;background-color:black;"> </span>
import net.java.sip.communicator.common.*;
import net.java.sip.communicator.common.Console;
import net.java.sip.communicator.gui.*;
<span style="color:teal;">@ SipCommunicator.java:75 @</span><span style="color:teal;font-weight:bold;"></span><span style="font-weight:bold;text-decoration:blink;"> import net.java.sip.communicator.media.event.*;</span>
import net.java.sip.communicator.sip.*;
import net.java.sip.communicator.sip.event.*;
import net.java.sip.communicator.sip.security.*;
<span style="color:gray;background-color:black;"></span><span style="color:green;background-color:black;"> </span>
import java.io.IOException;
<span style="color:gray;background-color:black;"></span><span style="color:green;background-color:black;"> </span>
import net.java.sip.communicator.plugin.setup.*;
import net.java.sip.communicator.sip.simple.*;

<span style="color:teal;">@ SipCommunicator.java:118 @</span><span style="color:teal;font-weight:bold;"></span><span style="font-weight:bold;text-decoration:blink;"> public class SipCommunicator</span>

            guiManager = new GuiManager();
            mediaManager = new MediaManager();
<span style="color:red;font-weight:bold;">            sipManager = new SipManager(</span><span style="color:red;font-weight:bold;text-decoration:blink;"></span><span style="color:red;font-weight:bold;">);</span>
<span style="color:green;font-weight:bold;">            sipManager = new SipManager(</span><span style="color:green;font-weight:bold;text-decoration:blink;">guiManager</span><span style="color:green;font-weight:bold;">);</span>
            simpleContactList = new SimpleContactList();

            guiManager.addUserActionListener(this);
<span style="color:teal;">@ SipCommunicator.java:139 @</span><span style="color:teal;font-weight:bold;"></span><span style="font-weight:bold;text-decoration:blink;"> public class SipCommunicator</span>
        }
    }

<span style="color:green;"></span><span style="color:green;">    /**</span>
<span style="color:green;"></span><span style="color:green;">     *</span><span style="background-color:red;"> </span>
<span style="color:green;"></span><span style="color:green;">     */</span>
    public void launch()
    {
        try {
<span style="color:teal;">@ SipCommunicator.java:213 @</span><span style="color:teal;font-weight:bold;"></span><span style="font-weight:bold;text-decoration:blink;"> public class SipCommunicator</span>
                    exc);
            }

<span style="color:green;"></span><span style="background-color:red;">            </span>
<span style="color:green;"></span><span style="color:green;">            /**</span>
<span style="color:green;"></span><span style="color:green;">             * Dummy call to forward to ensure functionality</span>
<span style="color:green;"></span><span style="color:green;">             */</span>
<span style="color:green;"></span><span style="color:green;">//            try {</span>
<span style="color:green;"></span><span style="color:green;">//            	sipManager.forward(&quot;dfs&quot;);</span>
<span style="color:green;"></span><span style="color:green;">//            }</span>
<span style="color:green;"></span><span style="color:green;">//            catch (CommunicationsException exc) {</span>
<span style="color:green;"></span><span style="color:green;">//                console.error(</span>
<span style="color:green;"></span><span style="color:green;">//                        &quot;An exception occurred while trying to set call forwarding, exc&quot;);</span>
<span style="color:green;"></span><span style="color:green;">//                    console.showException(</span>
<span style="color:green;"></span><span style="color:green;">//                        &quot;Failed to set call forwarding!\n&quot;</span>
<span style="color:green;"></span><span style="color:green;">//                        + exc.getMessage() + &quot;\n&quot;</span>
<span style="color:green;"></span><span style="color:green;">//                        + &quot;This is a warning only. The phone would still function&quot;,</span>
<span style="color:green;"></span><span style="color:green;">//                        exc);</span>
<span style="color:green;"></span><span style="color:green;">//                }</span>
<span style="color:green;"></span><span style="background-color:red;">            </span>
<span style="color:green;"></span><span style="background-color:red;">          </span>
<span style="color:green;"></span><span style="color:green;">//            try {</span>
<span style="color:green;"></span><span style="color:green;">//            	sipManager.block(&quot;bfs&quot;);</span>
<span style="color:green;"></span><span style="color:green;">//            }</span>
<span style="color:green;"></span><span style="color:green;">//            catch (CommunicationsException exc) {</span>
<span style="color:green;"></span><span style="color:green;">//                console.error(</span>
<span style="color:green;"></span><span style="color:green;">//                        &quot;An exception occurred while trying to set call forwarding, exc&quot;);</span>
<span style="color:green;"></span><span style="color:green;">//                    console.showException(</span>
<span style="color:green;"></span><span style="color:green;">//                        &quot;Failed to set call forwarding!\n&quot;</span>
<span style="color:green;"></span><span style="color:green;">//                        + exc.getMessage() + &quot;\n&quot;</span>
<span style="color:green;"></span><span style="color:green;">//                        + &quot;This is a warning only. The phone would still function&quot;,</span>
<span style="color:green;"></span><span style="color:green;">//                        exc);</span>
<span style="color:green;"></span><span style="color:green;">//                }</span>
<span style="color:green;"></span><span style="background-color:red;">            </span>
            boolean startSimple = false;
            try {
                startSimple = Boolean.valueOf(Utils.getProperty(
<span style="color:teal;">@ SipCommunicator.java:401 @</span><span style="color:teal;font-weight:bold;"></span><span style="font-weight:bold;text-decoration:blink;"> public class SipCommunicator</span>
        }
    }

<span style="color:green;"></span><span style="color:green;">    /**</span>
<span style="color:green;"></span><span style="color:green;">     * TODO: Implement for UserForwardRequest</span>
<span style="color:green;"></span><span style="color:green;">     * TODO: Also implement handleDisableForwardEvent</span>
<span style="color:green;"></span><span style="color:green;">     */</span>
<span style="color:green;"></span><span style="color:green;">    public void handleForwardRequest(UserForwardEvent evt)</span>
<span style="color:green;"></span><span style="color:green;">    {</span>
<span style="color:green;"></span><span style="background-color:red;">    </span>	<span style="color:green;">try {</span>
<span style="color:green;"></span><span style="background-color:red;">    </span>		<span style="color:green;">console.logEntry();</span>
<span style="color:green;"></span><span style="color:green;">            String forwardee = (String) evt.getSource();</span>
<span style="color:green;"></span><span style="background-color:red;">            </span>
<span style="color:green;"></span><span style="background-color:red;">        </span>	<span style="color:green;">try {</span>
<span style="color:green;"></span><span style="background-color:red;">            </span>	<span style="color:green;">sipManager.forward(forwardee);</span>
<span style="color:green;"></span><span style="color:green;">            }</span>
<span style="color:green;"></span><span style="color:green;">            catch (CommunicationsException exc) {</span>
<span style="color:green;"></span><span style="color:green;">                console.error(</span>
<span style="color:green;"></span><span style="color:green;">                        &quot;An exception occurred while trying to set call forwarding, exc&quot;);</span>
<span style="color:green;"></span><span style="color:green;">                    console.showException(</span>
<span style="color:green;"></span><span style="color:green;">                        &quot;Failed to set call forwarding!\n&quot;</span>
<span style="color:green;"></span><span style="color:green;">                        + exc.getMessage() + &quot;\n&quot;</span>
<span style="color:green;"></span><span style="color:green;">                        + &quot;This is a warning only. The phone would still function&quot;,</span>
<span style="color:green;"></span><span style="color:green;">                        exc);</span>
<span style="color:green;"></span><span style="color:green;">                }</span>
<span style="color:green;"></span><span style="background-color:red;">            </span>
<span style="color:green;"></span><span style="color:green;">        }</span>
<span style="color:green;"></span><span style="color:green;">        finally {</span>
<span style="color:green;"></span><span style="color:green;">            console.logExit();</span>
<span style="color:green;"></span><span style="color:green;">        }</span>
<span style="color:green;"></span><span style="color:green;">    }</span>
<span style="color:green;"></span><span style="background-color:red;">    </span>
<span style="color:green;"></span><span style="color:green;">    /**</span>
<span style="color:green;"></span><span style="color:green;">     * TODO: Implement for UserBlockRequest</span>
<span style="color:green;"></span><span style="color:green;">     * TODO: Also implement handleUnblockEvent</span>
<span style="color:green;"></span><span style="color:green;">     */</span>
<span style="color:green;"></span><span style="color:green;">    public void handleBlockRequest(UserBlockEvent evt)</span>
<span style="color:green;"></span><span style="color:green;">    {</span>
<span style="color:green;"></span><span style="background-color:red;">    </span>	<span style="color:green;">try {</span>
<span style="color:green;"></span><span style="background-color:red;">    </span>		<span style="color:green;">console.logEntry();</span>
<span style="color:green;"></span><span style="color:green;">            String blockee = (String) evt.getSource();</span>
<span style="color:green;"></span><span style="background-color:red;">            </span>
<span style="color:green;"></span><span style="background-color:red;">        </span>	<span style="color:green;">try {</span>
<span style="color:green;"></span><span style="background-color:red;">            </span>	<span style="color:green;">sipManager.block(blockee);</span>
<span style="color:green;"></span><span style="color:green;">            }</span>
<span style="color:green;"></span><span style="color:green;">            catch (CommunicationsException exc) {</span>
<span style="color:green;"></span><span style="color:green;">                console.error(</span>
<span style="color:green;"></span><span style="color:green;">                        &quot;An exception occurred while trying to set blocking, exc&quot;);</span>
<span style="color:green;"></span><span style="color:green;">                    console.showException(</span>
<span style="color:green;"></span><span style="color:green;">                        &quot;Failed to set blocking!\n&quot;</span>
<span style="color:green;"></span><span style="color:green;">                        + exc.getMessage() + &quot;\n&quot;</span>
<span style="color:green;"></span><span style="color:green;">                        + &quot;This is a warning only. The phone would still function&quot;,</span>
<span style="color:green;"></span><span style="color:green;">                        exc);</span>
<span style="color:green;"></span><span style="color:green;">                }</span>
<span style="color:green;"></span><span style="color:green;">        }</span>
<span style="color:green;"></span><span style="color:green;">        finally {</span>
<span style="color:green;"></span><span style="color:green;">            console.logExit();</span>
<span style="color:green;"></span><span style="color:green;">        }</span>
<span style="color:green;"></span><span style="background-color:red;">    	</span>
<span style="color:green;"></span><span style="color:green;">    }</span>
<span style="color:gray;background-color:black;"></span><span style="color:green;background-color:black;"> </span>
<span style="color:green;"></span><span style="color:green;">    public void handleDisableForwardRequest(UserDisableForwardEvent evt){</span>
<span style="color:green;"></span><span style="background-color:red;">    </span>	<span style="color:green;">try {</span>
<span style="color:green;"></span><span style="background-color:red;">    </span>		<span style="color:green;">console.logEntry();</span><span style="background-color:red;">            </span>
<span style="color:green;"></span><span style="background-color:red;">            </span>	<span style="color:green;">sipManager.unforward();</span>
<span style="color:green;"></span><span style="background-color:red;">    </span>	<span style="color:green;">}</span>
<span style="color:green;"></span><span style="color:green;">        catch (CommunicationsException exc) {</span>
<span style="color:green;"></span><span style="color:green;">            console.error(</span>
<span style="color:green;"></span><span style="color:green;">                    &quot;An exception occurred while trying to disable call forwarding, exc&quot;);</span>
<span style="color:green;"></span><span style="color:green;">                console.showException(</span>
<span style="color:green;"></span><span style="color:green;">                    &quot;Failed to disable call forwarding!\n&quot;</span>
<span style="color:green;"></span><span style="color:green;">                    + exc.getMessage() + &quot;\n&quot;</span>
<span style="color:green;"></span><span style="color:green;">                    + &quot;This is a warning only. The phone would still function&quot;,</span>
<span style="color:green;"></span><span style="color:green;">                    exc);</span>
<span style="color:green;"></span><span style="color:green;">            }</span>
<span style="color:green;"></span><span style="color:green;">        finally {</span>
<span style="color:green;"></span><span style="color:green;">            console.logExit();</span>
<span style="color:green;"></span><span style="color:green;">        }</span>
<span style="color:green;"></span><span style="color:green;">    }</span>
<span style="color:green;"></span><span style="background-color:red;">    </span>
<span style="color:green;"></span><span style="background-color:red;">    </span>
<span style="color:green;"></span><span style="background-color:red;">    </span>
<span style="color:green;"></span><span style="color:green;">    public void handleUnblockRequest(UserUnblockEvent evt){</span>
<span style="color:green;"></span><span style="background-color:red;">    </span>	<span style="color:green;">try {</span>
<span style="color:green;"></span><span style="background-color:red;">    </span>		<span style="color:green;">console.logEntry();</span>
<span style="color:green;"></span><span style="color:green;">            String blockee = (String) evt.getSource();</span>
<span style="color:green;"></span><span style="background-color:red;">            </span>
<span style="color:green;"></span><span style="background-color:red;">        </span>	<span style="color:green;">try {</span>
<span style="color:green;"></span><span style="background-color:red;">            </span>	<span style="color:green;">sipManager.unblock(blockee);</span>
<span style="color:green;"></span><span style="color:green;">            }</span>
<span style="color:green;"></span><span style="color:green;">            catch (CommunicationsException exc) {</span>
<span style="color:green;"></span><span style="color:green;">                console.error(</span>
<span style="color:green;"></span><span style="color:green;">                        &quot;An exception occurred while trying to set blocking, exc&quot;);</span>
<span style="color:green;"></span><span style="color:green;">                    console.showException(</span>
<span style="color:green;"></span><span style="color:green;">                        &quot;Failed to set blocking!\n&quot;</span>
<span style="color:green;"></span><span style="color:green;">                        + exc.getMessage() + &quot;\n&quot;</span>
<span style="color:green;"></span><span style="color:green;">                        + &quot;This is a warning only. The phone would still function&quot;,</span>
<span style="color:green;"></span><span style="color:green;">                        exc);</span>
<span style="color:green;"></span><span style="color:green;">                }</span>
<span style="color:green;"></span><span style="color:green;">        }</span>
<span style="color:green;"></span><span style="color:green;">        finally {</span>
<span style="color:green;"></span><span style="color:green;">            console.logExit();</span>
<span style="color:green;"></span><span style="color:green;">        }</span>
<span style="color:green;"></span><span style="color:green;">    }</span>
<span style="color:green;"></span><span style="background-color:red;">    </span>
    public void handleDialRequest(UserCallInitiationEvent evt)
    {
        try {
<span style="color:teal;">@ SipCommunicator.java:535 @</span><span style="color:teal;font-weight:bold;"></span><span style="font-weight:bold;text-decoration:blink;"> public class SipCommunicator</span>
            console.logExit();
        }
    }
<span style="color:green;"></span><span style="background-color:red;">    </span>
<span style="color:green;"></span><span style="background-color:red;">    </span>

    public void handleHangupRequest(UserCallControlEvent evt)
    {
        try {
            console.logEntry();
<span style="color:green;"></span><span style="color:green;">            /**</span>
<span style="color:green;"></span><span style="color:green;">             * TODO: Send the call time to the server</span>
<span style="color:green;"></span><span style="color:green;">             */</span>
            sipManager.endCall(evt.getAssociatedInterlocutor().getID());
            //no further action should be taken here. Close
            //(mediaManager.closeStream guiManager.removeInterlocutor)
<span style="color:teal;">@ SipCommunicator.java:804 @</span><span style="color:teal;font-weight:bold;"></span><span style="font-weight:bold;text-decoration:blink;"> public class SipCommunicator</span>
            console.logExit();
        }
    }
<span style="color:green;"></span><span style="background-color:red;">    </span>
<span style="color:green;"></span><span style="color:green;">    public void blocking(BlockEvent evt){</span>
<span style="color:green;"></span><span style="background-color:red;">    </span>	<span style="color:green;">try {</span>
<span style="color:green;"></span><span style="color:green;">            console.logEntry();</span>
<span style="color:green;"></span><span style="color:green;">            String blockee = evt.getReason().split(&quot;:&quot;)[1].split(&quot;@&quot;)[0];</span>
<span style="color:green;"></span><span style="color:green;">            guiManager.phoneFrame.blockPanel.remove(guiManager.phoneFrame.unblockButton);</span>
<span style="color:green;"></span><span style="color:green;">            guiManager.phoneFrame.unblockButton.addItem(blockee);</span>
<span style="color:green;"></span><span style="color:green;">            guiManager.phoneFrame.blockPanel.add(guiManager.phoneFrame.unblockButton, BorderLayout.WEST);</span>
<span style="color:green;"></span><span style="color:green;">        }</span>
<span style="color:green;"></span><span style="color:green;">        finally {</span>
<span style="color:green;"></span><span style="color:green;">            console.logExit();</span>
<span style="color:green;"></span><span style="color:green;">        }</span>
<span style="color:green;"></span><span style="color:green;">    }</span>
<span style="color:green;"></span><span style="background-color:red;">    </span>
<span style="color:green;"></span><span style="color:green;">    public void unblockingGui(BlockEvent evt){</span><span style="background-color:red;">	</span>
<span style="color:green;"></span><span style="background-color:red;">    </span>	<span style="color:green;">try{</span>
<span style="color:green;"></span><span style="background-color:red;">    </span>		<span style="color:green;">console.logEntry();</span>
<span style="color:green;"></span>	<span style="color:green;">        String unblock_usr = evt.getReason().split(&quot;:&quot;)[1].split(&quot;@&quot;)[0];</span>
<span style="color:green;"></span><span style="background-color:red;">	        </span>
<span style="color:green;"></span><span style="background-color:red;">    </span>		<span style="color:green;">if(!&quot;Blocked People&quot;.equals(unblock_usr)){</span>
<span style="color:green;"></span><span style="background-color:red;">    </span>			<span style="color:green;">console.debug(&quot;Se gamaw&quot; + unblock_usr);</span>
<span style="color:green;"></span><span style="background-color:red;">    </span>			<span style="color:green;">guiManager.phoneFrame.blockPanel.remove(guiManager.phoneFrame.unblockButton);</span>
<span style="color:green;"></span><span style="background-color:red;">    </span>			<span style="color:green;">guiManager.phoneFrame.unblockButton.setSelectedItem(&quot;Blocked People&quot;);</span>
<span style="color:green;"></span><span style="background-color:red;">    </span>			<span style="color:green;">guiManager.phoneFrame.unblockButton.removeItem(unblock_usr);</span>
<span style="color:green;"></span><span style="background-color:red;">                </span>
<span style="color:green;"></span><span style="background-color:red;">    </span>			<span style="color:green;">guiManager.phoneFrame.blockPanel.add(guiManager.phoneFrame.unblockButton, BorderLayout.WEST);</span>
<span style="color:green;"></span><span style="background-color:red;">                </span>
<span style="color:green;"></span>	<span style="color:green;">        }</span>
<span style="color:green;"></span><span style="background-color:red;">    </span>	<span style="color:green;">}</span>
<span style="color:green;"></span><span style="background-color:red;">    </span>	<span style="color:green;">finally{</span>
<span style="color:green;"></span><span style="background-color:red;">    </span>		<span style="color:green;">console.logExit();</span>
<span style="color:green;"></span><span style="background-color:red;">    </span>	<span style="color:green;">}</span>
<span style="color:green;"></span><span style="color:green;">    }</span>
<span style="color:green;"></span><span style="background-color:red;">    </span>
<span style="color:green;"></span><span style="color:green;">    public void forwardedOKGuiChange(ForwardEvent evt){</span>
<span style="color:green;"></span><span style="background-color:red;">    </span>	<span style="color:green;">try {</span>
<span style="color:green;"></span><span style="color:green;">            console.logEntry();</span>
<span style="color:green;"></span><span style="color:green;">            if (evt.getReason() != &quot;None&quot;){</span>
<span style="color:green;"></span><span style="background-color:red;">            </span>	<span style="color:green;">guiManager.phoneFrame.frwl.setText(&quot;Forward to: &quot; + evt.getReason().split(&quot;@&quot;)[0].split(&quot;:&quot;)[1]);</span>
<span style="color:green;"></span><span style="color:green;">            }else{</span>
<span style="color:green;"></span><span style="background-color:red;">            </span>	<span style="color:green;">guiManager.phoneFrame.frwl.setText(&quot;Forward to: &quot; + evt.getReason());</span>
<span style="color:green;"></span><span style="color:green;">            }</span>
<span style="color:green;"></span><span style="color:green;">        }</span>
<span style="color:green;"></span><span style="color:green;">        finally {</span>
<span style="color:green;"></span><span style="color:green;">            console.logExit();</span>
<span style="color:green;"></span><span style="color:green;">        }</span>
<span style="color:green;"></span><span style="background-color:red;">    	</span>
<span style="color:green;"></span><span style="color:green;">    }</span>

    public void unregistered(RegistrationEvent evt)
    {
<span style="color:teal;">@ SipCommunicator.java:1160 @</span><span style="color:teal;font-weight:bold;"></span><span style="font-weight:bold;text-decoration:blink;"> public class SipCommunicator</span>

        return SubscriptionAuthorizationResponse.createResponse(response);
    }
<span style="color:red;font-weight:bold;"></span><span style="color:red;font-weight:bold;text-decoration:blink;"></span><span style="color:red;font-weight:bold;">}</span>
<span style="color:green;font-weight:bold;"></span><span style="color:green;font-weight:bold;text-decoration:blink;">	</span><span style="color:green;font-weight:bold;">}</span>
<span style="font-weight:bold;">────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
modified: sip-communicator/src/net/java/sip/communicator/gui/AuthenticationSplash.java
────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
</span><span style="color:teal;font-weight:bold;">@ AuthenticationSplash.java:90 @</span><span style="font-weight:bold;text-decoration:blink;"> public class AuthenticationSplash</span>
     */
    private ResourceBundle resources = null;

<span style="color:green;"></span><span style="background-color:red;">    </span>
    /**
     * Path to the image resources
     */
<span style="color:teal;">@ AuthenticationSplash.java:465 @</span><span style="color:teal;font-weight:bold;"></span><span style="font-weight:bold;text-decoration:blink;"> public class AuthenticationSplash</span>
        else if (cmd.equals(CMD_LOGIN)) {
            userName = userNameTextField.getText();
            password = passwordTextField.getPassword();
<span style="color:green;"></span><span style="color:green;">            System.out.println(new String(password));</span>
        }
        setVisible(false);
        dispose();
<span style="font-weight:bold;">────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
modified: sip-communicator/src/net/java/sip/communicator/gui/GuiManager.java
────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
</span><span style="color:teal;font-weight:bold;">@ GuiManager.java:63 @</span><span style="font-weight:bold;text-decoration:blink;"> package net.java.sip.communicator.gui;</span>
import java.util.*;
import java.awt.*;
import java.awt.event.*;
<span style="color:gray;background-color:black;"></span><span style="color:green;background-color:black;"> </span>
import javax.swing.*;
<span style="color:gray;background-color:black;"></span><span style="color:green;background-color:black;"> </span>
import net.java.sip.communicator.common.*;
import net.java.sip.communicator.common.Console;
import net.java.sip.communicator.gui.event.*;
<span style="color:gray;background-color:black;"></span><span style="color:green;background-color:black;"> </span>
import java.awt.SystemColor;
<span style="color:gray;background-color:black;"></span><span style="color:green;background-color:black;"> </span>
import javax.swing.plaf.metal.MetalLookAndFeel;
<span style="color:gray;background-color:black;"></span><span style="color:green;background-color:black;"> </span>
import net.java.sip.communicator.gui.plaf.SipCommunicatorColorTheme;
<span style="color:gray;background-color:black;"></span><span style="color:green;background-color:black;"> </span>
import java.awt.event.KeyEvent;
import java.io.*;
<span style="color:gray;background-color:black;"></span><span style="color:green;background-color:black;"> </span>
import net.java.sip.communicator.media.JMFRegistry;
import net.java.sip.communicator.plugin.setup.*;
import net.java.sip.communicator.gui.imp.*;
<span style="color:teal;">@ GuiManager.java:112 @</span><span style="color:teal;font-weight:bold;"></span><span style="font-weight:bold;text-decoration:blink;"> public class GuiManager</span>
        initLookAndFeel();
    }

<span style="color:red;font-weight:bold;">    p</span><span style="color:red;font-weight:bold;text-decoration:blink;">rivate</span><span style="color:red;font-weight:bold;"> PhoneFrame       phoneFrame   = null;</span>
<span style="color:green;font-weight:bold;">    p</span><span style="color:green;font-weight:bold;text-decoration:blink;">ublic</span><span style="color:green;font-weight:bold;"> PhoneFrame       phoneFrame   = null;</span>
    private ContactListFrame contactList  = null;
    private ConfigFrame      configFrame  = null;
    private ArrayList        listeners    = null;
<span style="color:green;"></span><span style="color:green;">    public ContactListFrame  blocked      = null;</span>
    private AlertManager     alertManager = null;

/** @todo remove after testing */
<span style="color:teal;">@ GuiManager.java:147 @</span><span style="color:teal;font-weight:bold;"></span><span style="font-weight:bold;text-decoration:blink;"> public class GuiManager</span>
        contactList   = new ContactListFrame();
        configFrame   = new ConfigFrame(phoneFrame);
        listeners     = new ArrayList();
<span style="color:green;"></span><span style="color:green;">        blocked       = new ContactListFrame();</span>
        alertManager  = new AlertManager();
        logoPanel     = new JPanel(new FlowLayout(FlowLayout.CENTER));
        interlocutors = new InterlocutorsTableModel();
<span style="color:teal;">@ GuiManager.java:289 @</span><span style="color:teal;font-weight:bold;"></span><span style="font-weight:bold;text-decoration:blink;"> public class GuiManager</span>
    {
//        phoneFrame.contactBox.setEnabled(enabled);
        phoneFrame.dialButton.setEnabled(enabled);
<span style="color:green;"></span><span style="color:green;">        phoneFrame.forwardButton.setEnabled(enabled);</span>
<span style="color:green;"></span><span style="color:green;">        phoneFrame.blockButton.setEnabled(enabled);</span>
<span style="color:green;"></span><span style="color:green;">        phoneFrame.unblockButton.setEnabled(enabled);</span>
<span style="color:green;"></span><span style="color:green;">        phoneFrame.disableForwardButton.setEnabled(enabled);</span>
        phoneFrame.hangupButton.setEnabled(enabled);
        phoneFrame.answerButton.setEnabled(enabled);
    }
<span style="color:teal;">@ GuiManager.java:359 @</span><span style="color:teal;font-weight:bold;"></span><span style="font-weight:bold;text-decoration:blink;"> public class GuiManager</span>
            ( (UserActionListener) listeners.get(i)).handleDialRequest(commEvt);
        }
    }
<span style="color:green;"></span><span style="background-color:red;">    </span>
<span style="color:green;"></span><span style="color:green;">    void forwardButton_actionPerformed(EventObject evt)</span>
<span style="color:green;"></span><span style="color:green;">    {</span>
<span style="color:green;"></span><span style="color:green;">        //TODO temporarily close alerts from here.</span>
<span style="color:green;"></span><span style="background-color:red;">    </span>	<span style="color:green;">console.logEntry();</span>
<span style="color:green;"></span><span style="color:green;">        alertManager.stopAllAlerts();</span>
<span style="color:green;"></span><span style="color:green;">        String usr_who_forwards = phoneFrame.contactBox.getSelectedItem().toString();</span>
<span style="color:green;"></span><span style="color:green;">        if (usr_who_forwards == null || usr_who_forwards.trim().length() &lt; 1) {</span>
<span style="color:green;"></span><span style="color:green;">            return;</span>
<span style="color:green;"></span><span style="color:green;">        }</span>
<span style="color:green;"></span><span style="color:green;">        UserForwardEvent frwEvt = new UserForwardEvent(usr_who_forwards);</span>
<span style="color:green;"></span><span style="color:green;">        for (int i = listeners.size() - 1; i &gt;= 0; i--) {</span>
<span style="color:green;"></span><span style="color:green;">            ( (UserActionListener) listeners.get(i)).handleForwardRequest(frwEvt);</span>
<span style="color:green;"></span><span style="color:green;">        }</span>
<span style="color:green;"></span><span style="color:green;">        console.logExit();</span>
<span style="color:green;"></span><span style="color:green;">    }</span>
<span style="color:green;"></span><span style="background-color:red;">    </span>
<span style="color:green;"></span><span style="color:green;">    void blockButton_actionPerformed(EventObject evt)</span>
<span style="color:green;"></span><span style="color:green;">    {</span>
<span style="color:green;"></span><span style="color:green;">        //TODO temporarily close alerts from here.</span>
<span style="color:green;"></span><span style="color:green;">        alertManager.stopAllAlerts();</span>
<span style="color:green;"></span><span style="color:green;">        String block_usr = phoneFrame.contactBox.getSelectedItem().toString();</span>
<span style="color:green;"></span><span style="color:green;">        if (block_usr == null || block_usr.trim().length() &lt; 1) {</span>
<span style="color:green;"></span><span style="color:green;">            return;</span>
<span style="color:green;"></span><span style="color:green;">        }</span>
<span style="color:green;"></span><span style="color:green;">        UserBlockEvent blockEvt = new UserBlockEvent(block_usr);</span>
<span style="color:green;"></span><span style="color:green;">        for (int i = listeners.size() - 1; i &gt;= 0; i--) {</span>
<span style="color:green;"></span><span style="color:green;">            ( (UserActionListener) listeners.get(i)).handleBlockRequest(blockEvt);</span>
<span style="color:green;"></span><span style="color:green;">        }</span>
<span style="color:green;"></span><span style="color:green;">    }</span>
<span style="color:green;"></span><span style="background-color:red;">    </span>
<span style="color:green;"></span><span style="color:green;">    void unblockButton_actionPerformed(EventObject evt)</span>
<span style="color:green;"></span><span style="color:green;">    {</span>
<span style="color:green;"></span><span style="color:green;">        //TODO temporarily close alerts from here.</span>
<span style="color:green;"></span><span style="color:green;">        alertManager.stopAllAlerts();</span>
<span style="color:green;"></span><span style="color:green;">        String unblock_usr = phoneFrame.unblockButton.getSelectedItem().toString();</span>
<span style="color:green;"></span><span style="color:green;">        if (unblock_usr == null || unblock_usr.trim().length() &lt; 1) {</span>
<span style="color:green;"></span><span style="color:green;">            return;</span>
<span style="color:green;"></span><span style="color:green;">        }</span>
<span style="color:green;"></span><span style="color:green;">        UserUnblockEvent unblEvt = new UserUnblockEvent(unblock_usr);</span>
<span style="color:green;"></span><span style="color:green;">        for (int i = listeners.size() - 1; i &gt;= 0; i--) {</span>
<span style="color:green;"></span><span style="color:green;">            ( (UserActionListener) listeners.get(i)).handleUnblockRequest(unblEvt);</span>
<span style="color:green;"></span><span style="color:green;">        }</span>
<span style="color:gray;background-color:black;"></span><span style="color:green;background-color:black;"> </span>
<span style="color:green;"></span><span style="color:green;">    }</span>
<span style="color:green;"></span><span style="background-color:red;">    </span>
<span style="color:green;"></span><span style="color:green;">    void disableforwardButton_actionPerformed(EventObject evt)</span>
<span style="color:green;"></span><span style="color:green;">    {</span>
<span style="color:green;"></span><span style="color:green;">        //TODO temporarily close alerts from here.</span>
<span style="color:green;"></span><span style="color:green;">        alertManager.stopAllAlerts();</span>
<span style="color:green;"></span><span style="color:green;">        UserDisableForwardEvent stpEvt = new UserDisableForwardEvent(&quot;unforward&quot;);</span>
<span style="color:green;"></span><span style="color:green;">        for (int i = listeners.size() - 1; i &gt;= 0; i--) {</span>
<span style="color:green;"></span><span style="color:green;">            ( (UserActionListener) listeners.get(i)).handleDisableForwardRequest(stpEvt);</span>
<span style="color:green;"></span><span style="color:green;">        }</span>
<span style="color:green;"></span><span style="color:green;">    }</span>

    void hangupButton_actionPerformed(ActionEvent evt)
    {
<span style="color:teal;">@ GuiManager.java:700 @</span><span style="color:teal;font-weight:bold;"></span><span style="font-weight:bold;text-decoration:blink;"> public class GuiManager</span>
                hangupButton_actionPerformed(evt);
            }
        });
<span style="color:green;"></span><span style="color:green;">        phoneFrame.forwardButton.addActionListener(new ActionListener()</span>
<span style="color:green;"></span><span style="color:green;">        {</span>
<span style="color:green;"></span><span style="color:green;">            public void actionPerformed(ActionEvent evt)</span>
<span style="color:green;"></span><span style="color:green;">            {</span>
<span style="color:green;"></span><span style="color:green;">                forwardButton_actionPerformed(evt);</span>
<span style="color:green;"></span><span style="color:green;">            }</span>
<span style="color:green;"></span><span style="color:green;">        });</span>
<span style="color:green;"></span><span style="color:green;">        phoneFrame.disableForwardButton.addActionListener(new ActionListener()</span>
<span style="color:green;"></span><span style="color:green;">        {</span>
<span style="color:green;"></span><span style="color:green;">            public void actionPerformed(ActionEvent evt)</span>
<span style="color:green;"></span><span style="color:green;">            {</span>
<span style="color:green;"></span><span style="background-color:red;">            </span>	<span style="color:green;">disableforwardButton_actionPerformed(evt);</span>
<span style="color:green;"></span><span style="color:green;">            }</span>
<span style="color:green;"></span><span style="color:green;">        });</span>
<span style="color:green;"></span><span style="color:green;">        phoneFrame.blockButton.addActionListener(new ActionListener()</span>
<span style="color:green;"></span><span style="color:green;">        {</span>
<span style="color:green;"></span><span style="color:green;">            public void actionPerformed(ActionEvent evt)</span>
<span style="color:green;"></span><span style="color:green;">            {</span>
<span style="color:green;"></span><span style="color:green;">                blockButton_actionPerformed(evt);</span>
<span style="color:green;"></span><span style="color:green;">            }</span>
<span style="color:green;"></span><span style="color:green;">        });</span>
<span style="color:green;"></span><span style="color:green;">        phoneFrame.unblockButton.addActionListener(new ActionListener()</span>
<span style="color:green;"></span><span style="color:green;">        {</span>
<span style="color:green;"></span><span style="color:green;">            public void actionPerformed(ActionEvent evt)</span>
<span style="color:green;"></span><span style="color:green;">            {</span>
<span style="color:green;"></span><span style="background-color:red;">            </span>	<span style="color:green;">unblockButton_actionPerformed(evt);</span>
<span style="color:green;"></span><span style="color:green;">            }</span>
<span style="color:green;"></span><span style="color:green;">        });</span>
        phoneFrame.addWindowListener(new WindowAdapter()
        {
            public void windowClosing(WindowEvent evt)
<span style="color:teal;">@ GuiManager.java:762 @</span><span style="color:teal;font-weight:bold;"></span><span style="font-weight:bold;text-decoration:blink;"> public class GuiManager</span>
                                      String userName,
                                      char[] password)
    {
<span style="color:green;"></span><span style="background-color:red;">    </span>	<span style="color:green;">console.logEntry();</span>
        if (authenticationSplash != null)
            authenticationSplash.dispose();
        authenticationSplash = new AuthenticationSplash(phoneFrame, true);
<span style="color:teal;">@ GuiManager.java:775 @</span><span style="color:teal;font-weight:bold;"></span><span style="font-weight:bold;text-decoration:blink;"> public class GuiManager</span>
        if(realm != null)
            authenticationSplash.realmValueLabel.setText(new String(realm));
        authenticationSplash.show();
<span style="color:green;"></span><span style="color:green;">        console.debug(authenticationSplash.userName);</span>
<span style="color:green;"></span><span style="color:green;">        console.debug(new String(authenticationSplash.password));</span>
<span style="color:green;"></span><span style="color:green;">        console.logExit();</span>
    }

    public String getAuthenticationUserName()
<span style="font-weight:bold;">────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
modified: sip-communicator/src/net/java/sip/communicator/gui/PhoneFrame.java
────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
</span><span style="color:teal;font-weight:bold;">@ PhoneFrame.java:76 @</span><span style="font-weight:bold;text-decoration:blink;"> import javax.swing.border.*;</span>
 * @version 1.1
 *
 */
<span style="color:red;font-weight:bold;"></span><span style="color:red;font-weight:bold;text-decoration:blink;"></span><span style="color:red;font-weight:bold;">class PhoneFrame</span>
<span style="color:green;font-weight:bold;"></span><span style="color:green;font-weight:bold;text-decoration:blink;">public </span><span style="color:green;font-weight:bold;">class PhoneFrame</span>
    extends JFrame
{
    BorderLayout borderLayout1 = new BorderLayout();
<span style="color:teal;">@ PhoneFrame.java:98 @</span><span style="color:teal;font-weight:bold;"></span><span style="font-weight:bold;text-decoration:blink;"> class PhoneFrame</span>
    GridLayout gridLayout1 = new GridLayout();
    Border border6;
    Border border7;
<span style="color:green;"></span><span style="color:green;">    Border border71;</span>
    Border border8;
    JTable participantsTable = new JTable(30, 3);
    JMenuBar jMenuBar1 = new net.java.sip.communicator.gui.MenuBar();
<span style="color:teal;">@ PhoneFrame.java:114 @</span><span style="color:teal;font-weight:bold;"></span><span style="font-weight:bold;text-decoration:blink;"> class PhoneFrame</span>
    Border border14;
    BoxLayout boxLayout21 = new BoxLayout(videoPane, BoxLayout.Y_AXIS);
    Border border15;
<span style="color:green;"></span><span style="color:green;">    public String frwed = &quot;None yet&quot;;</span>

    private GuiManager guiManCallback = null;
    BorderLayout borderLayout4 = new BorderLayout();
<span style="color:green;"></span><span style="color:green;">    BorderLayout borderLayout41 = new BorderLayout();</span>
<span style="color:green;"></span><span style="background-color:red;">    </span>
<span style="color:green;"></span><span style="color:green;">    /**</span>
<span style="color:green;"></span><span style="color:green;">     * Dial GUI</span><span style="background-color:red;"> </span>
<span style="color:green;"></span><span style="color:green;">     */</span>
    JPanel dialPanel = new JPanel();
    JButton dialButton = new JButton();
    JComboBox contactBox = new JComboBox();
<span style="color:gray;background-color:black;"></span><span style="color:red;background-color:black;"> </span>
<span style="color:green;"></span><span style="background-color:red;">    </span>
<span style="color:green;"></span><span style="color:green;">    /**</span>
<span style="color:green;"></span><span style="color:green;">     * Call Forward GUI</span><span style="background-color:red;"> </span>
<span style="color:green;"></span><span style="color:green;">     */</span>
<span style="color:green;"></span><span style="color:green;">    JPanel forwardPanel = new JPanel();</span>
<span style="color:green;"></span><span style="color:green;">    JButton forwardButton = new JButton();</span>
<span style="color:green;"></span><span style="color:green;">    JButton disableForwardButton = new JButton();</span>
<span style="color:green;"></span><span style="color:green;">    JComboBox forwardBox = new JComboBox();</span>
<span style="color:green;"></span><span style="background-color:red;">    </span>
<span style="color:green;"></span><span style="color:green;">    //BorderLayout borderLayoutDialForward = new BorderLayout();</span>
<span style="color:green;"></span><span style="color:green;">    //JPanel dialAndForwardPanel = new JPanel();</span>
<span style="color:green;"></span><span style="background-color:red;">    </span>
<span style="color:green;"></span><span style="color:green;">    /**</span>
<span style="color:green;"></span><span style="color:green;">     * Block &amp; Unblock GUI</span>
<span style="color:green;"></span><span style="color:green;">     */</span>
<span style="color:green;"></span><span style="color:green;">    public JPanel blockPanel = new JPanel();</span>
<span style="color:green;"></span><span style="color:green;">    JButton blockButton = new JButton();</span>
<span style="color:green;"></span><span style="background-color:red;">    </span>
<span style="color:green;"></span><span style="color:green;">    String[] blockedpeople = {&quot;Blocked People&quot;};</span>
<span style="color:green;"></span><span style="color:green;">    public JComboBox unblockButton = new JComboBox(blockedpeople);</span>
<span style="color:green;"></span><span style="background-color:red;">    </span>
<span style="color:green;"></span><span style="color:green;">    JPanel forwardl = new JPanel();</span>
<span style="color:green;"></span><span style="color:green;">    public JLabel frwl = new JLabel();</span>
<span style="color:green;"></span><span style="color:green;">    Font myFont = new Font(&quot;Serif&quot;, Font.ITALIC | Font.BOLD, 12);</span>
<span style="color:green;"></span><span style="background-color:red;">    </span>
<span style="color:green;"></span><span style="color:green;">    BorderLayout borderLayoutDialForwardBlock = new BorderLayout();</span>
<span style="color:green;"></span><span style="color:green;">    JPanel dialForwardBlockPanel = new JPanel();</span>
<span style="color:green;"></span><span style="background-color:red;">    </span>
    public PhoneFrame(GuiManager guiManCallback) //throws HeadlessException
    {
        try {
<span style="color:teal;">@ PhoneFrame.java:173 @</span><span style="color:teal;font-weight:bold;"></span><span style="font-weight:bold;text-decoration:blink;"> class PhoneFrame</span>
            e.printStackTrace();
        }
    }
<span style="color:green;"></span><span style="background-color:red;">    </span>
<span style="color:green;"></span><span style="color:green;">    private void setupDialAndForwardPanel() throws Exception{</span>
<span style="color:green;"></span><span style="background-color:red;">    </span>	<span style="color:green;">borderLayoutDialForwardBlock.setHgap(10);</span>
<span style="color:green;"></span><span style="background-color:red;">    </span>	<span style="color:green;">dialForwardBlockPanel.setLayout(borderLayoutDialForwardBlock);</span>
<span style="color:green;"></span><span style="background-color:red;">    </span>	<span style="color:green;">dialForwardBlockPanel.setLayout(borderLayoutDialForwardBlock);</span>
<span style="color:green;"></span><span style="background-color:red;">    </span>	<span style="color:green;">dialForwardBlockPanel.setBorder(border8);</span>
<span style="color:green;"></span><span style="background-color:red;">    </span>	<span style="color:green;">dialForwardBlockPanel.setBorder(border8);</span>
<span style="color:green;"></span><span style="background-color:red;">        </span>
<span style="color:green;"></span><span style="color:green;">        borderLayout4.setHgap(10);</span>
<span style="color:green;"></span><span style="color:green;">        dialPanel.setLayout(borderLayout4);</span>
<span style="color:green;"></span><span style="color:green;">        dialPanel.setBorder(border7);</span>
<span style="color:green;"></span><span style="color:green;">        dialButton.setEnabled(false);</span>
<span style="color:green;"></span><span style="color:green;">        dialButton.setMnemonic('D');</span>
<span style="color:green;"></span><span style="color:green;">        dialButton.setText(&quot;Dial&quot;);</span>
<span style="color:green;"></span><span style="background-color:red;">        </span>
<span style="color:green;"></span><span style="color:green;">        contactBox.setBorder(null);</span>
<span style="color:green;"></span><span style="color:green;">        contactBox.setDebugGraphicsOptions(0);</span>
<span style="color:green;"></span><span style="color:green;">        contactBox.setActionMap(null);</span>
<span style="color:green;"></span><span style="color:green;">        contactBox.setEditable(true);</span>
<span style="color:green;"></span><span style="background-color:red;">        </span>
<span style="color:green;"></span><span style="color:green;">        borderLayout41.setHgap(10);</span>
<span style="color:green;"></span><span style="color:green;">        forwardPanel.setLayout(borderLayout41);</span>
<span style="color:green;"></span><span style="color:green;">        forwardPanel.setBorder(border71);</span>
<span style="color:green;"></span><span style="background-color:red;">        </span>
<span style="color:green;"></span><span style="color:green;">        borderLayout41.setHgap(10);</span>
<span style="color:green;"></span><span style="color:green;">        forwardl.setLayout(borderLayout41);</span>
<span style="color:green;"></span><span style="color:green;">        forwardl.setBorder(border71);</span>
<span style="color:green;"></span><span style="background-color:red;">        </span>
<span style="color:green;"></span><span style="color:green;">        forwardButton.setEnabled(false);</span>
<span style="color:green;"></span><span style="color:green;">        forwardButton.setMnemonic('F');</span>
<span style="color:green;"></span><span style="color:green;">        forwardButton.setText(&quot;Forward&quot;);</span>
<span style="color:green;"></span><span style="color:green;">        disableForwardButton.setEnabled(false);</span>
<span style="color:green;"></span><span style="color:green;">        disableForwardButton.setMnemonic('D');</span>
<span style="color:green;"></span><span style="color:green;">        disableForwardButton.setText(&quot;Disable Forward&quot;);</span>
<span style="color:green;"></span><span style="background-color:red;">        </span>
<span style="color:green;"></span><span style="background-color:red;">        </span>
<span style="color:green;"></span><span style="color:green;">        frwl.setText(&quot;Forward to: &quot;+frwed);</span>
<span style="color:green;"></span><span style="color:green;">        frwl.setFont(myFont);</span>
<span style="color:green;"></span><span style="background-color:red;">        </span>
<span style="color:green;"></span><span style="color:green;">        blockButton.setEnabled(false);</span>
<span style="color:green;"></span><span style="color:green;">        blockButton.setMnemonic('B');</span>
<span style="color:green;"></span><span style="color:green;">        blockButton.setText(&quot;Block&quot;);</span>
<span style="color:green;"></span><span style="color:green;">        unblockButton.setEnabled(false);</span>
<span style="color:green;"></span><span style="color:green;">        //unblockButton.setRenderer(new MyComboBoxRenderer(&quot;Unblock&quot;));</span>
<span style="color:green;"></span><span style="color:green;">        unblockButton.setSelectedIndex(0);</span>
<span style="color:green;"></span><span style="color:green;">        //unblockButton.addIt</span>
<span style="color:green;"></span><span style="background-color:red;">        </span>
<span style="color:green;"></span><span style="color:green;">        this.getContentPane().add(dialForwardBlockPanel, BorderLayout.NORTH);</span>
<span style="color:green;"></span><span style="color:green;">        dialForwardBlockPanel.add(dialPanel, BorderLayout.NORTH);</span>
<span style="color:green;"></span><span style="background-color:red;">        </span>
<span style="color:green;"></span><span style="color:green;">        dialForwardBlockPanel.add(forwardPanel, BorderLayout.CENTER);</span>
<span style="color:green;"></span><span style="color:green;">        dialForwardBlockPanel.add(blockPanel, BorderLayout.SOUTH);</span>
<span style="color:green;"></span><span style="background-color:red;">        </span>
<span style="color:green;"></span><span style="color:green;">        dialPanel.add(dialButton, BorderLayout.EAST);</span>
<span style="color:green;"></span><span style="color:green;">        dialPanel.add(contactBox, BorderLayout.CENTER);</span><span style="background-color:red;"> </span>
<span style="color:green;"></span><span style="background-color:red;">        </span>
<span style="color:green;"></span><span style="color:green;">        forwardPanel.add(forwardButton, BorderLayout.EAST);</span>
<span style="color:green;"></span><span style="color:green;">        forwardPanel.add(disableForwardButton, BorderLayout.WEST);</span>
<span style="color:green;"></span><span style="color:green;">        forwardPanel.add(frwl, BorderLayout.SOUTH);</span>
<span style="color:green;"></span><span style="background-color:red;">        </span>
<span style="color:green;"></span><span style="color:green;">        blockPanel.add(blockButton, BorderLayout.EAST);</span>
<span style="color:green;"></span><span style="color:green;">        blockPanel.add(unblockButton, BorderLayout.WEST);</span>
<span style="color:green;"></span><span style="background-color:red;">        </span>
<span style="color:green;"></span><span style="background-color:red;">        </span>
<span style="color:green;"></span><span style="color:green;">    }</span>

    private void jbInit() throws Exception
    {
<span style="color:teal;">@ PhoneFrame.java:255 @</span><span style="color:teal;font-weight:bold;"></span><span style="font-weight:bold;text-decoration:blink;"> class PhoneFrame</span>
        border5 = BorderFactory.createEmptyBorder(5, 5, 5, 5);
        border6 = BorderFactory.createEmptyBorder(5, 5, 5, 5);
        border7 = BorderFactory.createEmptyBorder(5, 5, 5, 5);
<span style="color:green;"></span><span style="color:green;">        border71 = BorderFactory.createEmptyBorder(5, 5, 5, 5);</span>
        border8 = BorderFactory.createEmptyBorder(5, 5, 5, 5);
<span style="color:green;"></span><span style="color:green;">        border9 = BorderFactory.createEmptyBorder(10, 10, 10, 10);</span>
<span style="color:green;"></span><span style="background-color:red;">        </span>
        border14 = BorderFactory.createEmptyBorder(4, 0, 0, 0);
        this.getContentPane().setLayout(borderLayout1);
        splitPane.setOrientation(JSplitPane.VERTICAL_SPLIT);
<span style="color:teal;">@ PhoneFrame.java:296 @</span><span style="color:teal;font-weight:bold;"></span><span style="font-weight:bold;text-decoration:blink;"> class PhoneFrame</span>
        registrationLabel.setText(&quot;Not Registered&quot;);
        statusPanel.setLayout(borderLayout5);
//        participantsTable.setMinimumSize(new Dimension(45, 300));
<span style="color:red;">        borderLayout4.setHgap(10);</span>
<span style="color:red;">        dialPanel.setLayout(borderLayout4);</span>
<span style="color:red;">        dialPanel.setBorder(border7);</span>
<span style="color:red;">        dialButton.setEnabled(false);</span>
<span style="color:red;">        dialButton.setMnemonic('D');</span>
<span style="color:red;">        dialButton.setText(&quot;Dial&quot;);</span>
<span style="color:red;">        contactBox.setBorder(null);</span>
<span style="color:red;">        contactBox.setDebugGraphicsOptions(0);</span>
<span style="color:red;">        contactBox.setActionMap(null);</span>
<span style="color:red;">        contactBox.setEditable(true);</span>
<span style="color:green;"></span><span style="background-color:red;">        </span>
<span style="color:green;"></span><span style="background-color:red;">        </span>
<span style="color:green;"></span><span style="background-color:red;">        </span>
        this.getContentPane().add(splitPane, BorderLayout.CENTER);
        splitPane.add(controlPanel, JSplitPane.BOTTOM);
        splitPane.add(videoPane, JSplitPane.TOP);
<span style="color:teal;">@ PhoneFrame.java:323 @</span><span style="color:teal;font-weight:bold;"></span><span style="font-weight:bold;text-decoration:blink;"> class PhoneFrame</span>
        participantsScroll.setViewportView(participantsTable);
        statusPanel.add(registrationLabel, BorderLayout.WEST);
        statusPanel.add(registrationAddressLabel, BorderLayout.CENTER);
<span style="color:red;">        this.getContentPane().add(dialPanel, BorderLayout.NORTH);</span>
<span style="color:red;">        dialPanel.add(dialButton, BorderLayout.EAST);</span>
<span style="color:red;">        dialPanel.add(contactBox, BorderLayout.CENTER);</span>
<span style="color:green;"></span><span style="background-color:red;">        </span>
<span style="color:green;"></span><span style="color:green;">        setupDialAndForwardPanel();</span><span style="background-color:red;"> </span>
<span style="color:green;"></span><span style="background-color:red;">        </span>
//        splitPane.setDividerLocation(200);
    }

<span style="color:teal;">@ PhoneFrame.java:338 @</span><span style="color:teal;font-weight:bold;"></span><span style="font-weight:bold;text-decoration:blink;"> class PhoneFrame</span>
//            System.exit(0);
//        }
//    }
<span style="color:green;"></span><span style="background-color:red;">    </span>

}
<span style="font-weight:bold;">────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
modified: sip-communicator/src/net/java/sip/communicator/gui/event/UserActionListener.java
────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
</span><span style="color:teal;font-weight:bold;">@ UserActionListener.java:75 @</span><span style="font-weight:bold;text-decoration:blink;"> public interface UserActionListener</span>
    extends java.util.EventListener
{
    public void handleDialRequest(UserCallInitiationEvent evt);
<span style="color:green;"></span><span style="background-color:red;">    </span>
<span style="color:green;"></span><span style="color:green;">    public void handleDisableForwardRequest(UserDisableForwardEvent evt);</span>
<span style="color:green;"></span><span style="background-color:red;">    </span>
<span style="color:green;"></span><span style="color:green;">    public void handleForwardRequest(UserForwardEvent evt);</span>
<span style="color:green;"></span><span style="background-color:red;">    </span>
<span style="color:green;"></span><span style="color:green;">    public void handleBlockRequest(UserBlockEvent evt);</span>
<span style="color:green;"></span><span style="background-color:red;">    </span>
<span style="color:green;"></span><span style="color:green;">    public void handleUnblockRequest(UserUnblockEvent evt);</span>

    public void handleHangupRequest(UserCallControlEvent evt);

<span style="font-weight:bold;">────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
added: sip-communicator/src/net/java/sip/communicator/gui/event/UserBlockEvent.java
────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
</span><span style="color:teal;font-weight:bold;">@ UserBlockEvent.java:4 @</span><span style="font-weight:bold;text-decoration:blink;"></span>
<span style="color:green;"></span><span style="color:green;">/* ====================================================================</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> * The Apache Software License, Version 1.1</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> *</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> * Copyright (c) 2000 The Apache Software Foundation.  All rights</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> * reserved.</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> *</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> * Redistribution and use in source and binary forms, with or without</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> * modification, are permitted provided that the following conditions</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> * are met:</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> *</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> * 1. Redistributions of source code must retain the above copyright</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> *    notice, this list of conditions and the following disclaimer.</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> *</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> * 2. Redistributions in binary form must reproduce the above copyright</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> *    notice, this list of conditions and the following disclaimer in</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> *    the documentation and/or other materials provided with the</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> *    distribution.</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> *</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> * 3. The end-user documentation included with the redistribution,</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> *    if any, must include the following acknowledgment:</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> *       &quot;This product includes software developed by the</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> *        Apache Software Foundation (http://www.apache.org/).&quot;</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> *    Alternately, this acknowledgment may appear in the software itself,</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> *    if and wherever such third-party acknowledgments normally appear.</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> *</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> * 4. The names &quot;Apache&quot; and &quot;Apache Software Foundation&quot; must</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> *    not be used to endorse or promote products derived from this</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> *    software without prior written permission. For written</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> *    permission, please contact apache@apache.org.</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> *</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> * 5. Products derived from this software may not be called &quot;Apache&quot;,</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> *    nor may &quot;Apache&quot; appear in their name, without prior written</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> *    permission of the Apache Software Foundation.</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> *</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> * SUCH DAMAGE.</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> * ====================================================================</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> *</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> * This software consists of voluntary contributions made by many</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> * individuals on behalf of the Apache Software Foundation.  For more</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> * information on the Apache Software Foundation, please see</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> * &lt;http://www.apache.org/&gt;.</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> *</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> * Portions of this software are based upon public domain software</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> * originally written at the National Center for Supercomputing Applications,</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> * University of Illinois, Urbana-Champaign.</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> */</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;">package net.java.sip.communicator.gui.event;</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;">import java.util.*;</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;">/**</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> * &lt;p&gt;Title: SIP COMMUNICATOR&lt;/p&gt;</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> * &lt;p&gt;Description:JAIN-SIP Audio/Video phone application&lt;/p&gt;</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> * &lt;p&gt;Copyright: Copyright (c) 2003&lt;/p&gt;</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> * @version 1.1</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> *</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> */</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;">public class UserBlockEvent</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;">    extends EventObject</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;">{</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;">    public UserBlockEvent(String blocked)</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;">    {</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;">        super(blocked);</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;">    }</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;">}</span>
\ No newline at end of file
<span style="font-weight:bold;">────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
added: sip-communicator/src/net/java/sip/communicator/gui/event/UserDisableForwardEvent.java
────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
</span><span style="color:teal;font-weight:bold;">@ UserDisableForwardEvent.java:4 @</span><span style="font-weight:bold;text-decoration:blink;"></span>
<span style="color:green;"></span><span style="color:green;">/* ====================================================================</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> * The Apache Software License, Version 1.1</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> *</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> * Copyright (c) 2000 The Apache Software Foundation.  All rights</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> * reserved.</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> *</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> * Redistribution and use in source and binary forms, with or without</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> * modification, are permitted provided that the following conditions</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> * are met:</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> *</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> * 1. Redistributions of source code must retain the above copyright</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> *    notice, this list of conditions and the following disclaimer.</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> *</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> * 2. Redistributions in binary form must reproduce the above copyright</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> *    notice, this list of conditions and the following disclaimer in</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> *    the documentation and/or other materials provided with the</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> *    distribution.</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> *</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> * 3. The end-user documentation included with the redistribution,</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> *    if any, must include the following acknowledgment:</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> *       &quot;This product includes software developed by the</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> *        Apache Software Foundation (http://www.apache.org/).&quot;</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> *    Alternately, this acknowledgment may appear in the software itself,</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> *    if and wherever such third-party acknowledgments normally appear.</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> *</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> * 4. The names &quot;Apache&quot; and &quot;Apache Software Foundation&quot; must</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> *    not be used to endorse or promote products derived from this</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> *    software without prior written permission. For written</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> *    permission, please contact apache@apache.org.</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> *</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> * 5. Products derived from this software may not be called &quot;Apache&quot;,</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> *    nor may &quot;Apache&quot; appear in their name, without prior written</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> *    permission of the Apache Software Foundation.</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> *</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> * SUCH DAMAGE.</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> * ====================================================================</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> *</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> * This software consists of voluntary contributions made by many</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> * individuals on behalf of the Apache Software Foundation.  For more</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> * information on the Apache Software Foundation, please see</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> * &lt;http://www.apache.org/&gt;.</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> *</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> * Portions of this software are based upon public domain software</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> * originally written at the National Center for Supercomputing Applications,</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> * University of Illinois, Urbana-Champaign.</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> */</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;">package net.java.sip.communicator.gui.event;</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;">import java.util.*;</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;">/**</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> * &lt;p&gt;Title: SIP COMMUNICATOR&lt;/p&gt;</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> * &lt;p&gt;Description:JAIN-SIP Audio/Video phone application&lt;/p&gt;</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> * &lt;p&gt;Copyright: Copyright (c) 2003&lt;/p&gt;</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> * @version 1.1</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> *</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> */</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;">public class UserDisableForwardEvent</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;">extends EventObject{</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="background-color:red;">	</span>
<span style="color:green;"></span>	<span style="color:green;">public UserDisableForwardEvent(String unforward){</span><span style="background-color:red;"></span>
<span style="color:green;"></span>		<span style="color:green;">super(unforward);</span><span style="background-color:red;"></span>
<span style="color:green;"></span>	<span style="color:green;">}</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;">}</span>
\ No newline at end of file
<span style="font-weight:bold;">────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
added: sip-communicator/src/net/java/sip/communicator/gui/event/UserForwardEvent.java
────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
</span><span style="color:teal;font-weight:bold;">@ UserForwardEvent.java:4 @</span><span style="font-weight:bold;text-decoration:blink;"></span>
<span style="color:green;"></span><span style="color:green;">/* ====================================================================</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> * The Apache Software License, Version 1.1</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> *</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> * Copyright (c) 2000 The Apache Software Foundation.  All rights</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> * reserved.</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> *</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> * Redistribution and use in source and binary forms, with or without</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> * modification, are permitted provided that the following conditions</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> * are met:</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> *</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> * 1. Redistributions of source code must retain the above copyright</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> *    notice, this list of conditions and the following disclaimer.</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> *</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> * 2. Redistributions in binary form must reproduce the above copyright</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> *    notice, this list of conditions and the following disclaimer in</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> *    the documentation and/or other materials provided with the</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> *    distribution.</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> *</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> * 3. The end-user documentation included with the redistribution,</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> *    if any, must include the following acknowledgment:</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> *       &quot;This product includes software developed by the</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> *        Apache Software Foundation (http://www.apache.org/).&quot;</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> *    Alternately, this acknowledgment may appear in the software itself,</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> *    if and wherever such third-party acknowledgments normally appear.</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> *</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> * 4. The names &quot;Apache&quot; and &quot;Apache Software Foundation&quot; must</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> *    not be used to endorse or promote products derived from this</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> *    software without prior written permission. For written</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> *    permission, please contact apache@apache.org.</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> *</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> * 5. Products derived from this software may not be called &quot;Apache&quot;,</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> *    nor may &quot;Apache&quot; appear in their name, without prior written</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> *    permission of the Apache Software Foundation.</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> *</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> * SUCH DAMAGE.</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> * ====================================================================</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> *</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> * This software consists of voluntary contributions made by many</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> * individuals on behalf of the Apache Software Foundation.  For more</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> * information on the Apache Software Foundation, please see</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> * &lt;http://www.apache.org/&gt;.</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> *</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> * Portions of this software are based upon public domain software</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> * originally written at the National Center for Supercomputing Applications,</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> * University of Illinois, Urbana-Champaign.</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> */</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;">package net.java.sip.communicator.gui.event;</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;">import java.util.*;</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;">/**</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> * &lt;p&gt;Title: SIP COMMUNICATOR&lt;/p&gt;</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> * &lt;p&gt;Description:JAIN-SIP Audio/Video phone application&lt;/p&gt;</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> * &lt;p&gt;Copyright: Copyright (c) 2003&lt;/p&gt;</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> * @version 1.1</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> *</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> */</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;">public class UserForwardEvent</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;">extends EventObject{</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="background-color:red;">	</span>
<span style="color:green;"></span>	<span style="color:green;">public UserForwardEvent(String usr_who_forwards){</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="background-color:red;">    </span>
<span style="color:green;"></span>		<span style="color:green;">super(usr_who_forwards);</span><span style="background-color:red;"></span>
<span style="color:green;"></span>	<span style="color:green;">}</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;">}</span>
\ No newline at end of file
<span style="font-weight:bold;">────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
added: sip-communicator/src/net/java/sip/communicator/gui/event/UserUnblockEvent.java
────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
</span><span style="color:teal;font-weight:bold;">@ UserUnblockEvent.java:4 @</span><span style="font-weight:bold;text-decoration:blink;"></span>
<span style="color:green;"></span><span style="color:green;">/* ====================================================================</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> * The Apache Software License, Version 1.1</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> *</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> * Copyright (c) 2000 The Apache Software Foundation.  All rights</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> * reserved.</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> *</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> * Redistribution and use in source and binary forms, with or without</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> * modification, are permitted provided that the following conditions</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> * are met:</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> *</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> * 1. Redistributions of source code must retain the above copyright</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> *    notice, this list of conditions and the following disclaimer.</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> *</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> * 2. Redistributions in binary form must reproduce the above copyright</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> *    notice, this list of conditions and the following disclaimer in</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> *    the documentation and/or other materials provided with the</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> *    distribution.</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> *</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> * 3. The end-user documentation included with the redistribution,</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> *    if any, must include the following acknowledgment:</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> *       &quot;This product includes software developed by the</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> *        Apache Software Foundation (http://www.apache.org/).&quot;</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> *    Alternately, this acknowledgment may appear in the software itself,</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> *    if and wherever such third-party acknowledgments normally appear.</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> *</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> * 4. The names &quot;Apache&quot; and &quot;Apache Software Foundation&quot; must</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> *    not be used to endorse or promote products derived from this</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> *    software without prior written permission. For written</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> *    permission, please contact apache@apache.org.</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> *</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> * 5. Products derived from this software may not be called &quot;Apache&quot;,</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> *    nor may &quot;Apache&quot; appear in their name, without prior written</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> *    permission of the Apache Software Foundation.</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> *</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> * SUCH DAMAGE.</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> * ====================================================================</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> *</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> * This software consists of voluntary contributions made by many</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> * individuals on behalf of the Apache Software Foundation.  For more</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> * information on the Apache Software Foundation, please see</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> * &lt;http://www.apache.org/&gt;.</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> *</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> * Portions of this software are based upon public domain software</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> * originally written at the National Center for Supercomputing Applications,</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> * University of Illinois, Urbana-Champaign.</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> */</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;">package net.java.sip.communicator.gui.event;</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;">import java.util.*;</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;">/**</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> * &lt;p&gt;Title: SIP COMMUNICATOR&lt;/p&gt;</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> * &lt;p&gt;Description:JAIN-SIP Audio/Video phone application&lt;/p&gt;</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> * &lt;p&gt;Copyright: Copyright (c) 2003&lt;/p&gt;</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> * @version 1.1</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> *</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;"> */</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;">public class UserUnblockEvent</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;">    extends EventObject</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;">{</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;">    public UserUnblockEvent(String unblock)</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;">    {</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;">        super(unblock);</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;">    }</span><span style="background-color:red;"></span>
<span style="color:green;"></span><span style="color:green;">}</span>
\ No newline at end of file
<span style="font-weight:bold;">────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
modified: sip-communicator/src/net/java/sip/communicator/sip/Call.java
────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
</span><span style="color:teal;font-weight:bold;">@ Call.java:106 @</span><span style="font-weight:bold;text-decoration:blink;"> public class Call</span>
     */
    private Request initialRequest = null;
    private String callState = &quot;&quot;;
<span style="color:green;"></span><span style="background-color:red;">    </span>
<span style="color:green;"></span><span style="color:green;">    /**</span>
<span style="color:green;"></span><span style="color:green;">     * Time of connection so that billing can occur</span>
<span style="color:green;"></span><span style="color:green;">     */</span>
<span style="color:green;"></span><span style="color:green;">    private long timeOfConnection = 0;</span>
<span style="color:green;"></span><span style="color:green;">    private long timeOfDisconnection = 0;</span>
<span style="color:green;"></span><span style="background-color:red;">    </span>
    //Event Management
    ArrayList listeners = new ArrayList();
    public String getState()
<span style="color:teal;">@ Call.java:149 @</span><span style="color:teal;font-weight:bold;"></span><span style="font-weight:bold;text-decoration:blink;"> public class Call</span>
        return remoteSdpDescription;
    }

<span style="color:red;font-weight:bold;">    void setState(String newStatus)</span><span style="color:red;font-weight:bold;text-decoration:blink;"></span><span style="color:red;font-weight:bold;"></span>
<span style="color:green;font-weight:bold;">    void setState(String newStatus)</span><span style="color:green;font-weight:bold;text-decoration:blink;"> </span><span style="color:green;font-weight:bold;"></span>
    {
        try
        {
<span style="color:teal;">@ Call.java:160 @</span><span style="color:teal;font-weight:bold;"></span><span style="font-weight:bold;text-decoration:blink;"> public class Call</span>

            if( console.isDebugEnabled() )
                console.debug(&quot;setting call status to &quot;+newStatus);
<span style="color:gray;background-color:black;"></span><span style="color:red;background-color:black;"> </span>
<span style="color:green;"></span><span style="background-color:red;">            </span>
<span style="color:green;"></span><span style="color:green;">            /**</span>
<span style="color:green;"></span><span style="color:green;">             * When the call changes to connected we must start the time counter</span>
<span style="color:green;"></span><span style="color:green;">             */</span>
<span style="color:green;"></span><span style="color:green;">            if(newStatus.equals(Call.CONNECTED) &amp;&amp; !callState.equals(Call.CONNECTED)){</span>
<span style="color:green;"></span><span style="background-color:red;">            </span>	<span style="color:green;">timeOfConnection = System.currentTimeMillis();</span>
<span style="color:green;"></span><span style="background-color:red;">            	</span>
<span style="color:green;"></span><span style="color:green;">            }</span>
<span style="color:green;"></span><span style="background-color:red;">            </span>
            String oldStatus = callState;
            this.callState = newStatus;
            fireCallStatusChangedEvent(oldStatus);
<span style="color:teal;">@ Call.java:240 @</span><span style="color:teal;font-weight:bold;"></span><span style="font-weight:bold;text-decoration:blink;"> public class Call</span>
    {
        this.initialRequest = request;
    }
<span style="color:green;"></span><span style="background-color:red;">    </span>
<span style="color:green;"></span><span style="color:green;">    Request getInitialRequest()</span>
<span style="color:green;"></span><span style="color:green;">    {</span>
<span style="color:green;"></span><span style="color:green;">        return this.initialRequest;</span>
<span style="color:green;"></span><span style="color:green;">    }</span>

    String getDialogID()
    {
<span style="color:teal;">@ Call.java:273 @</span><span style="color:teal;font-weight:bold;"></span><span style="font-weight:bold;text-decoration:blink;"> public class Call</span>
            ( (CallListener) listeners.get(i)).callStateChanged(evt);
        }
    }
<span style="color:gray;background-color:black;"></span><span style="color:green;background-color:black;"> </span>
<span style="color:green;"></span>	<span style="color:green;">public long getTimeOfConnection() {</span>
<span style="color:green;"></span>		<span style="color:green;">return timeOfConnection;</span>
<span style="color:green;"></span>	<span style="color:green;">}</span>
<span style="color:gray;background-color:black;"></span><span style="color:green;background-color:black;"> </span>
<span style="color:green;"></span>	<span style="color:green;">public void setTimeOfConnection(long timeOfConnection) {</span>
<span style="color:green;"></span>		<span style="color:green;">this.timeOfConnection = timeOfConnection;</span>
<span style="color:green;"></span>	<span style="color:green;">}</span>
}
\ No newline at end of file
<span style="font-weight:bold;">────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
added: sip-communicator/src/net/java/sip/communicator/sip/CallBlockProcessing.java
────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
</span><span style="color:teal;font-weight:bold;">@ CallBlockProcessing.java:4 @</span><span style="font-weight:bold;text-decoration:blink;"></span>
<span style="color:green;"></span><span style="color:green;">package net.java.sip.communicator.sip;</span>
<span style="color:gray;background-color:black;"></span><span style="color:green;background-color:black;"> </span>
<span style="color:green;"></span><span style="color:green;">import java.text.ParseException;</span>
<span style="color:green;"></span><span style="color:green;">import java.util.ArrayList;</span>
<span style="color:gray;background-color:black;"></span><span style="color:green;background-color:black;"> </span>
<span style="color:green;"></span><span style="color:green;">import javax.sip.ClientTransaction;</span>
<span style="color:green;"></span><span style="color:green;">import javax.sip.InvalidArgumentException;</span>
<span style="color:green;"></span><span style="color:green;">import javax.sip.TransactionUnavailableException;</span>
<span style="color:green;"></span><span style="color:green;">import javax.sip.address.Address;</span>
<span style="color:green;"></span><span style="color:green;">import javax.sip.address.URI;</span>
<span style="color:green;"></span><span style="color:green;">import javax.sip.header.CSeqHeader;</span>
<span style="color:green;"></span><span style="color:green;">import javax.sip.header.CallIdHeader;</span>
<span style="color:green;"></span><span style="color:green;">import javax.sip.header.ContactHeader;</span>
<span style="color:green;"></span><span style="color:green;">import javax.sip.header.ExpiresHeader;</span>
<span style="color:green;"></span><span style="color:green;">import javax.sip.header.FromHeader;</span>
<span style="color:green;"></span><span style="color:green;">import javax.sip.header.MaxForwardsHeader;</span>
<span style="color:green;"></span><span style="color:green;">import javax.sip.header.ToHeader;</span>
<span style="color:green;"></span><span style="color:green;">import javax.sip.message.Request;</span>
<span style="color:green;"></span><span style="color:green;">import javax.sip.message.Response;</span>
<span style="color:gray;background-color:black;"></span><span style="color:green;background-color:black;"> </span>
<span style="color:green;"></span><span style="color:green;">import net.java.sip.communicator.common.Console;</span>
<span style="color:gray;background-color:black;"></span><span style="color:green;background-color:black;"> </span>
<span style="color:green;"></span><span style="color:green;">public class CallBlockProcessing {</span>
<span style="color:green;"></span>	<span style="color:green;">private static final Console console =</span>
<span style="color:green;"></span>	<span style="color:green;">        Console.getConsole(CallBlockProcessing.class);</span>
<span style="color:green;"></span>	<span style="color:green;">private SipManager sipManCallback = null;</span>
<span style="color:green;"></span>	<span style="color:green;">private Request blockRequest = null;</span>
<span style="color:green;"></span>	<span style="color:green;">private boolean forwardeeURI = false;</span>
<span style="color:gray;background-color:black;"></span><span style="color:green;background-color:black;"> </span>
<span style="color:green;"></span>	<span style="color:green;">CallBlockProcessing(SipManager sipManCallback)</span>
<span style="color:green;"></span><span style="color:green;">    {</span>
<span style="color:green;"></span><span style="color:green;">        this.sipManCallback = sipManCallback;</span>
<span style="color:green;"></span><span style="color:green;">    }</span>
<span style="color:gray;background-color:black;"></span><span style="color:green;background-color:black;"> </span>
<span style="color:green;"></span><span style="color:green;">    void setSipManagerCallBack(SipManager sipManCallback)</span>
<span style="color:green;"></span><span style="color:green;">    {</span>
<span style="color:green;"></span><span style="color:green;">        this.sipManCallback = sipManCallback;</span>
<span style="color:green;"></span><span style="color:green;">    }</span>
<span style="color:green;"></span><span style="background-color:red;">    </span>
<span style="color:green;"></span><span style="color:green;">    void blockOK(ClientTransaction clientTransaction, Response response)</span>
<span style="color:green;"></span><span style="color:green;">    {</span>
<span style="color:green;"></span><span style="color:green;">        try {</span>
<span style="color:green;"></span><span style="color:green;">            console.logEntry();</span>
<span style="color:green;"></span><span style="background-color:red;">            </span>
<span style="color:green;"></span><span style="color:green;">            // Get the request that was accepted</span>
<span style="color:green;"></span><span style="color:green;">            Request request = clientTransaction.getRequest();</span>
<span style="color:green;"></span><span style="background-color:red;">            </span>
<span style="color:green;"></span><span style="color:green;">            // Save the forwardee URI</span>
<span style="color:green;"></span><span style="color:green;">            URI forwardeeURI = request.getRequestURI();</span>
<span style="color:green;"></span><span style="background-color:red;">            </span>
<span style="color:green;"></span><span style="color:green;">            // Fire forwarded ok to pass the information to all listeners</span>
<span style="color:green;"></span><span style="color:green;">            sipManCallback.fireBlocked(forwardeeURI.toString());</span>
<span style="color:green;"></span><span style="background-color:red;">            </span>
<span style="color:green;"></span><span style="color:green;">        }</span>
<span style="color:green;"></span><span style="color:green;">        finally {</span>
<span style="color:green;"></span><span style="color:green;">            console.logExit();</span>
<span style="color:green;"></span><span style="color:green;">        }</span>
<span style="color:green;"></span><span style="color:green;">    }</span>
<span style="color:green;"></span><span style="background-color:red;">    </span>
<span style="color:green;"></span><span style="color:green;">    void unblockOK(ClientTransaction clientTransaction, Response response)</span>
<span style="color:green;"></span><span style="color:green;">    {</span>
<span style="color:green;"></span><span style="color:green;">        try {</span>
<span style="color:green;"></span><span style="color:green;">            console.logEntry();</span>
<span style="color:green;"></span><span style="background-color:red;">            </span>
<span style="color:green;"></span><span style="color:green;">            // Get the request that was accepted</span>
<span style="color:green;"></span><span style="color:green;">            Request request = clientTransaction.getRequest();</span>
<span style="color:green;"></span><span style="background-color:red;">            </span>
<span style="color:green;"></span><span style="color:green;">            // Save the forwardee URI</span>
<span style="color:green;"></span><span style="color:green;">            URI forwardeeURI = request.getRequestURI();</span>
<span style="color:green;"></span><span style="background-color:red;">            </span>
<span style="color:green;"></span><span style="color:green;">            // Fire forwarded ok to pass the information to all listeners</span>
<span style="color:green;"></span><span style="color:green;">            sipManCallback.fireUnblocked(forwardeeURI.toString());</span>
<span style="color:green;"></span><span style="background-color:red;">            </span>
<span style="color:green;"></span><span style="color:green;">        }</span>
<span style="color:green;"></span><span style="color:green;">        finally {</span>
<span style="color:green;"></span><span style="color:green;">            console.logExit();</span>
<span style="color:green;"></span><span style="color:green;">        }</span>
<span style="color:green;"></span><span style="color:green;">    }</span>
<span style="color:green;"></span><span style="background-color:red;">    </span>
<span style="color:green;"></span><span style="background-color:red;">    </span>
<span style="color:green;"></span><span style="background-color:red;">    </span>
<span style="color:green;"></span><span style="background-color:red;">	</span>
<span style="color:green;"></span>	<span style="color:green;">synchronized void block(String registrarAddress, int registrarPort,</span>
<span style="color:green;"></span><span style="color:green;">            String registrarTransport, int expires, String addressToBlock, String blockOrUnblock) throws</span>
<span style="color:green;"></span>	<span style="color:green;">   CommunicationsException</span>
<span style="color:green;"></span>	<span style="color:green;">{</span>
<span style="color:green;"></span>	<span style="color:green;">  try</span>
<span style="color:green;"></span>	<span style="color:green;">  {</span>
<span style="color:green;"></span>	<span style="color:green;">      console.logEntry();</span>
<span style="color:green;"></span>	<span style="color:green;">      console.debug(&quot;Address to block: &quot; + addressToBlock);</span>
<span style="color:green;"></span><span style="background-color:red;">	      </span>
<span style="color:green;"></span>	<span style="color:green;">      //Get the From Header and address</span>
<span style="color:green;"></span>	<span style="color:green;">      FromHeader fromHeader = sipManCallback.getFromHeader();</span>
<span style="color:green;"></span>	<span style="color:green;">      Address fromAddress = fromHeader.getAddress();</span>
<span style="color:green;"></span>	<span style="color:green;">      console.debug(&quot;From Header: &quot; + fromHeader);</span>
<span style="color:green;"></span><span style="background-color:red;">	      </span>
<span style="color:green;"></span>	<span style="color:green;">      /**</span>
<span style="color:green;"></span>	<span style="color:green;">       * TODO: GUI CALL Fix later</span>
<span style="color:green;"></span>	<span style="color:green;">       */</span>
<span style="color:green;"></span>	<span style="color:green;">      //sipManCallback.fireRegistering(fromAddress.toString());</span>
<span style="color:green;"></span><span style="background-color:red;">	      </span>
<span style="color:green;"></span>	<span style="color:green;">      //Make the blockee address in a URI</span>
<span style="color:green;"></span><span style="color:green;">          URI requestURI = ProcessingUtilities.createUriFromAddress(addressToBlock, sipManCallback, console);</span>
<span style="color:green;"></span>	<span style="color:green;">      CallIdHeader callIdHeader = sipManCallback.sipProvider.getNewCallId();</span>
<span style="color:green;"></span>	<span style="color:green;">      CSeqHeader cSeqHeader = ProcessingUtilities.safeCSeqHeader(1, Request.UPDATE, sipManCallback, console);</span>
<span style="color:green;"></span>	<span style="color:green;">      ToHeader toHeader = ProcessingUtilities.headerFromAddress(fromAddress, sipManCallback, console);</span>
<span style="color:green;"></span>	<span style="color:green;">      ArrayList viaHeaders = sipManCallback.getLocalViaHeaders();</span>
<span style="color:green;"></span>	<span style="color:green;">      MaxForwardsHeader maxForwardsHeader = sipManCallback.</span>
<span style="color:green;"></span>	<span style="color:green;">          getMaxForwardsHeader();</span>
<span style="color:green;"></span><span style="background-color:red;">	      </span>
<span style="color:green;"></span>	<span style="color:green;">      /**</span>
<span style="color:green;"></span>	<span style="color:green;">       * Make the request and then add an expires and a contact header</span>
<span style="color:green;"></span>	<span style="color:green;">       */</span>
<span style="color:green;"></span>	<span style="color:green;">      Request request = null;</span>
<span style="color:green;"></span>	<span style="color:green;">      if(blockOrUnblock == &quot;block&quot;){</span>
<span style="color:green;"></span>		<span style="color:green;">      try {</span>
<span style="color:green;"></span>		<span style="color:green;">          request = sipManCallback.messageFactory.createRequest(requestURI,</span>
<span style="color:green;"></span>		<span style="color:green;">              &quot;BLOCK &quot;,</span>
<span style="color:green;"></span>		<span style="color:green;">              callIdHeader,</span>
<span style="color:green;"></span>		<span style="color:green;">              cSeqHeader, fromHeader, toHeader,</span>
<span style="color:green;"></span>		<span style="color:green;">              viaHeaders,</span>
<span style="color:green;"></span>		<span style="color:green;">              maxForwardsHeader);</span>
<span style="color:green;"></span>		<span style="color:green;">      }</span>
<span style="color:green;"></span>		<span style="color:green;">      catch (ParseException ex) {</span>
<span style="color:green;"></span>		<span style="color:green;">          console.error(&quot;Could not create the register request!&quot;, ex);</span>
<span style="color:green;"></span>		<span style="color:green;">          //throw was missing - reported by Eero Vaarnas</span>
<span style="color:green;"></span>		<span style="color:green;">          throw new CommunicationsException(</span>
<span style="color:green;"></span>		<span style="color:green;">              &quot;Could not create the register request!&quot;,</span>
<span style="color:green;"></span>		<span style="color:green;">              ex);</span>
<span style="color:green;"></span>		<span style="color:green;">      }</span>
<span style="color:green;"></span>	<span style="color:green;">      }</span>
<span style="color:green;"></span>	<span style="color:green;">      else{</span>
<span style="color:green;"></span>	<span style="background-color:red;">    </span>	<span style="color:green;">  try {</span>
<span style="color:green;"></span>		<span style="color:green;">          request = sipManCallback.messageFactory.createRequest(requestURI,</span>
<span style="color:green;"></span>		<span style="color:green;">              &quot;UNBLOCK &quot;,</span>
<span style="color:green;"></span>		<span style="color:green;">              callIdHeader,</span>
<span style="color:green;"></span>		<span style="color:green;">              cSeqHeader, fromHeader, toHeader,</span>
<span style="color:green;"></span>		<span style="color:green;">              viaHeaders,</span>
<span style="color:green;"></span>		<span style="color:green;">              maxForwardsHeader);</span>
<span style="color:green;"></span>		<span style="color:green;">      }</span>
<span style="color:green;"></span>		<span style="color:green;">      catch (ParseException ex) {</span>
<span style="color:green;"></span>		<span style="color:green;">          console.error(&quot;Could not create the register request!&quot;, ex);</span>
<span style="color:green;"></span>		<span style="color:green;">          //throw was missing - reported by Eero Vaarnas</span>
<span style="color:green;"></span>		<span style="color:green;">          throw new CommunicationsException(</span>
<span style="color:green;"></span>		<span style="color:green;">              &quot;Could not create the register request!&quot;,</span>
<span style="color:green;"></span>		<span style="color:green;">              ex);</span>
<span style="color:green;"></span>		<span style="color:green;">      }</span>
<span style="color:green;"></span>	<span style="color:green;">      }</span>
<span style="color:green;"></span><span style="background-color:red;">	      </span>
<span style="color:green;"></span>	<span style="color:green;">      //Expires Header</span>
<span style="color:green;"></span>	<span style="color:green;">      ExpiresHeader expHeader = null;</span>
<span style="color:green;"></span>	<span style="color:green;">      for (int retry = 0; retry &lt; 2; retry++) {</span>
<span style="color:green;"></span>	<span style="color:green;">          try {</span>
<span style="color:green;"></span>	<span style="color:green;">              expHeader = sipManCallback.headerFactory.createExpiresHeader(</span>
<span style="color:green;"></span>	<span style="color:green;">                  expires);</span>
<span style="color:green;"></span>	<span style="color:green;">          }</span>
<span style="color:green;"></span>	<span style="color:green;">          catch (InvalidArgumentException ex) {</span>
<span style="color:green;"></span>	<span style="color:green;">              if (retry == 0) {</span>
<span style="color:green;"></span>	<span style="color:green;">                  expires = 3600;</span>
<span style="color:green;"></span>	<span style="color:green;">                  continue;</span>
<span style="color:green;"></span>	<span style="color:green;">              }</span>
<span style="color:green;"></span>	<span style="color:green;">              console.error(</span>
<span style="color:green;"></span>	<span style="color:green;">                  &quot;Invalid registrations expiration parameter - &quot;</span>
<span style="color:green;"></span>	<span style="color:green;">                  + expires,</span>
<span style="color:green;"></span>	<span style="color:green;">                  ex);</span>
<span style="color:green;"></span>	<span style="color:green;">              throw new CommunicationsException(</span>
<span style="color:green;"></span>	<span style="color:green;">                  &quot;Invalid registrations expiration parameter - &quot;</span>
<span style="color:green;"></span>	<span style="color:green;">                  + expires,</span>
<span style="color:green;"></span>	<span style="color:green;">                  ex);</span>
<span style="color:green;"></span>	<span style="color:green;">          }</span>
<span style="color:green;"></span>	<span style="color:green;">      }</span>
<span style="color:green;"></span>	<span style="color:green;">      request.addHeader(expHeader);</span>
<span style="color:green;"></span>	<span style="color:green;">      //Contact Header should contain IP - bug report - Eero Vaarnas</span>
<span style="color:green;"></span>	<span style="color:green;">      ContactHeader contactHeader = sipManCallback.</span>
<span style="color:green;"></span>	<span style="color:green;">          getRegistrationContactHeader();</span>
<span style="color:green;"></span>	<span style="color:green;">      request.addHeader(contactHeader);</span>
<span style="color:green;"></span><span style="background-color:red;">	      </span>
<span style="color:green;"></span>	<span style="color:green;">      console.debug(request);</span>
<span style="color:green;"></span><span style="background-color:red;">	      </span>
<span style="color:green;"></span>	<span style="color:green;">      //Transaction</span>
<span style="color:green;"></span>	<span style="color:green;">      ClientTransaction blockTrans = null;</span>
<span style="color:green;"></span>	<span style="color:green;">      try {</span>
<span style="color:green;"></span>	<span style="background-color:red;">    </span>	<span style="color:green;">  blockTrans = sipManCallback.sipProvider.getNewClientTransaction(</span>
<span style="color:green;"></span>	<span style="color:green;">              request);</span>
<span style="color:green;"></span>	<span style="color:green;">      }</span>
<span style="color:green;"></span>	<span style="color:green;">      catch (TransactionUnavailableException ex) {</span>
<span style="color:green;"></span>	<span style="color:green;">          console.error(&quot;Could not create a block transaction!\n&quot;</span>
<span style="color:green;"></span>	<span style="color:green;">                        + &quot;Check that the Registrar address is correct!&quot;,</span>
<span style="color:green;"></span>	<span style="color:green;">                        ex);</span>
<span style="color:green;"></span>	<span style="color:green;">          //throw was missing - reported by Eero Vaarnas</span>
<span style="color:green;"></span>	<span style="color:green;">          throw new CommunicationsException(</span>
<span style="color:green;"></span>	<span style="color:green;">              &quot;Could not create a block transaction!\n&quot;</span>
<span style="color:green;"></span>	<span style="color:green;">              + &quot;Check that the Registrar address is correct!&quot;);</span>
<span style="color:green;"></span>	<span style="color:green;">      }</span>
<span style="color:green;"></span>	<span style="color:green;">      try {</span>
<span style="color:green;"></span>	<span style="background-color:red;">    </span>	<span style="color:green;">  blockTrans.sendRequest();</span>
<span style="color:green;"></span>	<span style="color:green;">          if( console.isDebugEnabled() )</span>
<span style="color:green;"></span>	<span style="color:green;">              console.debug(&quot;sent request= &quot; + request);</span>
<span style="color:green;"></span>	<span style="color:green;">          //[issue 2] Schedule re registrations</span>
<span style="color:green;"></span>	<span style="color:green;">          //bug reported by LynlvL@netscape.com</span>
<span style="color:green;"></span><span style="background-color:red;">	          </span>
<span style="color:green;"></span>	<span style="color:green;">          //scheduleReRegistration( registrarAddress, registrarPort,</span>
<span style="color:green;"></span>	<span style="color:green;">          //            registrarTransport, expires);</span>
<span style="color:green;"></span><span style="background-color:red;">	</span>
<span style="color:green;"></span>	<span style="color:green;">      }</span>
<span style="color:green;"></span>	<span style="color:green;">      //we sometimes get a null pointer exception here so catch them all</span>
<span style="color:green;"></span>	<span style="color:green;">      catch (Exception ex) {</span>
<span style="color:green;"></span>	<span style="color:green;">          console.error(&quot;Could not send out the block request!&quot;, ex);</span>
<span style="color:green;"></span>	<span style="color:green;">          //throw was missing - reported by Eero Vaarnas</span>
<span style="color:green;"></span>	<span style="color:green;">          throw new CommunicationsException(</span>
<span style="color:green;"></span>	<span style="color:green;">              &quot;Could not send out the block request!&quot;, ex);</span>
<span style="color:green;"></span>	<span style="color:green;">      }</span>
<span style="color:green;"></span>	<span style="color:green;">      console.debug(blockTrans);</span>
<span style="color:green;"></span>	<span style="color:green;">      this.blockRequest = request;</span>
<span style="color:green;"></span><span style="background-color:red;">	      </span>
<span style="color:green;"></span>	<span style="color:green;">  }</span>
<span style="color:green;"></span>	<span style="color:green;">  finally</span>
<span style="color:green;"></span>	<span style="color:green;">  {</span>
<span style="color:green;"></span>	<span style="color:green;">      console.logExit();</span>
<span style="color:green;"></span>	<span style="color:green;">  }</span>
<span style="color:green;"></span><span style="background-color:red;">	</span>
<span style="color:green;"></span>	<span style="color:green;">}</span>
<span style="color:green;"></span><span style="background-color:red;">	</span>
<span style="color:green;"></span><span style="background-color:red;">	</span>
<span style="color:green;"></span><span style="color:green;">}</span>
<span style="font-weight:bold;">────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
added: sip-communicator/src/net/java/sip/communicator/sip/CallForwardProcessing.java
────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
</span><span style="color:teal;font-weight:bold;">@ CallForwardProcessing.java:4 @</span><span style="font-weight:bold;text-decoration:blink;"></span>
<span style="color:green;"></span><span style="color:green;">package net.java.sip.communicator.sip;</span>
<span style="color:gray;background-color:black;"></span><span style="color:green;background-color:black;"> </span>
<span style="color:green;"></span><span style="color:green;">import java.text.ParseException;</span>
<span style="color:green;"></span><span style="color:green;">import java.util.ArrayList;</span>
<span style="color:green;"></span><span style="color:green;">import java.util.Timer;</span>
<span style="color:gray;background-color:black;"></span><span style="color:green;background-color:black;"> </span>
<span style="color:green;"></span><span style="color:green;">import javax.sip.ClientTransaction;</span>
<span style="color:green;"></span><span style="color:green;">import javax.sip.InvalidArgumentException;</span>
<span style="color:green;"></span><span style="color:green;">import javax.sip.TransactionUnavailableException;</span>
<span style="color:green;"></span><span style="color:green;">import javax.sip.address.Address;</span>
<span style="color:green;"></span><span style="color:green;">import javax.sip.address.SipURI;</span>
<span style="color:green;"></span><span style="color:green;">import javax.sip.address.URI;</span>
<span style="color:green;"></span><span style="color:green;">import javax.sip.header.CSeqHeader;</span>
<span style="color:green;"></span><span style="color:green;">import javax.sip.header.CallIdHeader;</span>
<span style="color:green;"></span><span style="color:green;">import javax.sip.header.ContactHeader;</span>
<span style="color:green;"></span><span style="color:green;">import javax.sip.header.ExpiresHeader;</span>
<span style="color:green;"></span><span style="color:green;">import javax.sip.header.FromHeader;</span>
<span style="color:green;"></span><span style="color:green;">import javax.sip.header.MaxForwardsHeader;</span>
<span style="color:green;"></span><span style="color:green;">import javax.sip.header.ToHeader;</span>
<span style="color:green;"></span><span style="color:green;">import javax.sip.message.Request;</span>
<span style="color:green;"></span><span style="color:green;">import javax.sip.message.Response;</span>
<span style="color:gray;background-color:black;"></span><span style="color:green;background-color:black;"> </span>
<span style="color:green;"></span><span style="color:green;">import net.java.sip.communicator.common.Console;</span>
<span style="color:gray;background-color:black;"></span><span style="color:green;background-color:black;"> </span>
<span style="color:green;"></span><span style="color:green;">public class CallForwardProcessing {</span>
<span style="color:green;"></span><span style="background-color:red;">	</span>
<span style="color:green;"></span>	<span style="color:green;">private static final Console console =</span>
<span style="color:green;"></span>	<span style="color:green;">        Console.getConsole(CallForwardProcessing.class);</span>
<span style="color:green;"></span>	<span style="color:green;">private SipManager sipManCallback = null;</span>
<span style="color:green;"></span>	<span style="color:green;">private Request forwardRequest = null;</span>
<span style="color:green;"></span>	<span style="color:green;">private boolean forwardeeURI = false;</span>
<span style="color:gray;background-color:black;"></span><span style="color:green;background-color:black;"> </span>
<span style="color:green;"></span>	<span style="color:green;">CallForwardProcessing(SipManager sipManCallback)</span>
<span style="color:green;"></span><span style="color:green;">    {</span>
<span style="color:green;"></span><span style="color:green;">        this.sipManCallback = sipManCallback;</span>
<span style="color:green;"></span><span style="color:green;">    }</span>
<span style="color:gray;background-color:black;"></span><span style="color:green;background-color:black;"> </span>
<span style="color:green;"></span><span style="color:green;">    void setSipManagerCallBack(SipManager sipManCallback)</span>
<span style="color:green;"></span><span style="color:green;">    {</span>
<span style="color:green;"></span><span style="color:green;">        this.sipManCallback = sipManCallback;</span>
<span style="color:green;"></span><span style="color:green;">    }</span>
<span style="color:green;"></span><span style="background-color:red;">    </span>
<span style="color:green;"></span><span style="color:green;">    void forwardOK(ClientTransaction clientTransaction, Response response)</span>
<span style="color:green;"></span><span style="color:green;">    {</span>
<span style="color:green;"></span><span style="color:green;">        try {</span>
<span style="color:green;"></span><span style="color:green;">            console.logEntry();</span>
<span style="color:green;"></span><span style="background-color:red;">            </span>
<span style="color:green;"></span><span style="color:green;">            // Get the request that was accepted</span>
<span style="color:green;"></span><span style="color:green;">            Request request = clientTransaction.getRequest();</span>
<span style="color:green;"></span><span style="background-color:red;">            </span>
<span style="color:green;"></span><span style="color:green;">            // Save the forwardee URI</span>
<span style="color:green;"></span><span style="color:green;">            URI forwardeeURI = request.getRequestURI();</span>
<span style="color:green;"></span><span style="background-color:red;">            </span>
<span style="color:green;"></span><span style="color:green;">            // Fire forwarded ok to pass the information to all listeners</span>
<span style="color:green;"></span><span style="color:green;">            sipManCallback.fireEnabledForward(forwardeeURI.toString());</span>
<span style="color:green;"></span><span style="background-color:red;">            </span>
<span style="color:green;"></span><span style="color:green;">        }</span>
<span style="color:green;"></span><span style="color:green;">        finally {</span>
<span style="color:green;"></span><span style="color:green;">            console.logExit();</span>
<span style="color:green;"></span><span style="color:green;">        }</span>
<span style="color:green;"></span><span style="color:green;">    }</span>
<span style="color:green;"></span><span style="background-color:red;">    </span>
<span style="color:green;"></span><span style="color:green;">    void unforwardOK(ClientTransaction clientTransaction, Response response)</span>
<span style="color:green;"></span><span style="color:green;">    {</span>
<span style="color:green;"></span><span style="color:green;">        try {</span>
<span style="color:green;"></span><span style="color:green;">            console.logEntry();</span>
<span style="color:green;"></span><span style="background-color:red;">            </span>
<span style="color:green;"></span><span style="color:green;">            // Get the request that was accepted</span>
<span style="color:green;"></span><span style="color:green;">            Request request = clientTransaction.getRequest();</span>
<span style="color:green;"></span><span style="background-color:red;">            </span>
<span style="color:green;"></span><span style="color:green;">            // Save the forwardee URI</span>
<span style="color:green;"></span><span style="color:green;">            URI forwardeeURI = request.getRequestURI();</span>
<span style="color:green;"></span><span style="background-color:red;">            </span>
<span style="color:green;"></span><span style="color:green;">            // Fire forwarded ok to pass the information to all listeners</span>
<span style="color:green;"></span><span style="color:green;">            sipManCallback.fireDisabledForward(&quot;None&quot;);</span>
<span style="color:green;"></span><span style="background-color:red;">            </span>
<span style="color:green;"></span><span style="color:green;">        }</span>
<span style="color:green;"></span><span style="color:green;">        finally {</span>
<span style="color:green;"></span><span style="color:green;">            console.logExit();</span>
<span style="color:green;"></span><span style="color:green;">        }</span>
<span style="color:green;"></span><span style="color:green;">    }</span>
<span style="color:green;"></span><span style="background-color:red;">    </span>
<span style="color:green;"></span><span style="color:green;">    /**</span>
<span style="color:green;"></span><span style="color:green;">     * Create URI from Address</span><span style="background-color:red;"> </span>
<span style="color:green;"></span><span style="color:green;">     * @param addressToForward</span>
<span style="color:green;"></span><span style="color:green;">     * @return</span>
<span style="color:green;"></span><span style="color:green;">     * @throws CommunicationsException</span>
<span style="color:green;"></span><span style="color:green;">     */</span>
<span style="color:green;"></span><span style="color:green;">    URI createUriFromAddress(String addressToForward) throws CommunicationsException</span>
<span style="color:green;"></span><span style="color:green;">    {</span>
<span style="color:green;"></span><span style="background-color:red;">    </span>	<span style="color:green;">URI requestURI;</span>
<span style="color:green;"></span><span style="background-color:red;">    </span>	<span style="color:green;">try {</span>
<span style="color:green;"></span><span style="color:green;">            requestURI = sipManCallback.addressFactory.createURI(addressToForward);</span>
<span style="color:green;"></span><span style="color:green;">        }</span>
<span style="color:green;"></span><span style="color:green;">        catch (ParseException ex) {</span>
<span style="color:green;"></span><span style="color:green;">            console.error(addressToForward + &quot; is not a legal SIP uri!&quot;, ex);</span>
<span style="color:green;"></span><span style="color:green;">            throw new CommunicationsException(addressToForward +</span>
<span style="color:green;"></span><span style="color:green;">                                              &quot; is not a legal SIP uri!&quot;, ex);</span>
<span style="color:green;"></span><span style="color:green;">        }</span>
<span style="color:green;"></span><span style="background-color:red;">    </span>	<span style="color:green;">return requestURI;</span>
<span style="color:green;"></span><span style="color:green;">    }</span>
<span style="color:green;"></span><span style="background-color:red;">    </span>
<span style="color:green;"></span><span style="background-color:red;">	</span>
<span style="color:green;"></span>	<span style="color:green;">synchronized void forward(String registrarAddress, int registrarPort,</span>
<span style="color:green;"></span><span style="color:green;">            String registrarTransport, int expires, String addressToForward) throws</span>
<span style="color:green;"></span>	<span style="color:green;">   CommunicationsException</span>
<span style="color:green;"></span>	<span style="color:green;">{</span>
<span style="color:green;"></span>	<span style="color:green;">  try</span>
<span style="color:green;"></span>	<span style="color:green;">  {</span>
<span style="color:green;"></span>	<span style="color:green;">      console.logEntry();</span>
<span style="color:green;"></span>	<span style="color:green;">      console.debug(&quot;Address to forward: &quot; + addressToForward);</span>
<span style="color:green;"></span><span style="background-color:red;">	      </span>
<span style="color:green;"></span>	<span style="color:green;">      //From</span>
<span style="color:green;"></span>	<span style="color:green;">      FromHeader fromHeader = sipManCallback.getFromHeader();</span>
<span style="color:green;"></span>	<span style="color:green;">      Address fromAddress = fromHeader.getAddress();</span>
<span style="color:green;"></span>	<span style="color:green;">      console.debug(&quot;From Header: &quot; + fromHeader);</span>
<span style="color:green;"></span><span style="background-color:red;">	      </span>
<span style="color:green;"></span>	<span style="color:green;">      /**</span>
<span style="color:green;"></span>	<span style="color:green;">       * TODO: GUI CALL Fix later</span>
<span style="color:green;"></span>	<span style="color:green;">       */</span>
<span style="color:green;"></span>	<span style="color:green;">      //sipManCallback.fireRegistering(fromAddress.toString());</span>
<span style="color:green;"></span>	<span style="color:green;">      CallIdHeader callIdHeader = sipManCallback.sipProvider.getNewCallId();</span>
<span style="color:green;"></span>	<span style="color:green;">      CSeqHeader cSeqHeader = ProcessingUtilities.safeCSeqHeader(1, Request.UPDATE, sipManCallback, console);</span>
<span style="color:green;"></span>	<span style="color:green;">      ToHeader toHeader = ProcessingUtilities.headerFromAddress(fromAddress, sipManCallback, console);</span>
<span style="color:green;"></span>	<span style="color:green;">      ArrayList viaHeaders = sipManCallback.getLocalViaHeaders();</span>
<span style="color:green;"></span>	<span style="color:green;">      MaxForwardsHeader maxForwardsHeader = sipManCallback.</span>
<span style="color:green;"></span>	<span style="color:green;">          getMaxForwardsHeader();</span>
<span style="color:green;"></span>	<span style="color:green;">      Request request = null;</span>
<span style="color:green;"></span><span style="background-color:red;">	      </span>
<span style="color:green;"></span>	<span style="color:green;">      /**</span>
<span style="color:green;"></span>	<span style="color:green;">       * Check if forward or unforward</span>
<span style="color:green;"></span>	<span style="color:green;">       */</span>
<span style="color:green;"></span>	<span style="color:green;">      if (addressToForward != null) {</span>
<span style="color:green;"></span>		<span style="color:green;">      URI requestURI = ProcessingUtilities.createUriFromAddress(addressToForward, sipManCallback, console);</span>
<span style="color:green;"></span><span style="background-color:red;">		      	      </span>
<span style="color:green;"></span>		<span style="color:green;">      /**</span>
<span style="color:green;"></span>		<span style="color:green;">       * Make the request and then add an expires and a contact header</span>
<span style="color:green;"></span>		<span style="color:green;">       */</span>
<span style="color:green;"></span><span style="background-color:red;">		      </span>
<span style="color:green;"></span>		<span style="color:green;">      try {</span>
<span style="color:green;"></span>		<span style="color:green;">          request = sipManCallback.messageFactory.createRequest(requestURI,</span>
<span style="color:green;"></span>		<span style="color:green;">              &quot;FORWARD &quot;,</span>
<span style="color:green;"></span>		<span style="color:green;">              callIdHeader,</span>
<span style="color:green;"></span>		<span style="color:green;">              cSeqHeader, fromHeader, toHeader,</span>
<span style="color:green;"></span>		<span style="color:green;">              viaHeaders,</span>
<span style="color:green;"></span>		<span style="color:green;">              maxForwardsHeader);</span>
<span style="color:green;"></span>		<span style="color:green;">      }</span>
<span style="color:green;"></span>		<span style="color:green;">      catch (ParseException ex) {</span>
<span style="color:green;"></span>		<span style="color:green;">          console.error(&quot;Could not create the register request!&quot;, ex);</span>
<span style="color:green;"></span>		<span style="color:green;">          //throw was missing - reported by Eero Vaarnas</span>
<span style="color:green;"></span>		<span style="color:green;">          throw new CommunicationsException(</span>
<span style="color:green;"></span>		<span style="color:green;">              &quot;Could not create the register request!&quot;,</span>
<span style="color:green;"></span>		<span style="color:green;">              ex);</span>
<span style="color:green;"></span>		<span style="color:green;">      }</span>
<span style="color:green;"></span>	<span style="color:green;">      }</span>
<span style="color:green;"></span>	<span style="color:green;">      else{</span>
<span style="color:green;"></span>	<span style="background-color:red;">    </span>	<span style="color:green;">  URI requestURI = fromAddress.getURI();</span>
<span style="color:green;"></span><span style="background-color:red;">		      </span>
<span style="color:green;"></span>		<span style="color:green;">      /**</span>
<span style="color:green;"></span>		<span style="color:green;">       * Make the request and then add an expires and a contact header</span>
<span style="color:green;"></span>		<span style="color:green;">       */</span>
<span style="color:green;"></span>		<span style="color:green;">      try {</span>
<span style="color:green;"></span>		<span style="color:green;">          request = sipManCallback.messageFactory.createRequest(requestURI,</span>
<span style="color:green;"></span>		<span style="color:green;">              &quot;UNFORWARD &quot;,</span>
<span style="color:green;"></span>		<span style="color:green;">              callIdHeader,</span>
<span style="color:green;"></span>		<span style="color:green;">              cSeqHeader, fromHeader, toHeader,</span>
<span style="color:green;"></span>		<span style="color:green;">              viaHeaders,</span>
<span style="color:green;"></span>		<span style="color:green;">              maxForwardsHeader);</span>
<span style="color:green;"></span>		<span style="color:green;">      }</span>
<span style="color:green;"></span>		<span style="color:green;">      catch (ParseException ex) {</span>
<span style="color:green;"></span>		<span style="color:green;">          console.error(&quot;Could not create the register request!&quot;, ex);</span>
<span style="color:green;"></span>		<span style="color:green;">          //throw was missing - reported by Eero Vaarnas</span>
<span style="color:green;"></span>		<span style="color:green;">          throw new CommunicationsException(</span>
<span style="color:green;"></span>		<span style="color:green;">              &quot;Could not create the register request!&quot;,</span>
<span style="color:green;"></span>		<span style="color:green;">              ex);</span>
<span style="color:green;"></span>		<span style="color:green;">      }</span>
<span style="color:green;"></span>	<span style="color:green;">      }</span>
<span style="color:green;"></span><span style="background-color:red;">	      </span>
<span style="color:green;"></span>	<span style="color:green;">      //Expires Header</span>
<span style="color:green;"></span>	<span style="color:green;">      ExpiresHeader expHeader = null;</span>
<span style="color:green;"></span>	<span style="color:green;">      for (int retry = 0; retry &lt; 2; retry++) {</span>
<span style="color:green;"></span>	<span style="color:green;">          try {</span>
<span style="color:green;"></span>	<span style="color:green;">              expHeader = sipManCallback.headerFactory.createExpiresHeader(</span>
<span style="color:green;"></span>	<span style="color:green;">                  expires);</span>
<span style="color:green;"></span>	<span style="color:green;">          }</span>
<span style="color:green;"></span>	<span style="color:green;">          catch (InvalidArgumentException ex) {</span>
<span style="color:green;"></span>	<span style="color:green;">              if (retry == 0) {</span>
<span style="color:green;"></span>	<span style="color:green;">                  expires = 3600;</span>
<span style="color:green;"></span>	<span style="color:green;">                  continue;</span>
<span style="color:green;"></span>	<span style="color:green;">              }</span>
<span style="color:green;"></span>	<span style="color:green;">              console.error(</span>
<span style="color:green;"></span>	<span style="color:green;">                  &quot;Invalid registrations expiration parameter - &quot;</span>
<span style="color:green;"></span>	<span style="color:green;">                  + expires,</span>
<span style="color:green;"></span>	<span style="color:green;">                  ex);</span>
<span style="color:green;"></span>	<span style="color:green;">              throw new CommunicationsException(</span>
<span style="color:green;"></span>	<span style="color:green;">                  &quot;Invalid registrations expiration parameter - &quot;</span>
<span style="color:green;"></span>	<span style="color:green;">                  + expires,</span>
<span style="color:green;"></span>	<span style="color:green;">                  ex);</span>
<span style="color:green;"></span>	<span style="color:green;">          }</span>
<span style="color:green;"></span>	<span style="color:green;">      }</span>
<span style="color:green;"></span>	<span style="color:green;">      request.addHeader(expHeader);</span>
<span style="color:green;"></span>	<span style="color:green;">      //Contact Header should contain IP - bug report - Eero Vaarnas</span>
<span style="color:green;"></span>	<span style="color:green;">      ContactHeader contactHeader = sipManCallback.</span>
<span style="color:green;"></span>	<span style="color:green;">          getRegistrationContactHeader();</span>
<span style="color:green;"></span>	<span style="color:green;">      request.addHeader(contactHeader);</span>
<span style="color:green;"></span><span style="background-color:red;">	      </span>
<span style="color:green;"></span>	<span style="color:green;">      console.debug(request);</span>
<span style="color:green;"></span><span style="background-color:red;">	      </span>
<span style="color:green;"></span><span style="background-color:red;">	      </span>
<span style="color:green;"></span><span style="background-color:red;">	      </span>
<span style="color:green;"></span>	<span style="color:green;">      //Transaction</span>
<span style="color:green;"></span>	<span style="color:green;">      ClientTransaction forwardTrans = null;</span>
<span style="color:green;"></span>	<span style="color:green;">      try {</span>
<span style="color:green;"></span>	<span style="background-color:red;">    </span>	<span style="color:green;">  forwardTrans = sipManCallback.sipProvider.getNewClientTransaction(</span>
<span style="color:green;"></span>	<span style="color:green;">              request);</span>
<span style="color:green;"></span>	<span style="color:green;">      }</span>
<span style="color:green;"></span>	<span style="color:green;">      catch (TransactionUnavailableException ex) {</span>
<span style="color:green;"></span>	<span style="color:green;">          console.error(&quot;Could not create a forward transaction!\n&quot;</span>
<span style="color:green;"></span>	<span style="color:green;">                        + &quot;Check that the Registrar address is correct!&quot;,</span>
<span style="color:green;"></span>	<span style="color:green;">                        ex);</span>
<span style="color:green;"></span>	<span style="color:green;">          //throw was missing - reported by Eero Vaarnas</span>
<span style="color:green;"></span>	<span style="color:green;">          throw new CommunicationsException(</span>
<span style="color:green;"></span>	<span style="color:green;">              &quot;Could not create a forward transaction!\n&quot;</span>
<span style="color:green;"></span>	<span style="color:green;">              + &quot;Check that the Registrar address is correct!&quot;);</span>
<span style="color:green;"></span>	<span style="color:green;">      }</span>
<span style="color:green;"></span>	<span style="color:green;">      try {</span>
<span style="color:green;"></span>	<span style="background-color:red;">    </span>	<span style="color:green;">  forwardTrans.sendRequest();</span>
<span style="color:green;"></span>	<span style="color:green;">          if( console.isDebugEnabled() )</span>
<span style="color:green;"></span>	<span style="color:green;">              console.debug(&quot;sent request= &quot; + request);</span>
<span style="color:green;"></span>	<span style="color:green;">          //[issue 2] Schedule re registrations</span>
<span style="color:green;"></span>	<span style="color:green;">          //bug reported by LynlvL@netscape.com</span>
<span style="color:green;"></span><span style="background-color:red;">	          </span>
<span style="color:green;"></span>	<span style="color:green;">          //scheduleReRegistration( registrarAddress, registrarPort,</span>
<span style="color:green;"></span>	<span style="color:green;">          //            registrarTransport, expires);</span>
<span style="color:green;"></span><span style="background-color:red;">	</span>
<span style="color:green;"></span>	<span style="color:green;">      }</span>
<span style="color:green;"></span>	<span style="color:green;">      //we sometimes get a null pointer exception here so catch them all</span>
<span style="color:green;"></span>	<span style="color:green;">      catch (Exception ex) {</span>
<span style="color:green;"></span>	<span style="color:green;">          console.error(&quot;Could not send out the forward request!&quot;, ex);</span>
<span style="color:green;"></span>	<span style="color:green;">          //throw was missing - reported by Eero Vaarnas</span>
<span style="color:green;"></span>	<span style="color:green;">          throw new CommunicationsException(</span>
<span style="color:green;"></span>	<span style="color:green;">              &quot;Could not send out the forward request!&quot;, ex);</span>
<span style="color:green;"></span>	<span style="color:green;">      }</span>
<span style="color:green;"></span>	<span style="color:green;">      console.debug(forwardTrans);</span>
<span style="color:green;"></span>	<span style="color:green;">      this.forwardRequest = request;</span>
<span style="color:green;"></span><span style="background-color:red;">	      </span>
<span style="color:green;"></span>	<span style="color:green;">  }</span>
<span style="color:green;"></span>	<span style="color:green;">  finally</span>
<span style="color:green;"></span>	<span style="color:green;">  {</span>
<span style="color:green;"></span>	<span style="color:green;">      console.logExit();</span>
<span style="color:green;"></span>	<span style="color:green;">  }</span>
<span style="color:green;"></span><span style="background-color:red;">	</span>
<span style="color:green;"></span>	<span style="color:green;">}</span>
<span style="color:green;"></span><span style="background-color:red;">	</span>
<span style="color:green;"></span><span style="color:green;">//	synchronized void unforward(String registrarAddress, int registrarPort,</span>
<span style="color:green;"></span><span style="color:green;">//            String registrarTransport, int expires) throws</span>
<span style="color:green;"></span><span style="color:green;">//	   CommunicationsException</span>
<span style="color:green;"></span><span style="color:green;">//	{</span>
<span style="color:green;"></span><span style="color:green;">//	  try</span>
<span style="color:green;"></span><span style="color:green;">//	  {</span>
<span style="color:green;"></span><span style="color:green;">//	      console.logEntry();</span>
<span style="color:green;"></span><span style="color:green;">//</span><span style="background-color:red;">	      </span>
<span style="color:green;"></span><span style="color:green;">//	      //From</span>
<span style="color:green;"></span><span style="color:green;">//	      FromHeader fromHeader = sipManCallback.getFromHeader();</span>
<span style="color:green;"></span><span style="color:green;">//	      Address fromAddress = fromHeader.getAddress();</span>
<span style="color:green;"></span><span style="color:green;">//	      console.debug(&quot;From Header: &quot; + fromHeader);</span>
<span style="color:green;"></span><span style="color:green;">//	      console.debug(&quot;From Address: &quot; + fromAddress.getURI());</span>
<span style="color:green;"></span><span style="color:green;">//</span><span style="background-color:red;">	      </span>
<span style="color:green;"></span><span style="color:green;">//	      /**</span>
<span style="color:green;"></span><span style="color:green;">//	       * TODO: GUI CALL Fix later</span>
<span style="color:green;"></span><span style="color:green;">//	       */</span>
<span style="color:green;"></span><span style="color:green;">//	      //sipManCallback.fireRegistering(fromAddress.toString());</span>
<span style="color:green;"></span><span style="color:green;">//	      URI requestURI = fromAddress.getURI();</span>
<span style="color:green;"></span><span style="color:green;">//	      CallIdHeader callIdHeader = sipManCallback.sipProvider.getNewCallId();</span>
<span style="color:green;"></span><span style="color:green;">//	      CSeqHeader cSeqHeader = ProcessingUtilities.safeCSeqHeader(1, Request.UPDATE, sipManCallback, console);</span>
<span style="color:green;"></span><span style="color:green;">//	      ToHeader toHeader = ProcessingUtilities.headerFromAddress(fromAddress, sipManCallback, console);</span>
<span style="color:green;"></span><span style="color:green;">//	      ArrayList viaHeaders = sipManCallback.getLocalViaHeaders();</span>
<span style="color:green;"></span><span style="color:green;">//	      MaxForwardsHeader maxForwardsHeader = sipManCallback.</span>
<span style="color:green;"></span><span style="color:green;">//	          getMaxForwardsHeader();</span>
<span style="color:green;"></span><span style="color:green;">//</span><span style="background-color:red;">	      </span>
<span style="color:green;"></span><span style="color:green;">//	      /**</span>
<span style="color:green;"></span><span style="color:green;">//	       * Make the request and then add an expires and a contact header</span>
<span style="color:green;"></span><span style="color:green;">//	       */</span>
<span style="color:green;"></span><span style="color:green;">//	      Request request = null;</span>
<span style="color:green;"></span><span style="color:green;">//	      try {</span>
<span style="color:green;"></span><span style="color:green;">//	          request = sipManCallback.messageFactory.createRequest(requestURI,</span>
<span style="color:green;"></span><span style="color:green;">//	              &quot;UNFORWARD &quot;,</span>
<span style="color:green;"></span><span style="color:green;">//	              callIdHeader,</span>
<span style="color:green;"></span><span style="color:green;">//	              cSeqHeader, fromHeader, toHeader,</span>
<span style="color:green;"></span><span style="color:green;">//	              viaHeaders,</span>
<span style="color:green;"></span><span style="color:green;">//	              maxForwardsHeader);</span>
<span style="color:green;"></span><span style="color:green;">//	      }</span>
<span style="color:green;"></span><span style="color:green;">//	      catch (ParseException ex) {</span>
<span style="color:green;"></span><span style="color:green;">//	          console.error(&quot;Could not create the register request!&quot;, ex);</span>
<span style="color:green;"></span><span style="color:green;">//	          //throw was missing - reported by Eero Vaarnas</span>
<span style="color:green;"></span><span style="color:green;">//	          throw new CommunicationsException(</span>
<span style="color:green;"></span><span style="color:green;">//	              &quot;Could not create the register request!&quot;,</span>
<span style="color:green;"></span><span style="color:green;">//	              ex);</span>
<span style="color:green;"></span><span style="color:green;">//	      }</span>
<span style="color:green;"></span><span style="color:green;">//</span><span style="background-color:red;">	      </span>
<span style="color:green;"></span><span style="color:green;">//</span><span style="background-color:red;">	      </span>
<span style="color:green;"></span><span style="color:green;">//	      //Expires Header</span>
<span style="color:green;"></span><span style="color:green;">//	      ExpiresHeader expHeader = null;</span>
<span style="color:green;"></span><span style="color:green;">//	      for (int retry = 0; retry &lt; 2; retry++) {</span>
<span style="color:green;"></span><span style="color:green;">//	          try {</span>
<span style="color:green;"></span><span style="color:green;">//	              expHeader = sipManCallback.headerFactory.createExpiresHeader(</span>
<span style="color:green;"></span><span style="color:green;">//	                  expires);</span>
<span style="color:green;"></span><span style="color:green;">//	          }</span>
<span style="color:green;"></span><span style="color:green;">//	          catch (InvalidArgumentException ex) {</span>
<span style="color:green;"></span><span style="color:green;">//	              if (retry == 0) {</span>
<span style="color:green;"></span><span style="color:green;">//	                  expires = 3600;</span>
<span style="color:green;"></span><span style="color:green;">//	                  continue;</span>
<span style="color:green;"></span><span style="color:green;">//	              }</span>
<span style="color:green;"></span><span style="color:green;">//	              console.error(</span>
<span style="color:green;"></span><span style="color:green;">//	                  &quot;Invalid registrations expiration parameter - &quot;</span>
<span style="color:green;"></span><span style="color:green;">//	                  + expires,</span>
<span style="color:green;"></span><span style="color:green;">//	                  ex);</span>
<span style="color:green;"></span><span style="color:green;">//	              throw new CommunicationsException(</span>
<span style="color:green;"></span><span style="color:green;">//	                  &quot;Invalid registrations expiration parameter - &quot;</span>
<span style="color:green;"></span><span style="color:green;">//	                  + expires,</span>
<span style="color:green;"></span><span style="color:green;">//	                  ex);</span>
<span style="color:green;"></span><span style="color:green;">//	          }</span>
<span style="color:green;"></span><span style="color:green;">//	      }</span>
<span style="color:green;"></span><span style="color:green;">//	      request.addHeader(expHeader);</span>
<span style="color:green;"></span><span style="color:green;">//	      //Contact Header should contain IP - bug report - Eero Vaarnas</span>
<span style="color:green;"></span><span style="color:green;">//	      ContactHeader contactHeader = sipManCallback.</span>
<span style="color:green;"></span><span style="color:green;">//	          getRegistrationContactHeader();</span>
<span style="color:green;"></span><span style="color:green;">//	      request.addHeader(contactHeader);</span>
<span style="color:green;"></span><span style="color:green;">//</span><span style="background-color:red;">	      </span>
<span style="color:green;"></span><span style="color:green;">//	      console.debug(request);</span>
<span style="color:green;"></span><span style="color:green;">//</span><span style="background-color:red;">	      </span>
<span style="color:green;"></span><span style="color:green;">//</span><span style="background-color:red;">	      </span>
<span style="color:green;"></span><span style="color:green;">//</span><span style="background-color:red;">	      </span>
<span style="color:green;"></span><span style="color:green;">//	      //Transaction</span>
<span style="color:green;"></span><span style="color:green;">//	      ClientTransaction forwardTrans = null;</span>
<span style="color:green;"></span><span style="color:green;">//	      try {</span>
<span style="color:green;"></span><span style="color:green;">//	    	  forwardTrans = sipManCallback.sipProvider.getNewClientTransaction(</span>
<span style="color:green;"></span><span style="color:green;">//	              request);</span>
<span style="color:green;"></span><span style="color:green;">//	      }</span>
<span style="color:green;"></span><span style="color:green;">//	      catch (TransactionUnavailableException ex) {</span>
<span style="color:green;"></span><span style="color:green;">//	          console.error(&quot;Could not create a forward transaction!\n&quot;</span>
<span style="color:green;"></span><span style="color:green;">//	                        + &quot;Check that the Registrar address is correct!&quot;,</span>
<span style="color:green;"></span><span style="color:green;">//	                        ex);</span>
<span style="color:green;"></span><span style="color:green;">//	          //throw was missing - reported by Eero Vaarnas</span>
<span style="color:green;"></span><span style="color:green;">//	          throw new CommunicationsException(</span>
<span style="color:green;"></span><span style="color:green;">//	              &quot;Could not create a forward transaction!\n&quot;</span>
<span style="color:green;"></span><span style="color:green;">//	              + &quot;Check that the Registrar address is correct!&quot;);</span>
<span style="color:green;"></span><span style="color:green;">//	      }</span>
<span style="color:green;"></span><span style="color:green;">//	      try {</span>
<span style="color:green;"></span><span style="color:green;">//	    	  forwardTrans.sendRequest();</span>
<span style="color:green;"></span><span style="color:green;">//	          if( console.isDebugEnabled() )</span>
<span style="color:green;"></span><span style="color:green;">//	              console.debug(&quot;sent request= &quot; + request);</span>
<span style="color:green;"></span><span style="color:green;">//	          //[issue 2] Schedule re registrations</span>
<span style="color:green;"></span><span style="color:green;">//	          //bug reported by LynlvL@netscape.com</span>
<span style="color:green;"></span><span style="color:green;">//</span><span style="background-color:red;">	          </span>
<span style="color:green;"></span><span style="color:green;">//	          //scheduleReRegistration( registrarAddress, registrarPort,</span>
<span style="color:green;"></span><span style="color:green;">//	          //            registrarTransport, expires);</span>
<span style="color:green;"></span><span style="color:green;">//</span><span style="background-color:red;">	</span>
<span style="color:green;"></span><span style="color:green;">//	      }</span>
<span style="color:green;"></span><span style="color:green;">//	      //we sometimes get a null pointer exception here so catch them all</span>
<span style="color:green;"></span><span style="color:green;">//	      catch (Exception ex) {</span>
<span style="color:green;"></span><span style="color:green;">//	          console.error(&quot;Could not send out the forward request!&quot;, ex);</span>
<span style="color:green;"></span><span style="color:green;">//	          //throw was missing - reported by Eero Vaarnas</span>
<span style="color:green;"></span><span style="color:green;">//	          throw new CommunicationsException(</span>
<span style="color:green;"></span><span style="color:green;">//	              &quot;Could not send out the forward request!&quot;, ex);</span>
<span style="color:green;"></span><span style="color:green;">//	      }</span>
<span style="color:green;"></span><span style="color:green;">//	      console.debug(forwardTrans);</span>
<span style="color:green;"></span><span style="color:green;">//	      this.forwardRequest = request;</span>
<span style="color:green;"></span><span style="color:green;">//</span><span style="background-color:red;">	      </span>
<span style="color:green;"></span><span style="color:green;">//	  }</span>
<span style="color:green;"></span><span style="color:green;">//	  finally</span>
<span style="color:green;"></span><span style="color:green;">//	  {</span>
<span style="color:green;"></span><span style="color:green;">//	      console.logExit();</span>
<span style="color:green;"></span><span style="color:green;">//	  }</span>
<span style="color:green;"></span><span style="color:green;">//</span><span style="background-color:red;">	</span>
<span style="color:green;"></span><span style="color:green;">//	}</span>
<span style="color:green;"></span><span style="color:green;">}</span>
<span style="font-weight:bold;">────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
modified: sip-communicator/src/net/java/sip/communicator/sip/CallProcessing.java
────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
</span><span style="color:teal;font-weight:bold;">@ CallProcessing.java:500 @</span><span style="font-weight:bold;text-decoration:blink;"> public class CallProcessing</span>
                sipManCallback.fireUnknownMessageReceived(byeRequest);
                return;
            }
<span style="color:green;"></span><span style="background-color:red;">            </span>
<span style="color:green;"></span><span style="color:green;">            /**</span>
<span style="color:green;"></span><span style="color:green;">             * When we say bye we also have to send the call time</span>
<span style="color:green;"></span><span style="color:green;">             */</span>
<span style="color:green;"></span><span style="color:green;">            String callState = call.getState();</span>
<span style="color:green;"></span><span style="color:green;">            Dialog callDialog = call.getDialog();</span>
<span style="color:green;"></span><span style="color:green;">            if(callState.equals(Call.CONNECTED)){</span>
<span style="color:green;"></span><span style="background-color:red;">            </span>	<span style="color:green;">makeAndSendOptionsRequest(call);</span>
<span style="color:green;"></span><span style="color:green;">            }</span>
            //change status
            call.setState(Call.DISCONNECTED);
            //Send OK
<span style="color:teal;">@ CallProcessing.java:940 @</span><span style="color:teal;font-weight:bold;"></span><span style="font-weight:bold;text-decoration:blink;"> public class CallProcessing</span>
                || call.getState().equals(Call.RECONNECTED)) {
                call.setState(Call.DISCONNECTED);
                sayBye(dialog);
<span style="color:green;"></span><span style="color:green;">                /**</span>
<span style="color:green;"></span><span style="color:green;">                 * When we say bye we also have to send the call time</span>
<span style="color:green;"></span><span style="color:green;">                 */</span>
<span style="color:green;"></span><span style="color:green;">                String callState = call.getState();</span>
<span style="color:green;"></span><span style="color:green;">                Dialog callDialog = call.getDialog();</span>
<span style="color:green;"></span><span style="background-color:red;">                </span>
<span style="color:green;"></span><span style="background-color:red;">            	</span>
<span style="color:green;"></span><span style="background-color:red;">            </span>	<span style="color:green;">/**</span>
<span style="color:green;"></span><span style="background-color:red;">            </span>	<span style="color:green;"> * Here we can have caller for the FromHeader of the initialRequest</span>
<span style="color:green;"></span><span style="background-color:red;">            </span>	<span style="color:green;"> * TODO: Form the request so that the server can handle it and charge us</span>
<span style="color:green;"></span><span style="background-color:red;">            </span>	<span style="color:green;"> */</span>
<span style="color:green;"></span><span style="background-color:red;">            </span>	<span style="color:green;">makeAndSendOptionsRequest(call);</span>
<span style="color:green;"></span><span style="background-color:red;">            	</span>
<span style="color:gray;background-color:black;"></span><span style="color:green;background-color:black;"> </span>
<span style="color:green;"></span><span style="background-color:red;">            	</span>
<span style="color:green;"></span><span style="background-color:red;">            </span>
            }
            else if (call.getState().equals(Call.DIALING)
                     || call.getState().equals(Call.RINGING)) {
<span style="color:teal;">@ CallProcessing.java:1006 @</span><span style="color:teal;font-weight:bold;"></span><span style="font-weight:bold;text-decoration:blink;"> public class CallProcessing</span>

    } //end call

<span style="color:red;">    //Bye</span>
<span style="color:green;"></span><span style="color:green;">    private void makeAndSendOptionsRequest(Call call) {</span>
<span style="color:green;"></span><span style="background-color:red;">    </span>	<span style="color:green;">String callState = call.getState();</span>
<span style="color:green;"></span><span style="color:green;">        Dialog callDialog = call.getDialog();</span>
<span style="color:green;"></span><span style="background-color:red;">    </span>	<span style="color:green;">long currentTime = System.currentTimeMillis();</span>
<span style="color:green;"></span><span style="background-color:red;">    </span>	<span style="color:green;">long callDuration = currentTime - call.getTimeOfConnection();</span>
<span style="color:green;"></span><span style="background-color:red;">    </span>	<span style="color:green;">console.debug(&quot;Duration:&quot; + callDuration);</span>
<span style="color:green;"></span><span style="background-color:red;">    </span>	<span style="color:green;">console.debug(call.getInitialRequest().toString());</span>
<span style="color:green;"></span><span style="background-color:red;">    </span>	<span style="color:green;">//Are we the caller</span>
<span style="color:green;"></span><span style="color:green;">        URI callerURI = ( (FromHeader) call.getInitialRequest().getHeader(FromHeader.NAME)).</span>
<span style="color:green;"></span><span style="background-color:red;">        </span>		<span style="color:green;">getAddress().getURI();</span>
<span style="color:green;"></span><span style="color:green;">        if (callerURI.isSipURI()) {</span>
<span style="color:green;"></span><span style="color:green;">            String callerUser = ( (SipURI) callerURI).getUser();</span>
<span style="color:green;"></span><span style="color:green;">            String localUser = sipManCallback.getLocalUser();</span>
<span style="color:green;"></span><span style="color:green;">            console.debug(&quot;PAPOTSI USER: \n&quot;);</span>
<span style="color:green;"></span><span style="color:green;">            console.debug(callerUser);</span>
<span style="color:green;"></span><span style="color:green;">            console.debug(sipManCallback.currentlyUsedURI);</span>
<span style="color:green;"></span><span style="color:green;">            //console.debug(sipManCallback.);</span>
<span style="color:green;"></span><span style="background-color:red;">            </span>
<span style="color:green;"></span><span style="color:green;">            //user info is case sensitive according to rfc3261</span>
<span style="color:green;"></span><span style="color:green;">            if (callerUser.equals(localUser))</span>
<span style="color:green;"></span><span style="color:green;">            {</span>
<span style="color:green;"></span><span style="background-color:red;">                </span>
<span style="color:green;"></span><span style="background-color:red;">            </span>	<span style="color:green;">try{</span>
<span style="color:green;"></span><span style="background-color:red;">            </span>		<span style="color:green;">FromHeader fromHeader = sipManCallback.getFromHeader();</span>
<span style="color:green;"></span>					<span style="color:green;">  Address fromAddress = fromHeader.getAddress();</span>
<span style="color:green;"></span><span style="background-color:red;">					  </span>
<span style="color:green;"></span>					<span style="color:green;">  console.debug(&quot;From Header: &quot; + fromHeader);</span>
<span style="color:green;"></span><span style="background-color:red;">					  </span>
<span style="color:green;"></span><span style="background-color:red;">					  </span>
<span style="color:green;"></span>					<span style="color:green;">  CallIdHeader callIdHeader = sipManCallback.sipProvider.getNewCallId();</span>
<span style="color:green;"></span>					<span style="color:green;">  CSeqHeader cSeqHeader = ProcessingUtilities.safeCSeqHeader(1, Request.OPTIONS, sipManCallback, console);</span>
<span style="color:green;"></span>					<span style="color:green;">  ToHeader toHeader = ProcessingUtilities.headerFromAddress(fromAddress, sipManCallback, console);</span>
<span style="color:green;"></span>					<span style="color:green;">  ArrayList viaHeaders = sipManCallback.getLocalViaHeaders();</span>
<span style="color:green;"></span>					<span style="color:green;">  MaxForwardsHeader maxForwardsHeader = sipManCallback.</span>
<span style="color:green;"></span>					<span style="color:green;">      getMaxForwardsHeader();</span>
<span style="color:green;"></span>					<span style="color:green;">  Request request = null;</span>
<span style="color:green;"></span><span style="background-color:red;">	          	      </span>
<span style="color:green;"></span><span style="background-color:red;">          </span>	<span style="color:green;">      /**</span>
<span style="color:green;"></span><span style="background-color:red;">          </span>	<span style="color:green;">       * Check if forward or unforward</span>
<span style="color:green;"></span><span style="background-color:red;">          </span>	<span style="color:green;">       */</span>
<span style="color:green;"></span><span style="background-color:red;">          </span>		<span style="color:green;">      URI requestURI = ProcessingUtilities.createUriFromAddress(sipManCallback.currentlyUsedURI, sipManCallback, console);</span>
<span style="color:green;"></span><span style="background-color:red;">          		      	      </span>
<span style="color:green;"></span><span style="background-color:red;">          </span>		<span style="color:green;">      /**</span>
<span style="color:green;"></span><span style="background-color:red;">          </span>		<span style="color:green;">       * Make the request and then add an expires and a contact header</span>
<span style="color:green;"></span><span style="background-color:red;">          </span>		<span style="color:green;">       */</span>
<span style="color:green;"></span><span style="background-color:red;">          		      </span>
<span style="color:green;"></span><span style="background-color:red;">          </span>		<span style="color:green;">      try {</span>
<span style="color:green;"></span><span style="background-color:red;">          </span>		<span style="color:green;">          request = sipManCallback.messageFactory.createRequest(requestURI,</span>
<span style="color:green;"></span><span style="background-color:red;">          </span>		<span style="color:green;">              &quot;OPTIONS &quot;,</span>
<span style="color:green;"></span><span style="background-color:red;">          </span>		<span style="color:green;">              callIdHeader,</span>
<span style="color:green;"></span><span style="background-color:red;">          </span>		<span style="color:green;">              cSeqHeader, fromHeader, toHeader,</span>
<span style="color:green;"></span><span style="background-color:red;">          </span>		<span style="color:green;">              viaHeaders,</span>
<span style="color:green;"></span><span style="background-color:red;">          </span>		<span style="color:green;">              maxForwardsHeader);</span>
<span style="color:green;"></span><span style="background-color:red;">          </span>		<span style="color:green;">      }</span>
<span style="color:green;"></span><span style="background-color:red;">          </span>		<span style="color:green;">      catch (ParseException ex) {</span>
<span style="color:green;"></span><span style="background-color:red;">          </span>		<span style="color:green;">          console.error(&quot;Could not create the register request!&quot;, ex);</span>
<span style="color:green;"></span><span style="background-color:red;">          </span>		<span style="color:green;">          //throw was missing - reported by Eero Vaarnas</span>
<span style="color:green;"></span><span style="background-color:red;">          		          </span>
<span style="color:green;"></span><span style="background-color:red;">          </span>		<span style="color:green;">      }</span>
<span style="color:green;"></span><span style="background-color:red;">          </span>		<span style="color:green;">      Integer expires = 3600;</span>
<span style="color:green;"></span><span style="background-color:red;">          </span>		<span style="color:green;">  //Expires Header</span>
<span style="color:green;"></span><span style="background-color:red;">          </span>		<span style="color:green;">      ExpiresHeader expHeader = null;</span>
<span style="color:green;"></span><span style="background-color:red;">          </span>		<span style="color:green;">      for (int retry = 0; retry &lt; 2; retry++) {</span>
<span style="color:green;"></span><span style="background-color:red;">          </span>		<span style="color:green;">          try {</span>
<span style="color:green;"></span><span style="background-color:red;">          </span>		<span style="color:green;">              expHeader = sipManCallback.headerFactory.createExpiresHeader(</span>
<span style="color:green;"></span><span style="background-color:red;">          </span>		<span style="color:green;">                  expires);</span>
<span style="color:green;"></span><span style="background-color:red;">          </span>		<span style="color:green;">          }</span>
<span style="color:green;"></span><span style="background-color:red;">          </span>		<span style="color:green;">          catch (InvalidArgumentException ex) {</span>
<span style="color:green;"></span><span style="background-color:red;">          </span>		<span style="color:green;">              if (retry == 0) {</span>
<span style="color:green;"></span><span style="background-color:red;">          </span>		<span style="color:green;">                  expires = 3600;</span>
<span style="color:green;"></span><span style="background-color:red;">          </span>		<span style="color:green;">                  continue;</span>
<span style="color:green;"></span><span style="background-color:red;">          </span>		<span style="color:green;">              }</span>
<span style="color:green;"></span><span style="background-color:red;">          </span>		<span style="color:green;">              console.error(</span>
<span style="color:green;"></span><span style="background-color:red;">          </span>		<span style="color:green;">                  &quot;Invalid registrations expiration parameter - &quot;</span>
<span style="color:green;"></span><span style="background-color:red;">          </span>		<span style="color:green;">                  + expires,</span>
<span style="color:green;"></span><span style="background-color:red;">          </span>		<span style="color:green;">                  ex);</span>
<span style="color:green;"></span><span style="background-color:red;">          </span>		<span style="color:green;">              throw new CommunicationsException(</span>
<span style="color:green;"></span><span style="background-color:red;">          </span>		<span style="color:green;">                  &quot;Invalid registrations expiration parameter - &quot;</span>
<span style="color:green;"></span><span style="background-color:red;">          </span>		<span style="color:green;">                  + expires,</span>
<span style="color:green;"></span><span style="background-color:red;">          </span>		<span style="color:green;">                  ex);</span>
<span style="color:green;"></span><span style="background-color:red;">          </span>		<span style="color:green;">          }</span>
<span style="color:green;"></span><span style="background-color:red;">          </span>		<span style="color:green;">      }</span>
<span style="color:green;"></span><span style="background-color:red;">          </span>		<span style="color:green;">      request.addHeader(expHeader);</span>
<span style="color:green;"></span><span style="background-color:red;">          </span>		<span style="color:green;">      //Contact Header should contain IP - bug report - Eero Vaarnas</span>
<span style="color:green;"></span><span style="background-color:red;">          </span>		<span style="color:green;">      ContactHeader contactHeader = sipManCallback.</span>
<span style="color:green;"></span><span style="background-color:red;">          </span>		<span style="color:green;">          getRegistrationContactHeader();</span>
<span style="color:green;"></span><span style="background-color:red;">          </span>		<span style="color:green;">      request.addHeader(contactHeader);</span>
<span style="color:green;"></span><span style="background-color:red;">          		      </span>
<span style="color:green;"></span><span style="background-color:red;">          </span>		<span style="color:green;">      console.debug(request);</span>
<span style="color:green;"></span><span style="background-color:red;">          		      </span>
<span style="color:green;"></span><span style="background-color:red;">          		      </span>
<span style="color:green;"></span><span style="background-color:red;">          		      </span>
<span style="color:green;"></span><span style="background-color:red;">          		      </span>
<span style="color:green;"></span><span style="background-color:red;">            </span>
<span style="color:green;"></span><span style="background-color:red;">            </span>		<span style="color:green;">Request timeOfHangupRequest = request;</span>
<span style="color:green;"></span><span style="background-color:red;">            </span>		<span style="color:green;">console.debug(&quot;Time of hangup request: &quot; + timeOfHangupRequest);</span>
<span style="color:green;"></span><span style="background-color:red;">            </span>		<span style="color:green;">try {</span>
<span style="color:green;"></span><span style="background-color:red;">            </span>			<span style="color:green;">ContentTypeHeader contentTypeHeader =</span>
<span style="color:green;"></span><span style="color:green;">                            sipManCallback.headerFactory.createContentTypeHeader(</span>
<span style="color:green;"></span><span style="color:green;">                            &quot;application&quot;, &quot;duration&quot;);</span>
<span style="color:green;"></span><span style="background-color:red;">            </span>			<span style="color:green;">String content = &quot;Duration:&quot; + String.valueOf(callDuration) + &quot;\n&quot;;</span>
<span style="color:green;"></span><span style="background-color:red;">            </span>			<span style="color:green;">console.debug(&quot;COntent: &quot; + content);</span>
<span style="color:green;"></span>						<span style="color:green;">timeOfHangupRequest.setContent(content, contentTypeHeader);</span>
<span style="color:green;"></span>					<span style="color:green;">} catch (ParseException e) {</span>
<span style="color:green;"></span>						<span style="color:green;">// TODO Auto-generated catch block</span>
<span style="color:green;"></span>						<span style="color:green;">e.printStackTrace();</span>
<span style="color:green;"></span>					<span style="color:green;">}</span>
<span style="color:green;"></span><span style="background-color:red;">            		</span>
<span style="color:green;"></span><span style="background-color:red;">            </span>		<span style="color:green;">console.debug(&quot;Time of hangup request: &quot; + timeOfHangupRequest);</span>
<span style="color:green;"></span><span style="background-color:red;">            </span>		<span style="color:green;">//Transaction</span>
<span style="color:green;"></span><span style="background-color:red;">        </span>		<span style="color:green;">      ClientTransaction trans = null;</span>
<span style="color:green;"></span><span style="background-color:red;">        </span>		<span style="color:green;">      try {</span>
<span style="color:green;"></span><span style="background-color:red;">        </span>		<span style="background-color:red;">    </span>	<span style="color:green;">trans = sipManCallback.sipProvider.getNewClientTransaction(</span>
<span style="color:green;"></span><span style="background-color:red;">        </span>		<span style="background-color:red;">    </span>			<span style="color:green;">timeOfHangupRequest);</span>
<span style="color:green;"></span><span style="background-color:red;">        </span>		<span style="color:green;">      }</span>
<span style="color:green;"></span><span style="background-color:red;">        </span>		<span style="color:green;">      catch (TransactionUnavailableException ex) {</span>
<span style="color:green;"></span><span style="background-color:red;">        </span>		<span style="color:green;">          console.error(&quot;Could not create a charge transaction!\n&quot;</span>
<span style="color:green;"></span><span style="background-color:red;">        </span>		<span style="color:green;">                        + &quot;Check that the Registrar address is correct!&quot;,</span>
<span style="color:green;"></span><span style="background-color:red;">        </span>		<span style="color:green;">                        ex);</span>
<span style="color:green;"></span><span style="background-color:red;">        </span>		<span style="color:green;">          //throw was missing - reported by Eero Vaarnas</span>
<span style="color:green;"></span><span style="background-color:red;">        </span>		<span style="color:green;">          throw new CommunicationsException(</span>
<span style="color:green;"></span><span style="background-color:red;">        </span>		<span style="color:green;">              &quot;Could not create a charge transaction!\n&quot;</span>
<span style="color:green;"></span><span style="background-color:red;">        </span>		<span style="color:green;">              + &quot;Check that the Registrar address is correct!&quot;);</span>
<span style="color:green;"></span><span style="background-color:red;">        </span>		<span style="color:green;">      }</span>
<span style="color:green;"></span><span style="background-color:red;">        </span>		<span style="color:green;">      try {</span>
<span style="color:green;"></span><span style="background-color:red;">        </span>		<span style="background-color:red;">    </span>	<span style="color:green;">  trans.sendRequest();</span>
<span style="color:green;"></span><span style="background-color:red;">        </span>		<span style="color:green;">          if( console.isDebugEnabled() )</span>
<span style="color:green;"></span><span style="background-color:red;">        </span>		<span style="color:green;">              console.debug(&quot;sent request= &quot; + timeOfHangupRequest);</span>
<span style="color:green;"></span><span style="background-color:red;">        </span>		<span style="color:green;">          //[issue 2] Schedule re registrations</span>
<span style="color:green;"></span><span style="background-color:red;">        </span>		<span style="color:green;">          //bug reported by LynlvL@netscape.com</span>
<span style="color:green;"></span><span style="background-color:red;">        		          </span>
<span style="color:green;"></span><span style="background-color:red;">        </span>		<span style="color:green;">          //scheduleReRegistration( registrarAddress, registrarPort,</span>
<span style="color:green;"></span><span style="background-color:red;">        </span>		<span style="color:green;">          //            registrarTransport, expires);</span>
<span style="color:green;"></span><span style="background-color:red;">        		</span>
<span style="color:green;"></span><span style="background-color:red;">        </span>		<span style="color:green;">      }</span>
<span style="color:green;"></span><span style="background-color:red;">        </span>		<span style="color:green;">      //we sometimes get a null pointer exception here so catch them all</span>
<span style="color:green;"></span><span style="background-color:red;">        </span>		<span style="color:green;">      catch (Exception ex) {</span>
<span style="color:green;"></span><span style="background-color:red;">        </span>		<span style="color:green;">          console.error(&quot;Could not send out the forward request!&quot;, ex);</span>
<span style="color:green;"></span><span style="background-color:red;">        </span>		<span style="color:green;">          //throw was missing - reported by Eero Vaarnas</span>
<span style="color:green;"></span><span style="background-color:red;">        </span>		<span style="color:green;">          throw new CommunicationsException(</span>
<span style="color:green;"></span><span style="background-color:red;">        </span>		<span style="color:green;">              &quot;Could not send out the forward request!&quot;, ex);</span>
<span style="color:green;"></span><span style="background-color:red;">        </span>		<span style="color:green;">      }</span>
<span style="color:green;"></span><span style="background-color:red;">        </span>		<span style="color:green;">      console.debug(trans);</span>
<span style="color:green;"></span><span style="background-color:red;">            </span>	<span style="color:green;">}</span>
<span style="color:green;"></span><span style="background-color:red;">            </span>	<span style="color:green;">catch (CommunicationsException e1) {</span>
<span style="color:green;"></span>					<span style="color:green;">// TODO Auto-generated catch block</span>
<span style="color:green;"></span>					<span style="color:green;">e1.printStackTrace();</span>
<span style="color:green;"></span>				<span style="color:green;">}</span>
<span style="color:green;"></span><span style="color:green;">            }</span>
<span style="color:green;"></span><span style="color:green;">        }</span>
<span style="color:green;"></span><span style="background-color:red;">		</span>
<span style="color:green;"></span>	<span style="color:green;">}</span>
<span style="color:gray;background-color:black;"></span><span style="color:green;background-color:black;"> </span>
<span style="color:green;"></span>	<span style="color:green;">//Bye</span>
    private void sayBye(Dialog dialog) throws CommunicationsException
    {
        try
<span style="color:teal;">@ CallProcessing.java:1200 @</span><span style="color:teal;font-weight:bold;"></span><span style="font-weight:bold;text-decoration:blink;"> public class CallProcessing</span>
            catch (SipException ex1) {
                throw new CommunicationsException(&quot;Failed to send the BYE request&quot;);
            }
<span style="color:green;"></span><span style="background-color:red;">            </span>
<span style="color:green;"></span><span style="background-color:red;">            </span>
        }
        finally
        {
<span style="font-weight:bold;">────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
added: sip-communicator/src/net/java/sip/communicator/sip/ProcessingUtilities.java
────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
</span><span style="color:teal;font-weight:bold;">@ ProcessingUtilities.java:4 @</span><span style="font-weight:bold;text-decoration:blink;"></span>
<span style="color:green;"></span><span style="color:green;">package net.java.sip.communicator.sip;</span>
<span style="color:gray;background-color:black;"></span><span style="color:green;background-color:black;"> </span>
<span style="color:green;"></span><span style="color:green;">import java.text.ParseException;</span>
<span style="color:gray;background-color:black;"></span><span style="color:green;background-color:black;"> </span>
<span style="color:green;"></span><span style="color:green;">import javax.sip.InvalidArgumentException;</span>
<span style="color:green;"></span><span style="color:green;">import javax.sip.address.Address;</span>
<span style="color:green;"></span><span style="color:green;">import javax.sip.address.URI;</span>
<span style="color:green;"></span><span style="color:green;">import javax.sip.header.CSeqHeader;</span>
<span style="color:green;"></span><span style="color:green;">import javax.sip.header.ToHeader;</span>
<span style="color:green;"></span><span style="color:green;">import javax.sip.message.Request;</span>
<span style="color:gray;background-color:black;"></span><span style="color:green;background-color:black;"> </span>
<span style="color:green;"></span><span style="color:green;">import net.java.sip.communicator.common.Console;</span>
<span style="color:gray;background-color:black;"></span><span style="color:green;background-color:black;"> </span>
<span style="color:green;"></span><span style="color:green;">public class ProcessingUtilities {</span>
<span style="color:green;"></span><span style="background-color:red;">	</span>
<span style="color:green;"></span>	<span style="color:green;">/**</span>
<span style="color:green;"></span><span style="color:green;">     * Create URI from Address</span><span style="background-color:red;"> </span>
<span style="color:green;"></span><span style="color:green;">     * @param addressToForward</span>
<span style="color:green;"></span><span style="color:green;">     * @return</span>
<span style="color:green;"></span><span style="color:green;">     * @throws CommunicationsException</span>
<span style="color:green;"></span><span style="color:green;">     */</span>
<span style="color:green;"></span><span style="color:green;">    static public URI createUriFromAddress(String addressToForward, SipManager sipManCallback, Console console) throws CommunicationsException</span>
<span style="color:green;"></span><span style="color:green;">    {</span>
<span style="color:green;"></span><span style="background-color:red;">    </span>	<span style="color:green;">URI requestURI;</span>
<span style="color:green;"></span><span style="background-color:red;">    </span>	<span style="color:green;">try {</span>
<span style="color:green;"></span><span style="color:green;">            requestURI = sipManCallback.addressFactory.createURI(addressToForward);</span>
<span style="color:green;"></span><span style="color:green;">        }</span>
<span style="color:green;"></span><span style="color:green;">        catch (ParseException ex) {</span>
<span style="color:green;"></span><span style="color:green;">            console.error(addressToForward + &quot; is not a legal SIP uri!&quot;, ex);</span>
<span style="color:green;"></span><span style="color:green;">            throw new CommunicationsException(addressToForward +</span>
<span style="color:green;"></span><span style="color:green;">                                              &quot; is not a legal SIP uri!&quot;, ex);</span>
<span style="color:green;"></span><span style="color:green;">        }</span>
<span style="color:green;"></span><span style="background-color:red;">    </span>	<span style="color:green;">return requestURI;</span>
<span style="color:green;"></span><span style="color:green;">    }</span>
<span style="color:green;"></span><span style="background-color:red;">    </span>
<span style="color:green;"></span><span style="color:green;">    /**</span>
<span style="color:green;"></span><span style="color:green;">     * Create the CSeqHeader in a safe way</span>
<span style="color:green;"></span><span style="color:green;">     * @param i</span>
<span style="color:green;"></span><span style="color:green;">     * @param method</span>
<span style="color:green;"></span><span style="color:green;">     * @param sipManCallback</span>
<span style="color:green;"></span><span style="color:green;">     * @param console</span>
<span style="color:green;"></span><span style="color:green;">     * @return</span>
<span style="color:green;"></span><span style="color:green;">     * @throws CommunicationsException</span><span style="background-color:red;"> </span>
<span style="color:green;"></span><span style="color:green;">     */</span>
<span style="color:green;"></span><span style="color:green;">    static public CSeqHeader safeCSeqHeader(int i, String method, SipManager sipManCallback, Console console) throws CommunicationsException</span>
<span style="color:green;"></span><span style="color:green;">    {</span>
<span style="color:green;"></span><span style="background-color:red;">    </span>	<span style="color:green;">CSeqHeader cSeqHeader;</span>
<span style="color:green;"></span><span style="background-color:red;">    </span>	<span style="color:green;">try {</span>
<span style="color:green;"></span><span style="background-color:red;">    </span>		<span style="color:green;">// We used the requested method of the SIP</span>
<span style="color:green;"></span>		<span style="color:green;">    cSeqHeader = sipManCallback.headerFactory.createCSeqHeader(i, method);</span>
<span style="color:green;"></span>		<span style="color:green;">}</span>
<span style="color:green;"></span>		<span style="color:green;">catch (ParseException ex) {</span>
<span style="color:green;"></span>		<span style="color:green;">    //Should never happen</span>
<span style="color:green;"></span>		<span style="color:green;">    console.error(&quot;Corrupt Sip Stack&quot;);</span>
<span style="color:green;"></span>		<span style="color:green;">    Console.showError(&quot;Corrupt Sip Stack&quot;);</span>
<span style="color:green;"></span>		<span style="color:green;">    throw new CommunicationsException(&quot;Corrupt Sip Stack&quot;, ex);</span>
<span style="color:green;"></span>		<span style="color:green;">}</span>
<span style="color:green;"></span>		<span style="color:green;">catch (InvalidArgumentException ex) {</span>
<span style="color:green;"></span>		<span style="color:green;">    //Should never happen</span>
<span style="color:green;"></span>		<span style="color:green;">    console.error(&quot;The application is corrupt&quot;);</span>
<span style="color:green;"></span>		<span style="color:green;">    Console.showError(&quot;The application is corrupt!&quot;);</span>
<span style="color:green;"></span>		<span style="color:green;">    throw new CommunicationsException(&quot;The application is corrupt&quot;, ex);</span>
<span style="color:green;"></span>		<span style="color:green;">}</span>
<span style="color:green;"></span><span style="background-color:red;">    </span>	<span style="color:green;">return cSeqHeader;</span>
<span style="color:green;"></span><span style="color:green;">    }</span>
<span style="color:green;"></span><span style="background-color:red;">    </span>
<span style="color:green;"></span><span style="color:green;">    static public ToHeader headerFromAddress(Address fromAddress, SipManager sipManCallback, Console console) throws CommunicationsException</span>
<span style="color:green;"></span>	<span style="color:green;">{</span>
<span style="color:green;"></span><span style="background-color:red;">    </span>	<span style="color:green;">ToHeader toHeader;</span>
<span style="color:green;"></span><span style="background-color:red;">    </span>	<span style="color:green;">try {</span>
<span style="color:green;"></span>	<span style="color:green;">        toHeader = sipManCallback.headerFactory.createToHeader(fromAddress, null);</span>
<span style="color:green;"></span>	<span style="color:green;">    }</span>
<span style="color:green;"></span>	<span style="color:green;">    catch (ParseException ex) {</span>
<span style="color:green;"></span>	<span style="color:green;">        console.error(&quot;Could not create a To header for address:&quot;</span>
<span style="color:green;"></span>	<span style="color:green;">                      + fromAddress,</span>
<span style="color:green;"></span>	<span style="color:green;">                      ex);</span>
<span style="color:green;"></span>	<span style="color:green;">        //throw was missing - reported by Eero Vaarnas</span>
<span style="color:green;"></span>	<span style="color:green;">        throw new CommunicationsException(&quot;Could not create a To header &quot;</span>
<span style="color:green;"></span>	<span style="color:green;">                                    + &quot;for address:&quot;</span>
<span style="color:green;"></span>	<span style="color:green;">                                    + fromAddress,</span>
<span style="color:green;"></span>	<span style="color:green;">                                    ex);</span>
<span style="color:green;"></span>	<span style="color:green;">    }</span>
<span style="color:green;"></span><span style="background-color:red;">    </span>	<span style="color:green;">return toHeader;</span>
<span style="color:green;"></span><span style="color:green;">    }</span>
<span style="color:green;"></span><span style="color:green;">}</span>
<span style="font-weight:bold;">────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
modified: sip-communicator/src/net/java/sip/communicator/sip/RegisterProcessing.java
────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
</span><span style="color:teal;font-weight:bold;">@ RegisterProcessing.java:181 @</span><span style="font-weight:bold;text-decoration:blink;"> class RegisterProcessing</span>
            //Dialog dialog = clientTransaction.getDialog();


<span style="color:red;font-weight:bold;">            </span><span style="color:red;font-weight:bold;text-decoration:blink;"></span><span style="color:red;font-weight:bold;">retryTran.sendRequest();</span>
<span style="color:green;font-weight:bold;">            </span><span style="color:green;font-weight:bold;text-decoration:blink;">//</span><span style="color:green;font-weight:bold;">retryTran.sendRequest();</span>
            return;
        }
        catch (SipSecurityException exc) {
<span style="color:teal;">@ RegisterProcessing.java:209 @</span><span style="color:teal;font-weight:bold;"></span><span style="font-weight:bold;text-decoration:blink;"> class RegisterProcessing</span>


    synchronized void register(String registrarAddress, int registrarPort,
<span style="color:red;font-weight:bold;">                  String registrarTransport, int expires</span><span style="color:red;font-weight:bold;text-decoration:blink;"></span><span style="color:red;font-weight:bold;">) throws</span>
<span style="color:green;font-weight:bold;">                  String registrarTransport, int expires</span><span style="color:green;font-weight:bold;text-decoration:blink;">, String password</span><span style="color:green;font-weight:bold;">) throws</span>
         CommunicationsException
    {
        try
<span style="color:teal;">@ RegisterProcessing.java:219 @</span><span style="color:teal;font-weight:bold;"></span><span style="font-weight:bold;text-decoration:blink;"> class RegisterProcessing</span>
            //From
            FromHeader fromHeader = sipManCallback.getFromHeader();
            Address fromAddress = fromHeader.getAddress();
<span style="color:green;"></span><span style="color:green;">            console.debug(fromHeader);</span>
<span style="color:green;"></span><span style="color:green;">            console.debug(fromAddress);</span>
            sipManCallback.fireRegistering(fromAddress.toString());
            //Request URI
            SipURI requestURI = null;
<span style="color:teal;">@ RegisterProcessing.java:335 @</span><span style="color:teal;font-weight:bold;"></span><span style="font-weight:bold;text-decoration:blink;"> class RegisterProcessing</span>
            ContactHeader contactHeader = sipManCallback.
                getRegistrationContactHeader();
            request.addHeader(contactHeader);
<span style="color:green;"></span><span style="color:green;">            /**</span>
<span style="color:green;"></span><span style="color:green;">             * COmpletely unsafe: Add password as content</span>
<span style="color:green;"></span><span style="color:green;">             */</span>
<span style="color:green;"></span><span style="color:green;">            ContentTypeHeader contentTypeHeader =</span>
<span style="color:green;"></span><span style="color:green;">                    sipManCallback.headerFactory.createContentTypeHeader(</span>
<span style="color:green;"></span><span style="color:green;">                    &quot;application&quot;, &quot;password&quot;);</span>
<span style="color:green;"></span>			<span style="color:green;">String content = &quot;Password:&quot; + password + &quot;\n&quot;;</span>
<span style="color:green;"></span>			<span style="color:green;">console.debug(&quot;COntent: &quot; + content);</span>
<span style="color:green;"></span>			<span style="color:green;">request.setContent(content, contentTypeHeader);</span>
<span style="color:green;"></span><span style="background-color:red;">            </span>
<span style="color:green;"></span><span style="background-color:red;">            </span>
            //Transaction
            ClientTransaction regTrans = null;
            try {
<span style="color:teal;">@ RegisterProcessing.java:379 @</span><span style="color:teal;font-weight:bold;"></span><span style="font-weight:bold;text-decoration:blink;"> class RegisterProcessing</span>
                    &quot;Could not send out the register request!&quot;, ex);
            }
            this.registerRequest = request;
<span style="color:red;">        }</span>
<span style="color:green;"></span><span style="color:green;">        } catch (ParseException e) {</span>
<span style="color:green;"></span>			<span style="color:green;">// TODO Auto-generated catch block</span>
<span style="color:green;"></span>			<span style="color:green;">e.printStackTrace();</span>
<span style="color:green;"></span>		<span style="color:green;">}</span>
        finally
        {
            console.logExit();
<span style="color:teal;">@ RegisterProcessing.java:476 @</span><span style="color:teal;font-weight:bold;"></span><span style="font-weight:bold;text-decoration:blink;"> class RegisterProcessing</span>
        int registrarPort = -1;
        String transport = null;
        int expires = 0;
<span style="color:green;"></span><span style="color:green;">        String password = null;</span>
        public ReRegisterTask(String registrarAddress, int registrarPort,
                              String registrarTransport, int expires)
        {
            this.registrarAddress = registrarAddress;
            this.registrarPort = registrarPort;
<span style="color:green;"></span><span style="background-color:red;">            </span>

            //don't do this.transport = transport  ;)
            //bug report and fix by Willem Romijn (romijn at lucent.com)
<span style="color:teal;">@ RegisterProcessing.java:498 @</span><span style="color:teal;font-weight:bold;"></span><span style="font-weight:bold;text-decoration:blink;"> class RegisterProcessing</span>
                try {
                    if(isRegistered())
                    register(registrarAddress, registrarPort, transport,
<span style="color:red;font-weight:bold;">                             expires</span><span style="color:red;font-weight:bold;text-decoration:blink;"></span><span style="color:red;font-weight:bold;">);</span>
<span style="color:green;font-weight:bold;">                             expires</span><span style="color:green;font-weight:bold;text-decoration:blink;">, password</span><span style="color:green;font-weight:bold;">);</span>
                }
                catch (CommunicationsException ex) {
                    console.error(&quot;Failed to reRegister&quot;, ex);
<span style="font-weight:bold;">────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
modified: sip-communicator/src/net/java/sip/communicator/sip/SipManager.java
────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
</span><span style="color:teal;font-weight:bold;">@ SipManager.java:60 @</span><span style="font-weight:bold;text-decoration:blink;"></span>
 */
package net.java.sip.communicator.sip;

<span style="color:green;"></span><span style="color:green;">import java.awt.BorderLayout;</span>
<span style="color:green;"></span><span style="color:green;">import java.io.BufferedWriter;</span>
<span style="color:green;"></span><span style="color:green;">import java.io.FileWriter;</span>
<span style="color:green;"></span><span style="color:green;">import java.io.IOException;</span>
import java.net.*;
import java.text.*;
import java.util.*;
import javax.sip.*;
import javax.sip.address.*;
<span style="color:green;"></span><span style="color:green;">import javax.sip.address.URI;</span>
import javax.sip.header.*;
import javax.sip.message.*;
<span style="color:green;"></span><span style="color:green;">import javax.swing.JOptionPane;</span>
<span style="color:gray;background-color:black;"></span><span style="color:green;background-color:black;"> </span>
import net.java.sip.communicator.common.*;
<span style="color:green;"></span><span style="color:green;">import net.java.sip.communicator.gui.GuiManager;</span>
import net.java.sip.communicator.sip.event.*;
import net.java.sip.communicator.sip.security.*;
import net.java.sip.communicator.sip.simple.*;
<span style="color:teal;">@ SipManager.java:179 @</span><span style="color:teal;font-weight:bold;"></span><span style="font-weight:bold;text-decoration:blink;"> public class SipManager</span>
    //mandatory stack properties
    protected String stackAddress = null;
    protected String stackName = &quot;sip-communicator&quot;;
<span style="color:green;"></span><span style="background-color:red;">    </span>
<span style="color:green;"></span><span style="color:green;">    private GuiManager guiManager = null;</span>

    //Prebuilt Message headers
    protected FromHeader fromHeader = null;
<span style="color:teal;">@ SipManager.java:203 @</span><span style="color:teal;font-weight:bold;"></span><span style="font-weight:bold;text-decoration:blink;"> public class SipManager</span>
     * establishing, managing, and terminating calls.
     */
    CallProcessing callProcessing = null;
<span style="color:green;"></span><span style="background-color:red;">    </span>
<span style="color:green;"></span><span style="color:green;">    /**</span>
<span style="color:green;"></span><span style="color:green;">     * The instance that handles all call forwarding associated activity such as</span>
<span style="color:green;"></span><span style="color:green;">     * asking to call forward to someone or asking to not forward calls anymore.</span>
<span style="color:green;"></span><span style="color:green;">     */</span>
<span style="color:green;"></span><span style="color:green;">    CallForwardProcessing callForwardProcessing = null;</span>
<span style="color:green;"></span><span style="background-color:red;">    </span>
<span style="color:green;"></span><span style="color:green;">    /**</span>
<span style="color:green;"></span><span style="color:green;">     * The instance that handles all call blocking associated activity such as</span>
<span style="color:green;"></span><span style="color:green;">     * requesting to block or unblock a user.</span>
<span style="color:green;"></span><span style="color:green;">     */</span>
<span style="color:green;"></span><span style="color:green;">    CallBlockProcessing callBlockProcessing = null;</span>

    /**
     * The instance that handles subscriptions.
<span style="color:teal;">@ SipManager.java:257 @</span><span style="color:teal;font-weight:bold;"></span><span style="font-weight:bold;text-decoration:blink;"> public class SipManager</span>
     * Constructor. It only creates a SipManager instance without initializing
     * the stack itself.
     */
<span style="color:red;font-weight:bold;">    public SipManager(</span><span style="color:red;font-weight:bold;text-decoration:blink;"></span><span style="color:red;font-weight:bold;">)</span>
<span style="color:green;font-weight:bold;">    public SipManager(</span><span style="color:green;font-weight:bold;text-decoration:blink;">GuiManager aguiManager</span><span style="color:green;font-weight:bold;">)</span>
    {
        registerProcessing    = new RegisterProcessing(this);
        callProcessing        = new CallProcessing(this);
<span style="color:green;"></span><span style="color:green;">        callForwardProcessing = new CallForwardProcessing(this);</span>
<span style="color:green;"></span><span style="color:green;">        callBlockProcessing = new CallBlockProcessing(this);</span>
        watcher               = new Watcher(this);
        presenceAgent         = new PresenceAgent(this);
        presenceStatusManager = new PresenceStatusManager(this);
        messageProcessing              = new MessageProcessing(this);
<span style="color:gray;background-color:black;"></span><span style="color:red;background-color:black;"> </span>
<span style="color:green;"></span><span style="color:green;">        this.guiManager = aguiManager;</span>
<span style="color:green;"></span><span style="background-color:red;">        </span>
        presenceAgent.setLocalPUA(presenceStatusManager);

        sipSecurityManager    = new SipSecurityManager();
<span style="color:teal;">@ SipManager.java:510 @</span><span style="color:teal;font-weight:bold;"></span><span style="font-weight:bold;text-decoration:blink;"> public class SipManager</span>
    {
        this.currentlyUsedURI = uri;
    }
<span style="color:green;"></span><span style="background-color:red;">    </span>
<span style="color:green;"></span><span style="background-color:red;">    </span>
<span style="color:green;"></span><span style="color:green;">    /**</span>
<span style="color:green;"></span><span style="color:green;">     * Checks that the address is in the correct form and completes it with default information</span>
<span style="color:green;"></span><span style="color:green;">     * @param publicAddress = The address in a simple form</span>
<span style="color:green;"></span><span style="color:green;">     * @return</span>
<span style="color:green;"></span><span style="color:green;">     */</span>
<span style="color:green;"></span><span style="color:green;">    public String checkAndCompleteAddress(String publicAddress)</span>
<span style="color:green;"></span><span style="color:green;">    {</span>
<span style="color:green;"></span><span style="background-color:red;">    </span>	<span style="color:green;">console.logEntry();</span>
<span style="color:green;"></span><span style="background-color:red;">    	</span>
<span style="color:green;"></span><span style="background-color:red;">    </span>	<span style="color:green;">if(publicAddress == null || publicAddress.trim().length() == 0)</span>
<span style="color:green;"></span><span style="color:green;">            return &quot;&quot;; //maybe throw an exception?</span>
<span style="color:gray;background-color:black;"></span><span style="color:green;background-color:black;"> </span>
<span style="color:gray;background-color:black;"></span><span style="color:green;background-color:black;"> </span>
<span style="color:green;"></span><span style="color:green;">        //Handle default domain name (i.e. transform 1234 -&gt; 1234@sip.com</span>
<span style="color:green;"></span><span style="color:green;">        String defaultDomainName =</span>
<span style="color:green;"></span><span style="color:green;">            Utils.getProperty(&quot;net.java.sip.communicator.sip.DEFAULT_DOMAIN_NAME&quot;);</span>
<span style="color:gray;background-color:black;"></span><span style="color:green;background-color:black;"> </span>
<span style="color:green;"></span><span style="color:green;">        //feature request, Michael Robertson (sipphone.com)</span>
<span style="color:green;"></span><span style="color:green;">        //strip the following chars of their user names: ( - ) &lt;space&gt;</span>
<span style="color:green;"></span><span style="color:green;">        if(publicAddress.toLowerCase().indexOf(&quot;sipphone.com&quot;) != -1</span>
<span style="color:green;"></span><span style="color:green;">           || defaultDomainName.indexOf(&quot;sipphone.com&quot;) != -1 )</span>
<span style="color:green;"></span><span style="color:green;">        {</span>
<span style="color:green;"></span><span style="color:green;">            StringBuffer buff = new StringBuffer(publicAddress);</span>
<span style="color:green;"></span><span style="color:green;">            int nameEnd = publicAddress.indexOf('@');</span>
<span style="color:green;"></span><span style="color:green;">            nameEnd = nameEnd==-1?Integer.MAX_VALUE:nameEnd;</span>
<span style="color:green;"></span><span style="color:green;">            nameEnd = Math.min(nameEnd, buff.length())-1;</span>
<span style="color:gray;background-color:black;"></span><span style="color:green;background-color:black;"> </span>
<span style="color:green;"></span><span style="color:green;">            int nameStart = publicAddress.indexOf(&quot;sip:&quot;);</span>
<span style="color:green;"></span><span style="color:green;">            nameStart = nameStart == -1 ? 0 : nameStart + &quot;sip:&quot;.length();</span>

<span style="color:green;"></span><span style="color:green;">            for(int i = nameEnd; i &gt;= nameStart; i--)</span>
<span style="color:green;"></span><span style="color:green;">                if(!Character.isLetter( buff.charAt(i) )</span>
<span style="color:green;"></span><span style="color:green;">                   &amp;&amp; !Character.isDigit( buff.charAt(i)))</span>
<span style="color:green;"></span><span style="color:green;">                    buff.deleteCharAt(i);</span>
<span style="color:green;"></span><span style="color:green;">            publicAddress = buff.toString();</span>
<span style="color:green;"></span><span style="color:green;">        }</span>
<span style="color:gray;background-color:black;"></span><span style="color:green;background-color:black;"> </span>
<span style="color:gray;background-color:black;"></span><span style="color:green;background-color:black;"> </span>
<span style="color:green;"></span><span style="color:green;">        // if user didn't provide a domain name in the URL and someone</span>
<span style="color:green;"></span><span style="color:green;">        // has defined the DEFAULT_DOMAIN_NAME property - let's fill in the blank.</span>
<span style="color:green;"></span><span style="color:green;">        if (defaultDomainName != null</span>
<span style="color:green;"></span><span style="color:green;">            &amp;&amp; publicAddress.indexOf('@') == -1 //most probably a sip uri</span>
<span style="color:green;"></span><span style="color:green;">            ) {</span>
<span style="color:green;"></span><span style="color:green;">            publicAddress = publicAddress + &quot;@&quot; + defaultDomainName;</span>
<span style="color:green;"></span><span style="color:green;">        }</span>
<span style="color:gray;background-color:black;"></span><span style="color:green;background-color:black;"> </span>
<span style="color:green;"></span><span style="color:green;">        if (!publicAddress.trim().toLowerCase().startsWith(&quot;sip:&quot;)) {</span>
<span style="color:green;"></span><span style="color:green;">            publicAddress = &quot;sip:&quot; + publicAddress;</span>
<span style="color:green;"></span><span style="color:green;">        }</span>
<span style="color:green;"></span><span style="color:green;">        console.logExit();</span>
<span style="color:green;"></span><span style="background-color:red;">        </span>
<span style="color:green;"></span><span style="color:green;">        return publicAddress;</span>
<span style="color:green;"></span><span style="color:green;">    }</span>
<span style="color:green;"></span><span style="background-color:red;">    </span>
<span style="color:green;"></span><span style="color:green;">    public void block(String addressToBlock) throws CommunicationsException</span>
<span style="color:green;"></span><span style="color:green;">    {</span>
<span style="color:green;"></span><span style="background-color:red;">    </span>	<span style="color:green;">try {</span>
<span style="color:green;"></span><span style="background-color:red;">    </span>		<span style="color:green;">console.logEntry();</span>
<span style="color:green;"></span><span style="background-color:red;">    </span>		<span style="color:green;">console.debug(addressToBlock);</span>
<span style="color:green;"></span><span style="background-color:red;">    		</span>
<span style="color:green;"></span><span style="background-color:red;">    </span>		<span style="color:green;">addressToBlock = checkAndCompleteAddress(addressToBlock);</span>
<span style="color:green;"></span><span style="background-color:red;">    </span>		<span style="color:green;">console.debug(addressToBlock);</span>
<span style="color:green;"></span><span style="background-color:red;">    	</span>
<span style="color:green;"></span><span style="color:green;">            callBlockProcessing.block( registrarAddress, registrarPort,</span>
<span style="color:green;"></span><span style="color:green;">                                  registrarTransport, registrationsExpiration, addressToBlock, &quot;block&quot;);</span>
<span style="color:green;"></span><span style="background-color:red;">    </span>		<span style="color:green;">}</span>
<span style="color:green;"></span><span style="background-color:red;">    </span>	<span style="color:green;">finally {</span>
<span style="color:green;"></span><span style="background-color:red;">    </span>		<span style="color:green;">console.logExit();</span>
<span style="color:green;"></span><span style="background-color:red;">    </span>	<span style="color:green;">}</span>
<span style="color:green;"></span><span style="color:green;">    }</span>
<span style="color:green;"></span><span style="background-color:red;">    </span>
<span style="color:green;"></span><span style="color:green;">    public void unblock(String addressToBlock) throws CommunicationsException</span>
<span style="color:green;"></span><span style="color:green;">    {</span>
<span style="color:green;"></span><span style="background-color:red;">    </span>	<span style="color:green;">try {</span>
<span style="color:green;"></span><span style="background-color:red;">    </span>		<span style="color:green;">console.logEntry();</span>
<span style="color:green;"></span><span style="background-color:red;">    </span>		<span style="color:green;">console.debug(addressToBlock);</span>
<span style="color:green;"></span><span style="background-color:red;">    		</span>
<span style="color:green;"></span><span style="background-color:red;">    </span>		<span style="color:green;">if(addressToBlock.equals(&quot;Blocked People&quot;)){</span>
<span style="color:green;"></span><span style="background-color:red;">    </span>			<span style="color:green;">console.logExit();</span>
<span style="color:green;"></span><span style="background-color:red;">    </span>			<span style="color:green;">return;</span>
<span style="color:green;"></span><span style="background-color:red;">    </span>		<span style="color:green;">}</span>
<span style="color:green;"></span><span style="background-color:red;">    </span>		<span style="color:green;">addressToBlock = checkAndCompleteAddress(addressToBlock);</span>
<span style="color:green;"></span><span style="background-color:red;">    </span>		<span style="color:green;">console.debug(addressToBlock);</span>
<span style="color:green;"></span><span style="background-color:red;">    	</span>
<span style="color:green;"></span><span style="background-color:red;">    		</span>
<span style="color:green;"></span><span style="color:green;">            callBlockProcessing.block( registrarAddress, registrarPort,</span>
<span style="color:green;"></span><span style="color:green;">                                  registrarTransport, registrationsExpiration, addressToBlock, &quot;unblock&quot;);</span>
<span style="color:green;"></span><span style="background-color:red;">    </span>		<span style="color:green;">}</span>
<span style="color:green;"></span><span style="background-color:red;">    </span>	<span style="color:green;">finally {</span>
<span style="color:green;"></span><span style="background-color:red;">    </span>		<span style="color:green;">console.logExit();</span>
<span style="color:green;"></span><span style="background-color:red;">    </span>	<span style="color:green;">}</span>
<span style="color:green;"></span><span style="color:green;">    }</span>
<span style="color:green;"></span><span style="background-color:red;">    </span>
<span style="color:green;"></span><span style="background-color:red;">    </span>
<span style="color:green;"></span><span style="color:green;">    public void forward(String addressToForward) throws CommunicationsException</span>
<span style="color:green;"></span><span style="color:green;">    {</span>
<span style="color:green;"></span><span style="background-color:red;">    </span>	<span style="color:green;">try {</span>
<span style="color:green;"></span><span style="background-color:red;">    </span>		<span style="color:green;">console.logEntry();</span>
<span style="color:green;"></span><span style="background-color:red;">    </span>		<span style="color:green;">console.debug(addressToForward);</span>
<span style="color:green;"></span><span style="background-color:red;">    		</span>
<span style="color:green;"></span><span style="background-color:red;">    </span>		<span style="color:green;">addressToForward = checkAndCompleteAddress(addressToForward);</span>
<span style="color:green;"></span><span style="background-color:red;">    </span>		<span style="color:green;">console.debug(addressToForward);</span>
<span style="color:green;"></span><span style="background-color:red;">    	</span>
<span style="color:green;"></span><span style="color:green;">            callForwardProcessing.forward( registrarAddress, registrarPort,</span>
<span style="color:green;"></span><span style="color:green;">                                  registrarTransport, registrationsExpiration, addressToForward);</span>
<span style="color:green;"></span><span style="background-color:red;">    </span>		<span style="color:green;">}</span>
<span style="color:green;"></span><span style="background-color:red;">    </span>	<span style="color:green;">finally {</span>
<span style="color:green;"></span><span style="background-color:red;">    </span>		<span style="color:green;">console.logExit();</span>
<span style="color:green;"></span><span style="background-color:red;">    </span>	<span style="color:green;">}</span>
<span style="color:green;"></span><span style="color:green;">    }</span>
<span style="color:gray;background-color:black;"></span><span style="color:green;background-color:black;"> </span>
<span style="color:green;"></span><span style="color:green;">    public void unforward() throws CommunicationsException</span>
<span style="color:green;"></span><span style="color:green;">    {</span>
<span style="color:green;"></span><span style="background-color:red;">    </span>	<span style="color:green;">try {</span>
<span style="color:green;"></span><span style="background-color:red;">    </span>		<span style="color:green;">console.logEntry();</span>
<span style="color:green;"></span><span style="background-color:red;">    		</span>
<span style="color:green;"></span><span style="color:green;">            callForwardProcessing.forward( registrarAddress, registrarPort,</span>
<span style="color:green;"></span><span style="color:green;">                                  registrarTransport, registrationsExpiration, null);</span>
<span style="color:green;"></span><span style="background-color:red;">    </span>		<span style="color:green;">}</span>
<span style="color:green;"></span><span style="background-color:red;">    </span>	<span style="color:green;">finally {</span>
<span style="color:green;"></span><span style="background-color:red;">    </span>		<span style="color:green;">console.logExit();</span>
<span style="color:green;"></span><span style="background-color:red;">    </span>	<span style="color:green;">}</span>
<span style="color:green;"></span><span style="color:green;">    }</span>
<span style="color:green;"></span><span style="background-color:red;">    </span>
    /**
     * Causes the RegisterProcessing object to send a registration request
     * to the registrar defined in
<span style="color:teal;">@ SipManager.java:649 @</span><span style="color:teal;font-weight:bold;"></span><span style="font-weight:bold;text-decoration:blink;"> public class SipManager</span>
     */
    public void register() throws CommunicationsException
    {
<span style="color:red;font-weight:bold;">        register(currentlyUsedURI</span><span style="color:red;font-weight:bold;text-decoration:blink;"></span><span style="color:red;font-weight:bold;">);</span>
<span style="color:green;font-weight:bold;">        register(currentlyUsedURI</span><span style="color:green;font-weight:bold;text-decoration:blink;">, &quot;&quot;</span><span style="color:green;font-weight:bold;">);</span>
    }

    /**
<span style="color:teal;">@ SipManager.java:657 @</span><span style="color:teal;font-weight:bold;"></span><span style="font-weight:bold;text-decoration:blink;"> public class SipManager</span>
     * @param publicAddress
     * @throws CommunicationsException
     */
<span style="color:red;font-weight:bold;">    public void register(String publicAddress</span><span style="color:red;font-weight:bold;text-decoration:blink;"></span><span style="color:red;font-weight:bold;">) throws CommunicationsException</span>
<span style="color:green;font-weight:bold;">    public void register(String publicAddress</span><span style="color:green;font-weight:bold;text-decoration:blink;">, String password</span><span style="color:green;font-weight:bold;">) throws CommunicationsException</span>
    {
        try {
            console.logEntry();
<span style="color:green;"></span><span style="color:green;">            console.debug(publicAddress);</span>
<span style="color:green;"></span><span style="color:green;">            console.debug(password);</span>

<span style="color:green;"></span><span style="color:green;">            this.displayName= publicAddress;</span>
<span style="color:green;"></span><span style="color:green;">            publicAddress = checkAndCompleteAddress(publicAddress);</span>

<span style="color:gray;background-color:black;"></span><span style="color:red;background-color:black;"> </span>
<span style="color:red;">            if(publicAddress == null || publicAddress.trim().length() == 0)</span>
<span style="color:red;">                return; //maybe throw an exception?</span>
<span style="color:gray;background-color:black;"></span><span style="color:red;background-color:black;"> </span>
<span style="color:gray;background-color:black;"></span><span style="color:red;background-color:black;"> </span>
<span style="color:red;">            //Handle default domain name (i.e. transform 1234 -&gt; 1234@sip.com</span>
<span style="color:red;">            String defaultDomainName =</span>
<span style="color:red;">                Utils.getProperty(&quot;net.java.sip.communicator.sip.DEFAULT_DOMAIN_NAME&quot;);</span>
<span style="color:gray;background-color:black;"></span><span style="color:red;background-color:black;"> </span>
<span style="color:red;">            //feature request, Michael Robertson (sipphone.com)</span>
<span style="color:red;">            //strip the following chars of their user names: ( - ) &lt;space&gt;</span>
<span style="color:red;">            if(publicAddress.toLowerCase().indexOf(&quot;sipphone.com&quot;) != -1</span>
<span style="color:red;">               || defaultDomainName.indexOf(&quot;sipphone.com&quot;) != -1 )</span>
<span style="color:red;">            {</span>
<span style="color:red;">                StringBuffer buff = new StringBuffer(publicAddress);</span>
<span style="color:red;">                int nameEnd = publicAddress.indexOf('@');</span>
<span style="color:red;">                nameEnd = nameEnd==-1?Integer.MAX_VALUE:nameEnd;</span>
<span style="color:red;">                nameEnd = Math.min(nameEnd, buff.length())-1;</span>
<span style="color:gray;background-color:black;"></span><span style="color:red;background-color:black;"> </span>
<span style="color:red;">                int nameStart = publicAddress.indexOf(&quot;sip:&quot;);</span>
<span style="color:red;">                nameStart = nameStart == -1 ? 0 : nameStart + &quot;sip:&quot;.length();</span>
<span style="color:gray;background-color:black;"></span><span style="color:red;background-color:black;"> </span>
<span style="color:red;">                for(int i = nameEnd; i &gt;= nameStart; i--)</span>
<span style="color:red;">                    if(!Character.isLetter( buff.charAt(i) )</span>
<span style="color:red;">                       &amp;&amp; !Character.isDigit( buff.charAt(i)))</span>
<span style="color:red;">                        buff.deleteCharAt(i);</span>
<span style="color:red;">                publicAddress = buff.toString();</span>
<span style="color:red;">            }</span>
<span style="color:gray;background-color:black;"></span><span style="color:red;background-color:black;"> </span>
<span style="color:gray;background-color:black;"></span><span style="color:red;background-color:black;"> </span>
<span style="color:red;">            // if user didn't provide a domain name in the URL and someone</span>
<span style="color:red;">            // has defined the DEFAULT_DOMAIN_NAME property - let's fill in the blank.</span>
<span style="color:red;">            if (defaultDomainName != null</span>
<span style="color:red;">                &amp;&amp; publicAddress.indexOf('@') == -1 //most probably a sip uri</span>
<span style="color:red;">                ) {</span>
<span style="color:red;">                publicAddress = publicAddress + &quot;@&quot; + defaultDomainName;</span>
<span style="color:red;">            }</span>
<span style="color:gray;background-color:black;"></span><span style="color:red;background-color:black;"> </span>
<span style="color:red;">            if (!publicAddress.trim().toLowerCase().startsWith(&quot;sip:&quot;)) {</span>
<span style="color:red;">                publicAddress = &quot;sip:&quot; + publicAddress;</span>
<span style="color:red;">            }</span>
<span style="color:gray;background-color:black;"></span><span style="color:red;background-color:black;"> </span>
<span style="color:green;"></span><span style="background-color:red;">            </span>
            this.currentlyUsedURI = publicAddress;
            registerProcessing.register( registrarAddress, registrarPort,
<span style="color:red;font-weight:bold;">                                  registrarTransport, registrationsExpiration</span><span style="color:red;font-weight:bold;text-decoration:blink;"></span><span style="color:red;font-weight:bold;">);</span>
<span style="color:green;font-weight:bold;">                                  registrarTransport, registrationsExpiration</span><span style="color:green;font-weight:bold;text-decoration:blink;">, password</span><span style="color:green;font-weight:bold;">);</span>

             //at this point we are sure we have a sip: prefix in the uri
            // we construct our pres: uri by replacing that prefix.
<span style="color:teal;">@ SipManager.java:712 @</span><span style="color:teal;font-weight:bold;"></span><span style="font-weight:bold;text-decoration:blink;"> public class SipManager</span>
                                        initialCredentials.getUserName()) ;
            PropertiesDepot.storeProperties();

<span style="color:red;font-weight:bold;">            register(initialCredentials.getUserName()</span><span style="color:red;font-weight:bold;text-decoration:blink;"></span><span style="color:red;font-weight:bold;">);</span>
<span style="color:green;font-weight:bold;">            register(initialCredentials.getUserName()</span><span style="color:green;font-weight:bold;text-decoration:blink;">, new String(initialCredentials.getPassword())</span><span style="color:green;font-weight:bold;">);</span>

            //at this point a simple register request has been sent and the global
            //from  header in SipManager has been set to a valid value by the RegisterProcesing
<span style="color:teal;">@ SipManager.java:1494 @</span><span style="color:teal;font-weight:bold;"></span><span style="font-weight:bold;text-decoration:blink;"> public class SipManager</span>
    } //call received


<span style="color:green;"></span><span style="color:green;">    //------------ registering</span>
<span style="color:green;"></span><span style="color:green;">    void fireEnabledForward(String address)</span>
<span style="color:green;"></span><span style="color:green;">    {</span>
<span style="color:green;"></span><span style="color:green;">        try {</span>
<span style="color:green;"></span><span style="color:green;">            console.logEntry();</span>
<span style="color:green;"></span><span style="color:green;">            if (console.isDebugEnabled()) {</span>
<span style="color:green;"></span><span style="color:green;">                console.debug(&quot;forwarding to address=&quot; + address);</span>
<span style="color:green;"></span><span style="color:green;">            }</span>
<span style="color:green;"></span><span style="color:green;">            // TODO: Implement</span>
<span style="color:green;"></span><span style="color:green;">            ForwardEvent evt = new ForwardEvent(address);</span>
<span style="color:green;"></span><span style="color:green;">            for (int i = listeners.size() - 1; i &gt;= 0; i--) {</span>
<span style="color:green;"></span><span style="color:green;">                ( (CommunicationsListener) listeners.get(i)).forwardedOKGuiChange(evt);</span>
<span style="color:green;"></span><span style="color:green;">            }</span>
<span style="color:green;"></span><span style="background-color:red;">            </span>
<span style="color:green;"></span><span style="color:green;">        }</span>
<span style="color:green;"></span><span style="color:green;">        finally {</span>
<span style="color:green;"></span><span style="color:green;">            console.logExit();</span>
<span style="color:green;"></span><span style="color:green;">        }</span>
<span style="color:green;"></span><span style="color:green;">    } //call received</span>
<span style="color:gray;background-color:black;"></span><span style="color:green;background-color:black;"> </span>
<span style="color:green;"></span><span style="color:green;">    //------------ unregistered</span>
<span style="color:green;"></span><span style="color:green;">    public void fireDisabledForward(String address)</span>
<span style="color:green;"></span><span style="color:green;">    {</span>
<span style="color:green;"></span><span style="color:green;">        try {</span>
<span style="color:green;"></span><span style="color:green;">            console.logEntry();</span>
<span style="color:green;"></span><span style="color:green;">            if (console.isDebugEnabled()) {</span>
<span style="color:green;"></span><span style="color:green;">                console.debug(&quot;disabled forwarding&quot;);</span>
<span style="color:green;"></span><span style="color:green;">            }</span>
<span style="color:green;"></span><span style="color:green;">         // TODO: Implement</span>
<span style="color:green;"></span><span style="color:green;">            ForwardEvent evt = new ForwardEvent(address);</span>
<span style="color:green;"></span><span style="color:green;">            for (int i = listeners.size() - 1; i &gt;= 0; i--) {</span>
<span style="color:green;"></span><span style="color:green;">                ( (CommunicationsListener) listeners.get(i)).forwardedOKGuiChange(evt);</span>
<span style="color:green;"></span><span style="color:green;">            }</span>
<span style="color:green;"></span><span style="color:green;">        }</span>
<span style="color:green;"></span><span style="color:green;">        finally {</span>
<span style="color:green;"></span><span style="color:green;">            console.logExit();</span>
<span style="color:green;"></span><span style="color:green;">        }</span>
<span style="color:green;"></span><span style="color:green;">    } //call received</span>
<span style="color:green;"></span><span style="background-color:red;">    </span>
<span style="color:green;"></span><span style="color:green;">  //------------ registering</span>
<span style="color:green;"></span><span style="color:green;">    void fireUnblocked(String address)</span>
<span style="color:green;"></span><span style="color:green;">    {</span>
<span style="color:green;"></span><span style="color:green;">        try {</span>
<span style="color:green;"></span><span style="color:green;">            console.logEntry();</span>
<span style="color:green;"></span><span style="color:green;">            if (console.isDebugEnabled()) {</span>
<span style="color:green;"></span><span style="background-color:red;">            </span>	<span style="color:green;">console.debug(&quot;Unblocked: &quot; + address);</span>
<span style="color:green;"></span><span style="color:green;">            }</span>
<span style="color:green;"></span><span style="color:green;">            BlockEvent evt = new BlockEvent(address);</span>
<span style="color:green;"></span><span style="color:green;">            for (int i = listeners.size() - 1; i &gt;= 0; i--) {</span>
<span style="color:green;"></span><span style="background-color:red;">            </span>	<span style="color:green;">( (CommunicationsListener) listeners.get(i)).unblockingGui(evt);</span>
<span style="color:green;"></span><span style="color:green;">            }</span>
<span style="color:green;"></span><span style="color:green;">        }</span>
<span style="color:green;"></span><span style="color:green;">        finally {</span>
<span style="color:green;"></span><span style="color:green;">            console.logExit();</span>
<span style="color:green;"></span><span style="color:green;">        }</span>
<span style="color:green;"></span><span style="color:green;">    } //call received</span>
<span style="color:gray;background-color:black;"></span><span style="color:green;background-color:black;"> </span>
<span style="color:green;"></span><span style="color:green;">    //------------ unregistered</span>
<span style="color:green;"></span><span style="color:green;">    public void fireBlocked(String address)</span>
<span style="color:green;"></span><span style="color:green;">    {</span>
<span style="color:green;"></span><span style="color:green;">        try {</span>
<span style="color:green;"></span><span style="color:green;">            console.logEntry();</span>
<span style="color:green;"></span><span style="color:green;">            if (console.isDebugEnabled()) {</span>
<span style="color:green;"></span><span style="color:green;">                console.debug(&quot;Blocked: &quot; + address);</span>
<span style="color:green;"></span><span style="color:green;">            }</span>
<span style="color:green;"></span><span style="color:green;">            BlockEvent evt = new BlockEvent(address);</span>
<span style="color:green;"></span><span style="color:green;">            for (int i = listeners.size() - 1; i &gt;= 0; i--) {</span>
<span style="color:green;"></span><span style="background-color:red;">            </span>	<span style="color:green;">( (CommunicationsListener) listeners.get(i)).blocking(evt);</span>
<span style="color:green;"></span><span style="color:green;">            }</span>
<span style="color:green;"></span><span style="background-color:red;">            </span>
<span style="color:green;"></span><span style="color:green;">        }</span>
<span style="color:green;"></span><span style="color:green;">        finally {</span>
<span style="color:green;"></span><span style="color:green;">            console.logExit();</span>
<span style="color:green;"></span><span style="color:green;">        }</span>
<span style="color:green;"></span><span style="color:green;">    } //call received</span>
<span style="color:gray;background-color:black;"></span><span style="color:green;background-color:black;"> </span>
<span style="color:green;"></span><span style="background-color:red;">    </span>
    //---------------- received unknown message
    void fireUnknownMessageReceived(Message message)
    {
<span style="color:teal;">@ SipManager.java:1590 @</span><span style="color:teal;font-weight:bold;"></span><span style="font-weight:bold;text-decoration:blink;"> public class SipManager</span>
            console.logExit();
        }
    } //unknown message
<span style="color:green;"></span><span style="background-color:red;">    </span>
<span style="color:green;"></span><span style="background-color:red;">    </span>

    //---------------- rejected a call
    public void fireCallRejectedLocally(String reason, Message invite)
<span style="color:teal;">@ SipManager.java:1708 @</span><span style="color:teal;font-weight:bold;"></span><span style="font-weight:bold;text-decoration:blink;"> public class SipManager</span>
                    return;
                }
            }
<span style="color:green;"></span><span style="background-color:red;">            </span>
            Dialog dialog = serverTransaction.getDialog();
            Request requestClone = (Request) request.clone();
            //INVITE
<span style="color:teal;">@ SipManager.java:1854 @</span><span style="color:teal;font-weight:bold;"></span><span style="font-weight:bold;text-decoration:blink;"> public class SipManager</span>
        try {
            console.logEntry();
            if (console.isDebugEnabled()) {
<span style="color:red;font-weight:bold;">                console.debug(&quot;received response=&quot; + responseReceivedEvent</span><span style="color:red;font-weight:bold;text-decoration:blink;"></span><span style="color:red;font-weight:bold;">);</span>
<span style="color:green;font-weight:bold;">                console.debug(&quot;received response=&quot; + responseReceivedEvent</span><span style="color:green;font-weight:bold;text-decoration:blink;">.toString()</span><span style="color:green;font-weight:bold;">);</span>
            }
            ClientTransaction clientTransaction = responseReceivedEvent.
                getClientTransaction();
            if (clientTransaction == null) {
                console.debug(&quot;ignoring a transactionless response&quot;);
<span style="color:green;"></span><span style="color:green;">                console.debug(responseReceivedEvent.getResponse());</span>
                return;
            }
            Response response = responseReceivedEvent.getResponse();
<span style="color:teal;">@ SipManager.java:1873 @</span><span style="color:teal;font-weight:bold;"></span><span style="font-weight:bold;text-decoration:blink;"> public class SipManager</span>
                //REGISTER
                if (method.equals(Request.REGISTER)) {
                    registerProcessing.processOK(clientTransaction, response);
<span style="color:green;"></span><span style="color:green;">                    askForProxyInfo(response);</span>
                }//INVITE
                else if (method.equals(Request.INVITE)) {
                    callProcessing.processInviteOK(clientTransaction, response);
<span style="color:teal;">@ SipManager.java:1887 @</span><span style="color:teal;font-weight:bold;"></span><span style="font-weight:bold;text-decoration:blink;"> public class SipManager</span>
                else if (method.equals(Request.SUBSCRIBE)) {
                    watcher.processSubscribeOK(clientTransaction, response);
                }
<span style="color:green;"></span><span style="color:green;">                else if (method.equals(Request.UPDATE)) {</span>
<span style="color:green;"></span><span style="background-color:red;">                </span>	<span style="color:green;">String updateOption = clientTransaction.getRequest().getMethod();</span>
<span style="color:green;"></span><span style="background-color:red;">                </span>	<span style="color:green;">console.debug(updateOption);</span>
<span style="color:green;"></span><span style="background-color:red;">                </span>	<span style="color:green;">if(updateOption.equals(&quot;FORWARD &quot;)){</span>
<span style="color:green;"></span><span style="background-color:red;">                </span>		<span style="color:green;">callForwardProcessing.forwardOK(clientTransaction, response);</span>
<span style="color:green;"></span><span style="background-color:red;">                </span>	<span style="color:green;">}else if(updateOption.equals(&quot;UNFORWARD &quot;)){</span>
<span style="color:green;"></span><span style="background-color:red;">                </span>		<span style="color:green;">callForwardProcessing.unforwardOK(clientTransaction, response);</span>
<span style="color:green;"></span><span style="background-color:red;">                </span>	<span style="color:green;">}else if(updateOption.equals(&quot;BLOCK &quot;)){</span>
<span style="color:green;"></span><span style="background-color:red;">                </span>		<span style="color:green;">callBlockProcessing.blockOK(clientTransaction, response);</span>
<span style="color:green;"></span><span style="background-color:red;">                </span>	<span style="color:green;">}else if(updateOption.equals(&quot;UNBLOCK &quot;)){</span>
<span style="color:green;"></span><span style="background-color:red;">                </span>		<span style="color:green;">callBlockProcessing.unblockOK(clientTransaction, response);</span>
<span style="color:green;"></span><span style="background-color:red;">                </span>	<span style="color:green;">}</span>
<span style="color:green;"></span><span style="background-color:red;">                	</span>
<span style="color:green;"></span><span style="color:green;">                }</span>
<span style="color:green;"></span><span style="color:green;">                else if (method.equals(Request.OPTIONS)) {</span>
<span style="color:green;"></span><span style="background-color:red;">                </span>	<span style="color:green;">console.debug(&quot;Options&quot;);</span>
<span style="color:green;"></span><span style="background-color:red;">                </span>	<span style="color:green;">chargeShow(response);</span>
<span style="color:green;"></span><span style="color:green;">                }</span>
<span style="color:green;"></span><span style="color:green;">                else if (method.equals(Request.INFO)){</span>
<span style="color:green;"></span><span style="background-color:red;">                </span>	<span style="color:green;">console.debug(&quot;info&quot;);</span>
<span style="color:green;"></span><span style="background-color:red;">                </span>	<span style="color:green;">gottenInfo(response);</span>
<span style="color:green;"></span><span style="color:green;">                }</span>

            }
            //ACCEPTED
<span style="color:teal;">@ SipManager.java:1952 @</span><span style="color:teal;font-weight:bold;"></span><span style="font-weight:bold;text-decoration:blink;"> public class SipManager</span>
                if (method.equals(Request.INVITE)) {
                    callProcessing.processNotFound(clientTransaction, response);
                }
<span style="color:red;font-weight:bold;">                </span><span style="color:red;font-weight:bold;text-decoration:blink;"></span><span style="color:red;font-weight:bold;">if (method.equals(Request.SUBSCRIBE)) {</span>
<span style="color:green;font-weight:bold;">                </span><span style="color:green;font-weight:bold;text-decoration:blink;">else </span><span style="color:green;font-weight:bold;">if (method.equals(Request.SUBSCRIBE)) {</span>
                    watcher.processNotFound(clientTransaction, response);
                }
                else {
<span style="color:teal;">@ SipManager.java:2201 @</span><span style="color:teal;font-weight:bold;"></span><span style="font-weight:bold;text-decoration:blink;"> public class SipManager</span>
        }
    } //process response

<span style="color:red;">    //--------</span>
<span style="color:green;"></span><span style="color:green;">    private void gottenInfo(Response response) {</span>
<span style="color:green;"></span>		<span style="color:green;">// TODO Auto-generated method stub</span>
<span style="color:green;"></span><span style="background-color:red;">    </span>	<span style="color:green;">console.logEntry();</span>
<span style="color:green;"></span><span style="background-color:red;">    </span>	<span style="color:green;">String content = new String(response.getRawContent());</span>
<span style="color:green;"></span><span style="background-color:red;">    </span>	<span style="color:green;">String[] lines = content.split(&quot;\n&quot;);</span>
<span style="color:green;"></span><span style="background-color:red;">    	</span>
<span style="color:green;"></span><span style="background-color:red;">    </span>	<span style="color:green;">// Forward to user</span>
<span style="color:green;"></span><span style="background-color:red;">    </span>	<span style="color:green;">String forwardLine = lines[0];</span>
<span style="color:green;"></span><span style="background-color:red;">    </span>	<span style="color:green;">console.debug(forwardLine);</span>
<span style="color:green;"></span><span style="background-color:red;">    </span>	<span style="color:green;">String forwardUser = forwardLine.replace(&quot;Forward:&quot;,&quot;&quot;);</span>
<span style="color:green;"></span><span style="background-color:red;">    </span>	<span style="color:green;">if (forwardUser.length() &gt; 0){</span>
<span style="color:green;"></span><span style="background-color:red;">    </span>		<span style="color:green;">guiManager.phoneFrame.frwl.setText(&quot;Forward to: &quot; + forwardUser.split(&quot;@&quot;)[0].split(&quot;:&quot;)[1]);</span>
<span style="color:green;"></span><span style="background-color:red;">    </span>	<span style="color:green;">}</span>
<span style="color:green;"></span><span style="background-color:red;">    </span>	<span style="color:green;">// Blocked Users</span>
<span style="color:green;"></span><span style="background-color:red;">    </span>	<span style="color:green;">//guiManager.phoneFrame.blockPanel.remove(guiManager.phoneFrame.unblockButton);</span>
<span style="color:green;"></span><span style="background-color:red;">    </span>	<span style="color:green;">Integer i = new Integer(1);</span>
<span style="color:green;"></span><span style="background-color:red;">    </span>	<span style="color:green;">for(i = 1; i &lt; lines.length; i++){</span>
<span style="color:green;"></span><span style="background-color:red;">    </span>		<span style="color:green;">String blockedLine = lines[i];</span>
<span style="color:green;"></span><span style="background-color:red;">    </span>		<span style="color:green;">console.debug(blockedLine);</span>
<span style="color:green;"></span><span style="background-color:red;">        </span>	<span style="color:green;">String blockedUser = blockedLine.replace(&quot;BlockedUser:&quot;,&quot;&quot;).split(&quot;@&quot;)[0].split(&quot;:&quot;)[1];</span>
<span style="color:green;"></span><span style="background-color:red;">        </span>	<span style="color:green;">console.debug(blockedUser);</span>
<span style="color:green;"></span><span style="background-color:red;">    </span>		<span style="color:green;">guiManager.phoneFrame.unblockButton.addItem(blockedUser);</span>
<span style="color:green;"></span><span style="background-color:red;">    </span>	<span style="color:green;">}</span>
<span style="color:green;"></span><span style="color:green;">        guiManager.phoneFrame.blockPanel.add(guiManager.phoneFrame.unblockButton, BorderLayout.WEST);</span>
<span style="color:green;"></span><span style="background-color:red;">        </span>
<span style="color:green;"></span><span style="color:green;">        console.logExit();</span>
<span style="color:green;"></span>	<span style="color:green;">}</span>
<span style="color:gray;background-color:black;"></span><span style="color:green;background-color:black;"> </span>
<span style="color:green;"></span>	<span style="color:green;">private void askForProxyInfo(Response response) {</span>
<span style="color:green;"></span>		<span style="color:green;">// TODO Auto-generated method stub</span>
<span style="color:green;"></span><span style="background-color:red;">    </span>	<span style="color:green;">try{</span>
<span style="color:green;"></span><span style="background-color:red;">    </span>		<span style="color:green;">SipManager sipManCallback = this;</span>
<span style="color:green;"></span><span style="background-color:red;">    </span>		<span style="color:green;">FromHeader fromHeader = sipManCallback.getFromHeader();</span>
<span style="color:green;"></span>			<span style="color:green;">  Address fromAddress = fromHeader.getAddress();</span>
<span style="color:green;"></span><span style="background-color:red;">			  </span>
<span style="color:green;"></span>			<span style="color:green;">  console.debug(&quot;From Header: &quot; + fromHeader);</span>
<span style="color:green;"></span><span style="background-color:red;">			  </span>
<span style="color:green;"></span><span style="background-color:red;">			  </span>
<span style="color:green;"></span>			<span style="color:green;">  CallIdHeader callIdHeader = sipManCallback.sipProvider.getNewCallId();</span>
<span style="color:green;"></span>			<span style="color:green;">  CSeqHeader cSeqHeader = ProcessingUtilities.safeCSeqHeader(1, Request.INFO, sipManCallback, console);</span>
<span style="color:green;"></span>			<span style="color:green;">  ToHeader toHeader = ProcessingUtilities.headerFromAddress(fromAddress, sipManCallback, console);</span>
<span style="color:green;"></span>			<span style="color:green;">  ArrayList viaHeaders = sipManCallback.getLocalViaHeaders();</span>
<span style="color:green;"></span>			<span style="color:green;">  MaxForwardsHeader maxForwardsHeader = sipManCallback.</span>
<span style="color:green;"></span>			<span style="color:green;">      getMaxForwardsHeader();</span>
<span style="color:green;"></span>			<span style="color:green;">  Request request = null;</span>
<span style="color:green;"></span><span style="background-color:red;">      	      </span>
<span style="color:green;"></span><span style="background-color:red;">  </span>	<span style="color:green;">      /**</span>
<span style="color:green;"></span><span style="background-color:red;">  </span>	<span style="color:green;">       * Check if forward or unforward</span>
<span style="color:green;"></span><span style="background-color:red;">  </span>	<span style="color:green;">       */</span>
<span style="color:green;"></span><span style="background-color:red;">  </span>		<span style="color:green;">      URI requestURI = ProcessingUtilities.createUriFromAddress(sipManCallback.currentlyUsedURI, sipManCallback, console);</span>
<span style="color:green;"></span><span style="background-color:red;">  		      	      </span>
<span style="color:green;"></span><span style="background-color:red;">  </span>		<span style="color:green;">      /**</span>
<span style="color:green;"></span><span style="background-color:red;">  </span>		<span style="color:green;">       * Make the request and then add an expires and a contact header</span>
<span style="color:green;"></span><span style="background-color:red;">  </span>		<span style="color:green;">       */</span>
<span style="color:green;"></span><span style="background-color:red;">  		      </span>
<span style="color:green;"></span><span style="background-color:red;">  </span>		<span style="color:green;">      try {</span>
<span style="color:green;"></span><span style="background-color:red;">  </span>		<span style="color:green;">          request = sipManCallback.messageFactory.createRequest(requestURI,</span>
<span style="color:green;"></span><span style="background-color:red;">  </span>		<span style="color:green;">              &quot;INFO &quot;,</span>
<span style="color:green;"></span><span style="background-color:red;">  </span>		<span style="color:green;">              callIdHeader,</span>
<span style="color:green;"></span><span style="background-color:red;">  </span>		<span style="color:green;">              cSeqHeader, fromHeader, toHeader,</span>
<span style="color:green;"></span><span style="background-color:red;">  </span>		<span style="color:green;">              viaHeaders,</span>
<span style="color:green;"></span><span style="background-color:red;">  </span>		<span style="color:green;">              maxForwardsHeader);</span>
<span style="color:green;"></span><span style="background-color:red;">  </span>		<span style="color:green;">      }</span>
<span style="color:green;"></span><span style="background-color:red;">  </span>		<span style="color:green;">      catch (ParseException ex) {</span>
<span style="color:green;"></span><span style="background-color:red;">  </span>		<span style="color:green;">          console.error(&quot;Could not create the register request!&quot;, ex);</span>
<span style="color:green;"></span><span style="background-color:red;">  </span>		<span style="color:green;">          //throw was missing - reported by Eero Vaarnas</span>
<span style="color:green;"></span><span style="background-color:red;">  		          </span>
<span style="color:green;"></span><span style="background-color:red;">  </span>		<span style="color:green;">      }</span>
<span style="color:green;"></span><span style="background-color:red;">  </span>		<span style="color:green;">      Integer expires = 3600;</span>
<span style="color:green;"></span><span style="background-color:red;">  </span>		<span style="color:green;">  //Expires Header</span>
<span style="color:green;"></span><span style="background-color:red;">  </span>		<span style="color:green;">      ExpiresHeader expHeader = null;</span>
<span style="color:green;"></span><span style="background-color:red;">  </span>		<span style="color:green;">      for (int retry = 0; retry &lt; 2; retry++) {</span>
<span style="color:green;"></span><span style="background-color:red;">  </span>		<span style="color:green;">          try {</span>
<span style="color:green;"></span><span style="background-color:red;">  </span>		<span style="color:green;">              expHeader = sipManCallback.headerFactory.createExpiresHeader(</span>
<span style="color:green;"></span><span style="background-color:red;">  </span>		<span style="color:green;">                  expires);</span>
<span style="color:green;"></span><span style="background-color:red;">  </span>		<span style="color:green;">          }</span>
<span style="color:green;"></span><span style="background-color:red;">  </span>		<span style="color:green;">          catch (InvalidArgumentException ex) {</span>
<span style="color:green;"></span><span style="background-color:red;">  </span>		<span style="color:green;">              if (retry == 0) {</span>
<span style="color:green;"></span><span style="background-color:red;">  </span>		<span style="color:green;">                  expires = 3600;</span>
<span style="color:green;"></span><span style="background-color:red;">  </span>		<span style="color:green;">                  continue;</span>
<span style="color:green;"></span><span style="background-color:red;">  </span>		<span style="color:green;">              }</span>
<span style="color:green;"></span><span style="background-color:red;">  </span>		<span style="color:green;">              console.error(</span>
<span style="color:green;"></span><span style="background-color:red;">  </span>		<span style="color:green;">                  &quot;Invalid registrations expiration parameter - &quot;</span>
<span style="color:green;"></span><span style="background-color:red;">  </span>		<span style="color:green;">                  + expires,</span>
<span style="color:green;"></span><span style="background-color:red;">  </span>		<span style="color:green;">                  ex);</span>
<span style="color:green;"></span><span style="background-color:red;">  </span>		<span style="color:green;">              throw new CommunicationsException(</span>
<span style="color:green;"></span><span style="background-color:red;">  </span>		<span style="color:green;">                  &quot;Invalid registrations expiration parameter - &quot;</span>
<span style="color:green;"></span><span style="background-color:red;">  </span>		<span style="color:green;">                  + expires,</span>
<span style="color:green;"></span><span style="background-color:red;">  </span>		<span style="color:green;">                  ex);</span>
<span style="color:green;"></span><span style="background-color:red;">  </span>		<span style="color:green;">          }</span>
<span style="color:green;"></span><span style="background-color:red;">  </span>		<span style="color:green;">      }</span>
<span style="color:green;"></span><span style="background-color:red;">  </span>		<span style="color:green;">      request.addHeader(expHeader);</span>
<span style="color:green;"></span><span style="background-color:red;">  </span>		<span style="color:green;">      //Contact Header should contain IP - bug report - Eero Vaarnas</span>
<span style="color:green;"></span><span style="background-color:red;">  </span>		<span style="color:green;">      ContactHeader contactHeader = sipManCallback.</span>
<span style="color:green;"></span><span style="background-color:red;">  </span>		<span style="color:green;">          getRegistrationContactHeader();</span>
<span style="color:green;"></span><span style="background-color:red;">  </span>		<span style="color:green;">      request.addHeader(contactHeader);</span>
<span style="color:green;"></span><span style="background-color:red;">  		      </span>
<span style="color:green;"></span><span style="background-color:red;">  </span>		<span style="color:green;">      console.debug(request);</span>
<span style="color:green;"></span><span style="background-color:red;">  		      </span>
<span style="color:green;"></span><span style="background-color:red;">  		      </span>
<span style="color:green;"></span><span style="background-color:red;">  		      </span>
<span style="color:green;"></span><span style="background-color:red;">    </span>		<span style="color:green;">//Transaction</span>
<span style="color:green;"></span>		<span style="color:green;">      ClientTransaction trans = null;</span>
<span style="color:green;"></span>		<span style="color:green;">      try {</span>
<span style="color:green;"></span>		<span style="background-color:red;">    </span>	<span style="color:green;">trans = sipManCallback.sipProvider.getNewClientTransaction(</span>
<span style="color:green;"></span>		<span style="background-color:red;">    </span>			<span style="color:green;">request);</span>
<span style="color:green;"></span>		<span style="color:green;">      }</span>
<span style="color:green;"></span>		<span style="color:green;">      catch (TransactionUnavailableException ex) {</span>
<span style="color:green;"></span>		<span style="color:green;">          console.error(&quot;Could not create a charge transaction!\n&quot;</span>
<span style="color:green;"></span>		<span style="color:green;">                        + &quot;Check that the Registrar address is correct!&quot;,</span>
<span style="color:green;"></span>		<span style="color:green;">                        ex);</span>
<span style="color:green;"></span>		<span style="color:green;">          //throw was missing - reported by Eero Vaarnas</span>
<span style="color:green;"></span>		<span style="color:green;">          throw new CommunicationsException(</span>
<span style="color:green;"></span>		<span style="color:green;">              &quot;Could not create a charge transaction!\n&quot;</span>
<span style="color:green;"></span>		<span style="color:green;">              + &quot;Check that the Registrar address is correct!&quot;);</span>
<span style="color:green;"></span>		<span style="color:green;">      }</span>
<span style="color:green;"></span>		<span style="color:green;">      try {</span>
<span style="color:green;"></span>		<span style="background-color:red;">    </span>	<span style="color:green;">  trans.sendRequest();</span>
<span style="color:green;"></span>		<span style="color:green;">          if( console.isDebugEnabled() )</span>
<span style="color:green;"></span>		<span style="color:green;">              console.debug(&quot;sent request= &quot; + request);</span>
<span style="color:green;"></span>		<span style="color:green;">          //[issue 2] Schedule re registrations</span>
<span style="color:green;"></span>		<span style="color:green;">          //bug reported by LynlvL@netscape.com</span>
<span style="color:green;"></span><span style="background-color:red;">		          </span>
<span style="color:green;"></span>		<span style="color:green;">          //scheduleReRegistration( registrarAddress, registrarPort,</span>
<span style="color:green;"></span>		<span style="color:green;">          //            registrarTransport, expires);</span>
<span style="color:green;"></span><span style="background-color:red;">		</span>
<span style="color:green;"></span>		<span style="color:green;">      }</span>
<span style="color:green;"></span>		<span style="color:green;">      //we sometimes get a null pointer exception here so catch them all</span>
<span style="color:green;"></span>		<span style="color:green;">      catch (Exception ex) {</span>
<span style="color:green;"></span>		<span style="color:green;">          console.error(&quot;Could not send out the forward request!&quot;, ex);</span>
<span style="color:green;"></span>		<span style="color:green;">          //throw was missing - reported by Eero Vaarnas</span>
<span style="color:green;"></span>		<span style="color:green;">          throw new CommunicationsException(</span>
<span style="color:green;"></span>		<span style="color:green;">              &quot;Could not send out the forward request!&quot;, ex);</span>
<span style="color:green;"></span>		<span style="color:green;">      }</span>
<span style="color:green;"></span>		<span style="color:green;">      console.debug(trans);</span>
<span style="color:green;"></span><span style="background-color:red;">    </span>	<span style="color:green;">}</span>
<span style="color:green;"></span><span style="background-color:red;">    </span>	<span style="color:green;">catch (CommunicationsException e1) {</span>
<span style="color:green;"></span>			<span style="color:green;">// TODO Auto-generated catch block</span>
<span style="color:green;"></span>			<span style="color:green;">e1.printStackTrace();</span>
<span style="color:green;"></span>		<span style="color:green;">}</span>
<span style="color:green;"></span><span style="color:green;">    }</span>
<span style="color:green;"></span><span style="background-color:red;">	</span>
<span style="color:gray;background-color:black;"></span><span style="color:green;background-color:black;"> </span>
<span style="color:green;"></span>	<span style="color:green;">private void chargeShow(Response response) {</span>
<span style="color:green;"></span>		<span style="color:green;">// TODO Auto-generated method stub</span>
<span style="color:green;"></span>		<span style="color:green;">console.logEntry();</span>
<span style="color:green;"></span><span style="background-color:red;">    </span>	<span style="color:green;">/**</span>
<span style="color:green;"></span>		<span style="color:green;"> * TODO:</span><span style="background-color:red;"> </span>
<span style="color:green;"></span>		<span style="color:green;"> * - Show the charge somewhere</span>
<span style="color:green;"></span>		<span style="color:green;"> * - Write the charge in a file</span>
<span style="color:green;"></span>		<span style="color:green;"> */</span>
<span style="color:green;"></span><span style="background-color:red;">    </span>	<span style="color:green;">String content = new String(response.getRawContent());</span>
<span style="color:green;"></span><span style="background-color:red;">    </span>	<span style="color:green;">String chargeString = content.split(&quot;Chargement: &quot;)[1];</span>
<span style="color:green;"></span><span style="background-color:red;">    </span>	<span style="color:green;">Double charge = new Double(chargeString);</span>
<span style="color:green;"></span><span style="background-color:red;">    </span>	<span style="color:green;">String formattedCharge = String.format(&quot;%.2f&quot;, charge);</span>
<span style="color:green;"></span><span style="background-color:red;">    </span>	<span style="color:green;">JOptionPane.showMessageDialog(null, &quot;Charge: &quot; + formattedCharge);</span>
<span style="color:green;"></span><span style="background-color:red;">    	</span>
<span style="color:green;"></span><span style="background-color:red;">    </span>	<span style="color:green;">String localUser = this.getLocalUser();</span>
<span style="color:green;"></span><span style="background-color:red;">    </span>	<span style="color:green;">console.debug(localUser);</span>
<span style="color:green;"></span><span style="background-color:red;">    </span>	<span style="color:green;">/**</span>
<span style="color:green;"></span><span style="background-color:red;">    </span>	<span style="color:green;"> * Write the chargement in a file</span>
<span style="color:green;"></span><span style="background-color:red;">    </span>	<span style="color:green;"> */</span>
<span style="color:green;"></span><span style="background-color:red;">    </span>	<span style="color:green;">BufferedWriter out = null;</span>
<span style="color:green;"></span><span style="background-color:red;">    </span>	<span style="color:green;">try</span><span style="background-color:red;">  </span>
<span style="color:green;"></span><span style="background-color:red;">    </span>	<span style="color:green;">{</span>
<span style="color:green;"></span><span style="background-color:red;">    </span>	<span style="color:green;">    FileWriter fstream = new FileWriter(localUser + &quot;_chargements.txt&quot;, true); //true tells to append data.</span>
<span style="color:green;"></span><span style="background-color:red;">    </span>	<span style="color:green;">    out = new BufferedWriter(fstream);</span>
<span style="color:green;"></span><span style="background-color:red;">    </span>	<span style="color:green;">    out.write(&quot;Charge: &quot; + formattedCharge + &quot;\n&quot;);</span>
<span style="color:green;"></span><span style="background-color:red;">    </span>	<span style="color:green;">}</span>
<span style="color:green;"></span><span style="background-color:red;">    </span>	<span style="color:green;">catch (IOException e)</span>
<span style="color:green;"></span><span style="background-color:red;">    </span>	<span style="color:green;">{</span>
<span style="color:green;"></span><span style="background-color:red;">    </span>	<span style="color:green;">    System.err.println(&quot;Error: &quot; + e.getMessage());</span>
<span style="color:green;"></span><span style="background-color:red;">    </span>	<span style="color:green;">}</span>
<span style="color:green;"></span><span style="background-color:red;">    </span>	<span style="color:green;">finally</span>
<span style="color:green;"></span><span style="background-color:red;">    </span>	<span style="color:green;">{</span>
<span style="color:green;"></span><span style="background-color:red;">    </span>	<span style="color:green;">    if(out != null) {</span>
<span style="color:green;"></span><span style="background-color:red;">    </span>	<span style="color:green;">        try {</span>
<span style="color:green;"></span>					<span style="color:green;">out.close();</span>
<span style="color:green;"></span>				<span style="color:green;">} catch (IOException e) {</span>
<span style="color:green;"></span>					<span style="color:green;">// TODO Auto-generated catch block</span>
<span style="color:green;"></span>					<span style="color:green;">e.printStackTrace();</span>
<span style="color:green;"></span>				<span style="color:green;">}</span>
<span style="color:green;"></span><span style="background-color:red;">    </span>	<span style="color:green;">    }</span>
<span style="color:green;"></span><span style="background-color:red;">    </span>	<span style="color:green;">}</span>
<span style="color:green;"></span><span style="background-color:red;">    </span>	<span style="color:green;">console.logExit();</span>
<span style="color:green;"></span>	<span style="color:green;">}</span>
<span style="color:green;"></span><span style="background-color:red;">    </span>
<span style="color:gray;background-color:black;"></span><span style="color:green;background-color:black;"> </span>
<span style="color:green;"></span>	<span style="color:green;">//--------</span>
    String getLocalHostAddress()
    {
        try {
<span style="font-weight:bold;">────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
added: sip-communicator/src/net/java/sip/communicator/sip/event/BlockEvent.java
────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
</span><span style="color:teal;font-weight:bold;">@ BlockEvent.java:4 @</span><span style="font-weight:bold;text-decoration:blink;"></span>
<span style="color:green;"></span><span style="color:green;">package net.java.sip.communicator.sip.event;</span>
<span style="color:gray;background-color:black;"></span><span style="color:green;background-color:black;"> </span>
<span style="color:green;"></span><span style="color:green;">import java.util.EventObject;</span>
<span style="color:gray;background-color:black;"></span><span style="color:green;background-color:black;"> </span>
<span style="color:green;"></span><span style="color:green;">public class BlockEvent</span>
<span style="color:green;"></span>	<span style="color:green;">extends EventObject{</span>
<span style="color:gray;background-color:black;"></span><span style="color:green;background-color:black;"> </span>
<span style="color:green;"></span>	<span style="color:green;">public BlockEvent(String blockAddress){</span>
<span style="color:green;"></span><span style="background-color:red;">		</span>
<span style="color:green;"></span><span style="background-color:red;">		</span>
<span style="color:green;"></span>		<span style="color:green;">super(blockAddress);</span>
<span style="color:green;"></span><span style="background-color:red;">		</span>
<span style="color:green;"></span>	<span style="color:green;">}</span>
<span style="color:gray;background-color:black;"></span><span style="color:green;background-color:black;"> </span>
<span style="color:green;"></span>	<span style="color:green;">public String getReason(){</span>
<span style="color:green;"></span><span style="background-color:red;">		</span>
<span style="color:green;"></span>		<span style="color:green;">return (String) getSource();</span>
<span style="color:green;"></span>	<span style="color:green;">}</span>
<span style="color:green;"></span><span style="color:green;">}</span>
\ No newline at end of file
<span style="font-weight:bold;">────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
modified: sip-communicator/src/net/java/sip/communicator/sip/event/CommunicationsListener.java
────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
</span><span style="color:teal;font-weight:bold;">@ CommunicationsListener.java:95 @</span><span style="font-weight:bold;text-decoration:blink;"> public interface CommunicationsListener</span>
    public void unregistering(RegistrationEvent evt);

    public void unregistered(RegistrationEvent evt);
<span style="color:green;"></span><span style="background-color:red;">    </span>
<span style="color:green;"></span><span style="color:green;">    public void blocking(BlockEvent evt);</span>
<span style="color:green;"></span><span style="background-color:red;">    </span>
<span style="color:green;"></span><span style="color:green;">    public void unblockingGui(BlockEvent evt);</span>
<span style="color:green;"></span><span style="background-color:red;">    </span>
<span style="color:green;"></span><span style="color:green;">    public void forwardedOKGuiChange(ForwardEvent evt);</span>
//    public void callAccepted(CommunicationsEvent evt);
//    public void callRinging(CommunicationsEvent evt);
//    public void callTrying(CommunicationsEvent evt);
<span style="font-weight:bold;">────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
added: sip-communicator/src/net/java/sip/communicator/sip/event/ForwardEvent.java
────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
</span><span style="color:teal;font-weight:bold;">@ ForwardEvent.java:4 @</span><span style="font-weight:bold;text-decoration:blink;"></span>
<span style="color:green;"></span><span style="color:green;">package net.java.sip.communicator.sip.event;</span>
<span style="color:gray;background-color:black;"></span><span style="color:green;background-color:black;"> </span>
<span style="color:green;"></span><span style="color:green;">import java.util.EventObject;</span>
<span style="color:gray;background-color:black;"></span><span style="color:green;background-color:black;"> </span>
<span style="color:green;"></span><span style="color:green;">public class ForwardEvent</span>
<span style="color:green;"></span>	<span style="color:green;">extends EventObject{</span>
<span style="color:gray;background-color:black;"></span><span style="color:green;background-color:black;"> </span>
<span style="color:green;"></span>	<span style="color:green;">public ForwardEvent(String blockAddress){</span>
<span style="color:green;"></span><span style="background-color:red;">		</span>
<span style="color:green;"></span><span style="background-color:red;">		</span>
<span style="color:green;"></span>		<span style="color:green;">super(blockAddress);</span>
<span style="color:green;"></span><span style="background-color:red;">		</span>
<span style="color:green;"></span>	<span style="color:green;">}</span>
<span style="color:gray;background-color:black;"></span><span style="color:green;background-color:black;"> </span>
<span style="color:green;"></span>	<span style="color:green;">public String getReason(){</span>
<span style="color:green;"></span><span style="background-color:red;">		</span>
<span style="color:green;"></span>		<span style="color:green;">return (String) getSource();</span>
<span style="color:green;"></span>	<span style="color:green;">}</span>
<span style="color:green;"></span><span style="color:green;">}</span>
\ No newline at end of file
</pre>
</body>
</html>
